<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Asar Manual</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="usage.html"><strong aria-hidden="true">2.</strong> Usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="standard-includes.html"><strong aria-hidden="true">2.1.</strong> Standard Includes</a></li><li class="chapter-item expanded "><a href="standard-defines.html"><strong aria-hidden="true">2.2.</strong> Standard Defines</a></li></ol></li><li class="chapter-item expanded "><a href="arch.html"><strong aria-hidden="true">3.</strong> Architectures</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="arch-65816.html"><strong aria-hidden="true">3.1.</strong> List of 65816 Instructions</a></li><li class="chapter-item expanded "><a href="arch-spc700.html"><strong aria-hidden="true">3.2.</strong> List of SPC700 Instructions</a></li><li class="chapter-item expanded "><a href="arch-superfx.html"><strong aria-hidden="true">3.3.</strong> List of SuperFX Instructions</a></li></ol></li><li class="chapter-item expanded "><a href="mapping-modes.html"><strong aria-hidden="true">4.</strong> Mapping Modes</a></li><li class="chapter-item expanded "><a href="compat.html"><strong aria-hidden="true">5.</strong> Compatibility Settings</a></li><li class="chapter-item expanded "><a href="formatting.html"><strong aria-hidden="true">6.</strong> Code Formatting and Syntax</a></li><li class="chapter-item expanded "><a href="program-counter.html"><strong aria-hidden="true">7.</strong> Program Counter</a></li><li class="chapter-item expanded "><a href="math.html"><strong aria-hidden="true">8.</strong> Math</a></li><li class="chapter-item expanded "><a href="labels.html"><strong aria-hidden="true">9.</strong> Labels</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="structs.html"><strong aria-hidden="true">9.1.</strong> Structs</a></li><li class="chapter-item expanded "><a href="namespaces.html"><strong aria-hidden="true">9.2.</strong> Namespaces</a></li></ol></li><li class="chapter-item expanded "><a href="defines.html"><strong aria-hidden="true">10.</strong> Defines</a></li><li class="chapter-item expanded "><a href="macros.html"><strong aria-hidden="true">11.</strong> Macros</a></li><li class="chapter-item expanded "><a href="functions.html"><strong aria-hidden="true">12.</strong> Functions</a></li><li class="chapter-item expanded "><a href="conditionals.html"><strong aria-hidden="true">13.</strong> Conditionals and Loops</a></li><li class="chapter-item expanded "><a href="binary.html"><strong aria-hidden="true">14.</strong> Binary Data</a></li><li class="chapter-item expanded "><a href="includes.html"><strong aria-hidden="true">15.</strong> Includes</a></li><li class="chapter-item expanded "><a href="freespace.html"><strong aria-hidden="true">16.</strong> Freespace</a></li><li class="chapter-item expanded "><a href="prints.html"><strong aria-hidden="true">17.</strong> Text Output</a></li><li class="chapter-item expanded "><a href="checks.html"><strong aria-hidden="true">18.</strong> Checks</a></li><li class="chapter-item expanded "><a href="warnings.html"><strong aria-hidden="true">19.</strong> Warnings</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="cmd-index.html"><strong aria-hidden="true">20.</strong> List of commands</a></li><li class="chapter-item expanded "><a href="warning-list.html"><strong aria-hidden="true">21.</strong> List of all warnings</a></li><li class="chapter-item expanded "><a href="error-list.html"><strong aria-hidden="true">22.</strong> List of all errors</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="changelog.html"><strong aria-hidden="true">23.</strong> Changelog</a></li><li class="chapter-item expanded "><a href="changelog-old.html"><strong aria-hidden="true">24.</strong> Historical changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Asar Manual</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="asar"><a class="header" href="#asar">Asar</a></h1>
<p>A multi-architecture SNES assembler originally written by <em>Alcaro</em>, modelled after <strong>xkas v0.06</strong> by <em>byuu</em>.</p>
<p>This manual was originally written by <em>RPG Hacker</em> and has been extended by various contributors. If you find any issues, please report them on the GitHub repository.</p>
<p>As a general rule, the manual uses <code>{}</code> to denote required parameters and <code>[]</code> to denote optional parameters (where optional parameters ending in <code>...</code> mean &quot;zero or more&quot; of that parameter). Everything else refers to keywords/names.</p>
<p>You can view this entire book on one page by using the &quot;print&quot; button on the top right and canceling the print operation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<p>The general command-line syntax is:</p>
<pre><code class="language-powershell">asar.exe [options] {asm_file} [rom_file]
</code></pre>
<p>For convenience, double-clicking the Asar executable will prompt you to enter paths to an ASM file and a ROM file and thus allow you to directly use Asar without passing any command line arguments to it.</p>
<h2 id="options"><a class="header" href="#options">Options</a></h2>
<p>The valid options are:</p>
<h3 id="--version"><a class="header" href="#--version"><code>--version</code></a></h3>
<p>Displays Asar version information and exits.</p>
<pre><code class="language-powershell">asar.exe --version
</code></pre>
<h3 id="-v----verbose"><a class="header" href="#-v----verbose"><code>-v</code> / <code>--verbose</code></a></h3>
<p>Enables verbose mode.</p>
<pre><code class="language-powershell">asar.exe --verbose C:/homebrew/my_game/main.asm
</code></pre>
<h3 id="--no-title-check"><a class="header" href="#--no-title-check"><code>--no-title-check</code></a></h3>
<p>Disables input ROM title and checksum verification when using Asar to apply a patch to an existing ROM file. Note that irresponsible use of this option will likely corrupt your ROM.</p>
<pre><code class="language-powershell">asar.exe --no-title-check C:/homebrew/my_game/main.asm
</code></pre>
<h3 id="--pause-modemode"><a class="header" href="#--pause-modemode"><code>--pause-mode={mode}</code></a></h3>
<p>Sets Asar's pause mode, specifying when Asar should pause the application before exit, where <code>{mode}</code> can be one of the following:</p>
<ul>
<li><code>never</code>: Don't pause the application (default)</li>
<li><code>on-error</code>: Pause the application if an error was thrown.</li>
<li><code>on-warning</code>: Pause the application if an error or a warning was thrown.</li>
<li><code>always</code>: Always pause the application.</li>
</ul>
<pre><code class="language-powershell">asar.exe --pause-mode=always C:/homebrew/my_game/main.asm
</code></pre>
<h3 id="-ipath----include-path"><a class="header" href="#-ipath----include-path"><code>-I{path}</code> / <code>--include {path}</code></a></h3>
<p>Adds an include search path for file-based commands to Asar. Normally, commands like incsrc, incbin etc. look for files relative to the ASM file that is currently being compiled. If those files aren't found, an error is thrown, unless you specify include search paths, in which case Asar will look for the file in each respective directory before throwing an error. For example, imagine you compiled the file</p>
<pre><code>C:/homebrew/my_game.asm
</code></pre>
<p>with Asar, adding the include search path</p>
<pre><code>-I&quot;C:/homebrew/binary data&quot;
</code></pre>
<p>and the ASM file included the line:</p>
<pre><code>incbin &quot;data/player_gfx.bin&quot;
</code></pre>
<p>Asar would now look for a file:</p>
<pre><code>C:/homebrew/data/player_gfx.bin
</code></pre>
<p>If this file didn't exist, it would then look for a file:</p>
<pre><code>C:/homebrew/binary data/data/player_gfx.bin
</code></pre>
<p>If this file didn't exist, Asar would throw an error, otherwise Asar would include it. See section <a href="./includes.html">Includes</a> for details on Asar's handling of file names.</p>
<pre><code class="language-powershell">asar.exe -IC:/homebrew/my_game/includes -IC:/homebrew/shared
    C:/homebrew/my_game/main.asm C:/homebrew/my_game/bin/my_game.sfc

asar.exe --include C:/homebrew/my_game/includes
    C:/homebrew/my_game/main.asm C:/homebrew/my_game/bin/my_game.sfc
</code></pre>
<h3 id="-didentifiervalue----define-identifiervalue"><a class="header" href="#-didentifiervalue----define-identifiervalue"><code>-D{identifier}[=value]</code> / <code>--define {identifier}[=value]</code></a></h3>
<p>Adds a define to Asar. When no value is provided, the define is set to an empty string. See section <a href="./defines.html">Defines</a> for details.</p>
<pre><code class="language-powershell">asar.exe -Ddebug -Dskip_title_screen=0
    C:/homebrew/my_game/main.asm C:/homebrew/my_game/bin/my_game.sfc

asar.exe --define debug=1 --define mytext=&quot; value with whitespace &quot;
    C:/homebrew/my_game/main.asm C:/homebrew/my_game/bin/my_game.sfc
</code></pre>
<h3 id="--symbolsformat"><a class="header" href="#--symbolsformat"><code>--symbols={format}</code></a></h3>
<p>Specifies the format of the symbols output file generated by Asar. The following values are supported for {format}:</p>
<ul>
<li><code>none</code>: Don't generate a symbols file (default).</li>
<li><code>wla</code>: Generate a symbols file in the WLA format. This format additionally includes an address-to-line mapping which can be used by some debuggers to provide source-level debugging.</li>
<li><code>nocash</code>: Generate a symbols file in the no$sns format.</li>
</ul>
<pre><code class="language-powershell">asar.exe --symbols=wla C:/homebrew/my_game/main.asm
</code></pre>
<h3 id="--symbols-pathpath"><a class="header" href="#--symbols-pathpath"><code>--symbols-path={path}</code></a></h3>
<p>Specifies the path and file name to use for generating the symbols output file. By default, the path is the path of <code>[rom_file]</code> and the file name is the base name of <code>[rom_file]</code> with an extension of <code>.sym</code>. Ignored when <code>--symbols</code> is set to <code>none</code>.<br />
Note that relative paths here are relative from the current working directory, not relative from <code>{asm_file}</code> or <code>[rom_file]</code>.</p>
<pre><code class="language-powershell">asar.exe --symbols=wla
    --symbols-path=C:/homebrew/my_game/symbols/main.symbols
    C:/homebrew/my_game/main.asm
</code></pre>
<h3 id="-wname"><a class="header" href="#-wname"><code>-w{name}</code></a></h3>
<p>Enables the warning with the specified name. See section <a href="./warnings.html">Warnings</a> for details.</p>
<pre><code class="language-powershell">asar.exe -wWimplicitly_sized_immediate C:/homebrew/my_game/main.asm
</code></pre>
<h3 id="-wnoname"><a class="header" href="#-wnoname"><code>-wno{name}</code></a></h3>
<p>Disables the warning with the specified name. See section <a href="./warnings.html">Warnings</a> for details.</p>
<pre><code class="language-powershell">asar.exe -wnoWfreespace_leaked C:/homebrew/my_game/main.asm
</code></pre>
<h3 id="-werror"><a class="header" href="#-werror"><code>-werror</code></a></h3>
<p>Causes Asar to treat all warnings as errors.</p>
<pre><code class="language-powershell">asar.exe -werror main.asm
</code></pre>
<h3 id="--fix-checksumonoff"><a class="header" href="#--fix-checksumonoff"><code>--fix-checksum={on/off}</code></a></h3>
<p>Overrides Asar's default behavior of enabling or disabling checksum generation based on context. When set to <code>on</code>, Asar always generates a checksum. When set to <code>off</code>, Asar never generates a checksum.</p>
<pre><code class="language-powershell">asar.exe --fix-checksum=on C:/homebrew/my_game/main.asm
</code></pre>
<h3 id="--full-error-stack"><a class="header" href="#--full-error-stack"><code>--full-error-stack</code></a></h3>
<p>This option makes Asar print a complete call stack whenever an error or warning occurs. This is very useful for patches that use nested macros or mutiple <code>incsrc</code>.</p>
<pre><code class="language-powershell">asar.exe --full-error-stack C:/homebrew/my_game/main.asm
</code></pre>
<h3 id="--error-limitn"><a class="header" href="#--error-limitn"><code>--error-limit={n}</code></a></h3>
<p>Sets the maximum number of errors that Asar will print before stopping. The default is 20.</p>
<pre><code class="language-powershell">asar.exe --error-limit=500 C:/homebrew/my_game/main.asm
</code></pre>
<h2 id="positional-arguments"><a class="header" href="#positional-arguments">Positional arguments</a></h2>
<h3 id="asm_file"><a class="header" href="#asm_file"><code>{asm_file}</code></a></h3>
<p>Path to the ASM source file.</p>
<h3 id="rom_file"><a class="header" href="#rom_file"><code>[rom_file]</code></a></h3>
<p>Path to the ROM file that is modified by Asar. If this file doesn't exist yet, Asar creates a new ROM file instead. When omitted, Asar checks if <code>asm_file_name.sfc</code> or <code>asm_file_name.smc</code> exists and uses the one it finds. When zero or two ROMs with that filename are found, Asar defaults to the .sfc extension. As a convention, Asar always treats .smc files as headered and .sfc files as unheadered ROMs. This means that headered .sfc files or unheadered .smc files cannot be used with Asar unless their extension is changed. This is by design and meant to encourage compliance with the convention.</p>
<p>Examples:</p>
<pre><code class="language-powershell">asar.exe C:/homebrew/my_game/main.asm C:/homebrew/my_game/bin/my_game.sfc
asar.exe C:/homebrew/my_game/main.asm C:/homebrew/my_game/bin/my_game.smc
asar.exe C:/homebrew/my_game/main.asm
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="standard-includes"><a class="header" href="#standard-includes">Standard Includes</a></h1>
<p>Aside from passing include search paths to Asar via the command line, it's possible to also do so via a file called <code>stdincludes.txt</code>. When a file with this name exists next to the Asar executable, Asar automatically opens it and adds every line in it as an include search path (trailing and leading whitespace on a line is ignored, as are lines containing only whitespace). Absolute and relative paths are supported. Relative paths are considered relative to the TXT file. The purpose of this file is to make it easier to distribute standard code libraries for use with Asar by making it possible to just unpack the contents of a ZIP file or similar directly into the Asar directory. Note that include search paths passed in via the command line get priority over paths parsed from this TXT file. See section <a href="./includes.html">Includes</a> for details on include search paths.</p>
<p>All of the examples below are valid:</p>
<pre><code>C:/asm/stdlib

    ./debug
../../my_game/libraries
        test/
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="standard-defines"><a class="header" href="#standard-defines">Standard Defines</a></h1>
<p>Aside from passing additional defines to Asar via the command line, it's possible to also do so via a file called <code>stddefines.txt</code>. When a file with this name exists next to the Asar executable, Asar automatically opens it and adds every line in it as an additional define. The syntax is similar to Asar's regular define syntax, with a few notable differences. There are no spaces required around the <code>=</code>, the <code>!</code> of the identifier is optional, whitespace around the identifier is ignored, so is whitespace around the value (unless the value is delimited by double quotes, in which case any whitespace inside is kept in the define), the value itself is optional (when left out, it is set to an emptry string). Lines containing only whitespace are ignored. The purpose of this file is to make it easier to distribute standard code libraries for use with Asar by making it possible to just unpack the contents of a ZIP file or similar directly into the Asar directory. See section <a href="./defines.html">Defines</a> for details on defines.</p>
<p>All of the examples below are valid:</p>
<pre><code>!stddefined1=1
 stddefined2=1

stddefined3
stddefined4 = 1 
stddefined5 = &quot; $60,$50,$40 &quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architectures"><a class="header" href="#architectures">Architectures</a></h1>
<p>Asar supports a number of different target architectures for code compilation. They can be activated via the command <a name="a0"></a><code>arch {name}</code>. Going into detail on any of the supported architectures is beyond the scope of this manual. For that, it's recommended to check the SNES Dev Manual or other specialized resources. Asar tries as much as possible to always stick to the known conventions and specifications of each respective architecture (with a few notable exceptions that are hopefully all covered somewhere in this manual).</p>
<h2 id="supported-architectures"><a class="header" href="#supported-architectures">Supported architectures</a></h2>
<ul>
<li><code>65816</code>: Compiles code for the 65C816, used by the main SNES CPU and by SA-1. This is the default architecture. It supports the syntax recommended by WDC, with the exception of the <code>MVN</code> and <code>MVP</code> instructions. See the instruction list page for details.</li>
<li><code>spc700</code>: Compiles code for the SPC700 CPU, the audio coprocessor in the SNES. Follows the format the SNES Dev Manual recommends, with the exception of <code>mov (x)+,a</code> and <code>mov a,(x)+</code>, which are moved to <code>mov (x+),a</code> and <code>mov a,(x+)</code>. See also the <a href="arch.html#spcblock"><code>spcblock</code></a> section for an alternative way of assembling SPC700 code.</li>
<li><code>superfx</code>: Compiles code for the SuperFX coprocessor.</li>
</ul>
<p>All of Asar's features should be compatible with all of the supported target architectures, but it's not recommended to mix labels between different architectures as that will lead to undefined behavior. Opcodes in Asar are case-insensitive, which means that <code>LDA</code> and <code>lda</code> will be treated equally.</p>
<pre><code class="language-asar">arch 65816
lda $00

arch spc700
mov a,$00
</code></pre>
<h2 id="number-literals"><a class="header" href="#number-literals">Number Literals</a></h2>
<!-- TODO: move this to math.md instead?? -->
<p>Asar supports decimal, hexadecimal and binary number literals. Hexadecimal literals use <code>$</code> as a prefix, binary literals use <code>%</code> as a prefix. Number literals can be made positive or negative by prefixing a <code>+</code> or a <code>-</code> (without a sign, positive is assumed). They can also be prefixed with a <code>~</code> to get their unary complement (a 32-bit integer with all the bits inverted).</p>
<pre><code class="language-asar">lda $00
clc
adc #-10
and #%01111111
lda #~$80   ; Equal to lda #$FFFFFF7F
</code></pre>
<p>Aditionally, Asar supports character literals by delimiting a single Unicode character with <code>'</code>. Asar will automatically convert them to the integer value currently mapped to them (by default their Unicode code point). They can be used in all places where number literals can be used. See section <a href="arch.html#tables">Tables</a> for details on character mapping.</p>
<pre><code class="language-asar">lda #'a'
sta $00

db 'x','x'+1,'x'+2

db '💩'
</code></pre>
<h2 id="opcode-length-specification"><a class="header" href="#opcode-length-specification">Opcode Length Specification</a></h2>
<p>By appending <code>.b</code>, <code>.w</code> or <code>.l</code> to an opcode, you can specify that opcode's length. This is recommended in cases where the length could be ambiguous.</p>
<pre><code class="language-asar">lda #0      ; Could be either lda #$00 or lda #$0000
lda.b #0    ; Always lda #$00
lda.w #0    ; Always lda #$0000
</code></pre>
<p>When no length is specified, Asar tries to guess the length based on the operand. Note that Asar does not use the standard <code>&lt;&gt;</code> for length specifications to avoid ambiguity with other uses of these symbols (such as in macros or math statements). Opcode length specifications are currently supported for the 65c816 and SPC700 architectures.</p>
<h2 id="pseudo-opcodes"><a class="header" href="#pseudo-opcodes">Pseudo Opcodes</a></h2>
<p>Pseudo opcodes are a convenience method of repeatedly using opcodes that don't take an operand. Instead of using the opcode multiple times, the following syntax can be used:</p>
<pre><code class="language-asar">{opcode} #{num}
</code></pre>
<p>This assembles <code>opcode</code> <code>num</code> times in succession. This means that</p>
<pre><code class="language-asar">nop #3

inx #2
</code></pre>
<p>is the same as</p>
<pre><code class="language-asar">nop
nop
nop

inx
inx
</code></pre>
<h2 id="spcblock"><a class="header" href="#spcblock"><code>spcblock</code></a></h2>
<p>SPC blocks are a convenient way of defining command data meant to be sent to the SPC700 in games using well-known SPC engines (though at this time, only the <code>N-SPC</code> engine is supported). The general format looks like this:</p>
<p><a name="a1"></a>
<a name="a2"></a></p>
<pre><code class="language-asar">spcblock {target_address} [{engine_type}]
    [spc700_instructions...]
endspcblock [execute {execution_address}]
</code></pre>
<p>Inside an spcblock, <code>arch spc700</code> is automatically active (see <a href="arch.html#supported-architectures">above</a> for details). The <code>target_address</code> parameter specifies the target address (in ARAM) for the command data. The optional <code>execute</code> parameter tells Asar to generate a &quot;start execution&quot; command immediately after this SPC block, with <code>execution_address</code> as the ARAM address to start execution at. The <code>engine_type</code> parameter specifies which SPC engine to use. When omitted, the default value of <code>nspc</code> is used. The following engine types are supported:</p>
<h3 id="nspc"><a class="header" href="#nspc"><code>nspc</code></a></h3>
<p>This engine type implements the format used by the N-SPC engine found in most Nintendo games, as well as by the SPC700's initial program loader. The output format is:</p>
<pre><code class="language-asar">dw &lt;block_length&gt;
dw &lt;target_address&gt;
&lt;instructions...&gt;
[dw $0000, &lt;execution_address&gt;]
</code></pre>
<p>Example usage:</p>
<pre><code class="language-asar">                                   ; assembles to:
spcblock $6000 nspc                ; dw $0007 (length of the spcblock contents)
                                   ; dw $6000 (target address)
    db $00,$01,$02,$03             ; db $00,$01,$02,$03,$04
    exec_start:                    ;
    mov $33,#$44                   ; db $8f,$44,$33
endspcblock execute exec_start     ; dw $0000, $6004  (execution_address)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="supported-65816-instructions"><a class="header" href="#supported-65816-instructions">Supported 65816 instructions</a></h1>
<p>Due to legacy from xkas, Asar's <code>MVN</code> and <code>MVP</code> instructions are backwards from most other assemblers: the syntax is <code>MVN dest, src</code>. Also, a 16-bit argument like <code>MVN $ssdd</code> (where $ss is source, $dd is destination) is accepted too (edit: not in asar2 it isn't).</p>
<p>All other instructions use syntax recommended by WDC, with some additional liberties:</p>
<ul>
<li>for accumulator-addressed instructions (<code>inc a</code> etc), the <code>a</code> argument can be omitted.</li>
<li><code>cop</code>, <code>brk</code> and <code>wdm</code> are assembled as 2-byte instructions, with with the second byte being optional and defaulting to zero.</li>
</ul>
<!-- TODO: use nonzero arguments here and put the corresponding asm bytes next to them -->
<pre><code class="language-asar">ADC #$00
ADC #$0000
ADC $00
ADC $00,s
ADC $00,x
ADC $0000
ADC $0000,x
ADC $0000,y
ADC $000000
ADC $000000,x
ADC ($00)
ADC ($00),y
ADC ($00,s),y
ADC ($00,x)
ADC [$00]
ADC [$00],y
AND #$00
AND #$0000
AND $00
AND $00,s
AND $00,x
AND $0000
AND $0000,x
AND $0000,y
AND $000000
AND $000000,x
AND ($00)
AND ($00),y
AND ($00,s),y
AND ($00,x)
AND [$00]
AND [$00],y
ASL $00
ASL $00,x
ASL $0000
ASL $0000,x
ASL A
BCC $00
BCS $00
BEQ $00
BIT #$00
BIT #$0000
BIT $00
BIT $00,x
BIT $0000
BIT $0000,x
BMI $00
BNE $00
BPL $00
BRA $00
BRK
BRK #$00
BRL $0000
BVC $00
BVS $00
CLC
CLD
CLI
CLV
CMP #$00
CMP #$0000
CMP $00
CMP $00,s
CMP $00,x
CMP $0000
CMP $0000,x
CMP $0000,y
CMP $000000
CMP $000000,x
CMP ($00)
CMP ($00),y
CMP ($00,s),y
CMP ($00,x)
CMP [$00]
CMP [$00],y
COP
COP #$00
CPX #$00
CPX #$0000
CPX $00
CPX $0000
CPY #$00
CPY #$0000
CPY $00
CPY $0000
DEC $00
DEC $00,x
DEC $0000
DEC $0000,x
DEC A
DEX
DEY
EOR #$00
EOR #$0000
EOR $00
EOR $00,s
EOR $00,x
EOR $0000
EOR $0000,x
EOR $0000,y
EOR $000000
EOR $000000,x
EOR ($00)
EOR ($00),y
EOR ($00,s),y
EOR ($00,x)
EOR [$00]
EOR [$00],y
INC $00
INC $00,x
INC $0000
INC $0000,x
INC A
INX
INY
JML $000000
JML [$0000]
JMP $0000
JMP ($0000)
JMP ($0000,x)
JSL $000000
JSR $0000
JSR ($0000,x)
LDA #$00
LDA #$0000
LDA $00
LDA $00,s
LDA $00,x
LDA $0000
LDA $0000,x
LDA $0000,y
LDA $000000
LDA $000000,x
LDA ($00)
LDA ($00),y
LDA ($00,s),y
LDA ($00,x)
LDA [$00]
LDA [$00],y
LDX #$00
LDX #$0000
LDX $00
LDX $00,y
LDX $0000
LDX $0000,y
LDY #$00
LDY #$0000
LDY $00
LDY $00,x
LDY $0000
LDY $0000,x
LSR $00
LSR $00,x
LSR $0000
LSR $0000,x
LSR A
MVN $00,$00
MVN $0000
MVP $00,$00
MVP $0000
NOP
ORA #$00
ORA #$0000
ORA $00
ORA $00,s
ORA $00,x
ORA $0000
ORA $0000,x
ORA $0000,y
ORA $000000
ORA $000000,x
ORA ($00)
ORA ($00),y
ORA ($00,s),y
ORA ($00,x)
ORA [$00]
ORA [$00],y
PEA $0000
PEI ($00)
PER $0000
PHA
PHB
PHD
PHK
PHP
PHX
PHY
PLA
PLB
PLD
PLP
PLX
PLY
REP #$00
ROL $00
ROL $00,x
ROL $0000
ROL $0000,x
ROL A
ROR $00
ROR $00,x
ROR $0000
ROR $0000,x
ROR A
RTI
RTL
RTS
SBC #$00
SBC #$0000
SBC $00
SBC $00,s
SBC $00,x
SBC $0000
SBC $0000,x
SBC $0000,y
SBC $000000
SBC $000000,x
SBC ($00)
SBC ($00),y
SBC ($00,s),y
SBC ($00,x)
SBC [$00]
SBC [$00],y
SEC
SED
SEI
SEP #$00
STA $00
STA $00,s
STA $00,x
STA $0000
STA $0000,x
STA $0000,y
STA $000000
STA $000000,x
STA ($00)
STA ($00),y
STA ($00,s),y
STA ($00,x)
STA [$00]
STA [$00],y
STP
STX $00
STX $00,y
STX $0000
STY $00
STY $00,x
STY $0000
STZ $00
STZ $00,x
STZ $0000
STZ $0000,x
TAX
TAY
TCD
TCS
TDC
TRB $00
TRB $0000
TSB $00
TSB $0000
TSC
TSX
TXA
TXS
TXY
TYA
TYX
WAI
WDM
WDM #$00
XBA
XCE
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="supported-spc700-instructions"><a class="header" href="#supported-spc700-instructions">Supported SPC700 instructions</a></h1>
<p>Follows the format the SNES Dev Manual recommends, with the exception of <code>mov (x)+,a</code> and <code>mov a,(x)+</code>, which are moved to <code>mov (x+),a</code> and <code>mov a,(x+)</code>.</p>
<pre><code class="language-asar">ADC $00,#$00
ADC $00,$00
ADC (X),(Y)
ADC A,#$00
ADC A,$00
ADC A,$00+X
ADC A,$0000
ADC A,$0000+X
ADC A,$0000+Y
ADC A,($00)+Y
ADC A,($00+X)
ADC A,(X)
ADDW YA,$00
AND $00,#$00
AND $00,$00
AND (X),(Y)
AND A,#$00
AND A,$00
AND A,$00+X
AND A,$0000
AND A,$0000+X
AND A,$0000+Y
AND A,($00)+Y
AND A,($00+X)
AND A,(X)
AND1 C,!$0000
AND1 C,$0000
ASL $00
ASL $00+X
ASL $0000
ASL A
BBC0 $00,$00
BBC1 $00,$00
BBC2 $00,$00
BBC3 $00,$00
BBC4 $00,$00
BBC5 $00,$00
BBC6 $00,$00
BBC7 $00,$00
BBS0 $00,$00
BBS1 $00,$00
BBS2 $00,$00
BBS3 $00,$00
BBS4 $00,$00
BBS5 $00,$00
BBS6 $00,$00
BBS7 $00,$00
BCC $00
BCS $00
BEQ $00
BMI $00
BNE $00
BPL $00
BRA $00
BRK
BVC $00
BVS $00
CALL $0000
CBNE $00+x,$00
CBNE $00,$00
CLR0 $00
CLR1 $00
CLR2 $00
CLR3 $00
CLR4 $00
CLR5 $00
CLR6 $00
CLR7 $00
CLRC
CLRP
CLRV
CMP $00,#$00
CMP $00,$00
CMP (X),(Y)
CMP A,#$00
CMP A,$00
CMP A,$00+X
CMP A,$0000
CMP A,$0000+X
CMP A,$0000+Y
CMP A,($00)+Y
CMP A,($00+X)
CMP A,(X)
CMP X,#$00
CMP X,$00
CMP X,$0000
CMP Y,#$00
CMP Y,$00
CMP Y,$0000
CMPW YA,$00
DAA A
DAS A
DBNZ $00,$00
DBNZ Y,$00
DEC $00
DEC $00+X
DEC $0000
DEC A
DEC X
DEC Y
DECW $00
DI
DIV YA,X
EI
EOR $00,#$00
EOR $00,$00
EOR (X),(Y)
EOR A,#$00
EOR A,$00
EOR A,$00+X
EOR A,$0000
EOR A,$0000+X
EOR A,$0000+Y
EOR A,($00)+Y
EOR A,($00+X)
EOR A,(X)
EOR1 C,$0000
INC $00
INC $00+X
INC $0000
INC A
INC X
INC Y
INCW $00
JMP $0000
JMP ($0000+X)
LSR $00
LSR $00+X
LSR $0000
LSR A
MOV $00+X,A
MOV $00+X,Y
MOV $00+Y,X
MOV $00,#$00
MOV $00,$00
MOV $00,A
MOV $00,X
MOV $00,Y
MOV $0000+X,A
MOV $0000+Y,A
MOV $0000,A
MOV $0000,X
MOV $0000,Y
MOV ($00)+Y,A
MOV ($00+X),A
MOV (X),A
MOV (X+),A
MOV A,#$00
MOV A,$00
MOV A,$00+X
MOV A,$0000
MOV A,$0000+X
MOV A,$0000+Y
MOV A,($00)+Y
MOV A,($00+X)
MOV A,(X)
MOV A,(X+)
MOV A,X
MOV A,Y
MOV SP,X
MOV X,#$00
MOV X,$00
MOV X,$00+Y
MOV X,$0000
MOV X,A
MOV X,SP
MOV Y,#$00
MOV Y,$00
MOV Y,$00+X
MOV Y,$0000
MOV Y,A
MOV1 $0000,C
MOV1 C,$0000
MOVW $00,YA
MOVW YA,$00
MUL YA
NOP
NOT1 $0000
NOTC
OR $00,#$00
OR $00,$00
OR (X),(Y)
OR A,#$00
OR A,$00
OR A,$00+X
OR A,$0000
OR A,$0000+X
OR A,$0000+Y
OR A,($00)+Y
OR A,($00+X)
OR A,(X)
OR1 C,!$0000
OR1 C,$0000
PCALL $00
POP A
POP P
POP X
POP Y
PUSH A
PUSH P
PUSH X
PUSH Y
RET
RETI
ROL $00
ROL $00+X
ROL $0000
ROL A
ROR $00
ROR $00+X
ROR $0000
ROR A
SBC $00,#$00
SBC $00,$00
SBC (X),(Y)
SBC A,#$00
SBC A,$00
SBC A,$00+X
SBC A,$0000
SBC A,$0000+X
SBC A,$0000+Y
SBC A,($00)+Y
SBC A,($00+X)
SBC A,(X)
SET0 $00
SET1 $00
SET2 $00
SET3 $00
SET4 $00
SET5 $00
SET6 $00
SET7 $00
SETC
SETP
SLEEP
STOP
SUBW YA,$00
TCALL 0
TCALL 1
TCALL 2
TCALL 3
TCALL 4
TCALL 5
TCALL 6
TCALL 7
TCALL 8
TCALL 9
TCALL 10
TCALL 11
TCALL 12
TCALL 13
TCALL 14
TCALL 15
TCLR $0000,a
TSET $0000,a
XCN A
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="supported-superfx-instructions"><a class="header" href="#supported-superfx-instructions">Supported SuperFX instructions</a></h1>
<p>i don't really know who originally specified this syntax or where asar's version comes from tbh</p>
<pre><code class="language-asar">ADC #0
ADC #0
ADC #1
ADC #2
ADC #3
ADC #4
ADC #5
ADC #6
ADC #7
ADC #8
ADC #9
ADC #10
ADC #11
ADC #12
ADC #13
ADC #14
ADC #15
ADC R0
ADC R1
ADC R2
ADC R3
ADC R4
ADC R5
ADC R6
ADC R7
ADC R8
ADC R9
ADC R10
ADC R11
ADC R12
ADC R13
ADC R14
ADC R15
ADD #0
ADD #1
ADD #2
ADD #3
ADD #4
ADD #5
ADD #6
ADD #7
ADD #8
ADD #9
ADD #10
ADD #11
ADD #12
ADD #13
ADD #14
ADD #15
ADD R0
ADD R1
ADD R2
ADD R3
ADD R4
ADD R5
ADD R6
ADD R7
ADD R8
ADD R9
ADD R10
ADD R11
ADD R12
ADD R13
ADD R14
ADD R15
ALT1
ALT2
ALT3
AND #1
AND #2
AND #3
AND #4
AND #5
AND #6
AND #7
AND #8
AND #9
AND #10
AND #11
AND #12
AND #13
AND #14
AND #15
AND R1
AND R2
AND R3
AND R4
AND R5
AND R6
AND R7
AND R8
AND R9
AND R10
AND R11
AND R12
AND R13
AND R14
AND R15
ASR
BCC $00
BCS $00
BEQ $00
BGE $00
BIC #1
BIC #2
BIC #3
BIC #4
BIC #5
BIC #6
BIC #7
BIC #8
BIC #9
BIC #10
BIC #11
BIC #12
BIC #13
BIC #14
BIC #15
BIC R1
BIC R2
BIC R3
BIC R4
BIC R5
BIC R6
BIC R7
BIC R8
BIC R9
BIC R10
BIC R11
BIC R12
BIC R13
BIC R14
BIC R15
BLT $00
BMI $00
BNE $00
BPL $00
BRA $00
BVC $00
BVS $00
CACHE
CMODE
CMP R0
CMP R1
CMP R2
CMP R3
CMP R4
CMP R5
CMP R6
CMP R7
CMP R8
CMP R9
CMP R10
CMP R11
CMP R12
CMP R13
CMP R14
CMP R15
COLOR
DEC R0
DEC R1
DEC R2
DEC R3
DEC R4
DEC R5
DEC R6
DEC R7
DEC R8
DEC R9
DEC R10
DEC R11
DEC R12
DEC R13
DEC R14
DIV2
FMULT
FROM R0
FROM R1
FROM R2
FROM R3
FROM R4
FROM R5
FROM R6
FROM R7
FROM R8
FROM R9
FROM R10
FROM R11
FROM R12
FROM R13
FROM R14
FROM R15
GETB
GETBH
GETBL
GETBS
GETC
HIB
IBT R0,#$00
IBT R1,#$00
IBT R2,#$00
IBT R3,#$00
IBT R4,#$00
IBT R5,#$00
IBT R6,#$00
IBT R7,#$00
IBT R8,#$00
IBT R9,#$00
IBT R10,#$00
IBT R11,#$00
IBT R12,#$00
IBT R13,#$00
IBT R14,#$00
IBT R15,#$00
INC R0
INC R1
INC R2
INC R3
INC R4
INC R5
INC R6
INC R7
INC R8
INC R9
INC R10
INC R11
INC R12
INC R13
INC R14
IWT R0,#0000
IWT R1,#0000
IWT R2,#0000
IWT R3,#0000
IWT R4,#0000
IWT R5,#0000
IWT R6,#0000
IWT R7,#0000
IWT R8,#0000
IWT R9,#0000
IWT R10,#0000
IWT R11,#0000
IWT R12,#0000
IWT R13,#0000
IWT R14,#0000
IWT R15,#0000
JMP R8
JMP R9
JMP R10
JMP R11
JMP R12
JMP R13
LDB (R0)
LDB (R1)
LDB (R2)
LDB (R3)
LDB (R4)
LDB (R5)
LDB (R6)
LDB (R7)
LDB (R8)
LDB (R9)
LDB (R10)
LDB (R11)
LDW (R0)
LDW (R1)
LDW (R2)
LDW (R3)
LDW (R4)
LDW (R5)
LDW (R6)
LDW (R7)
LDW (R8)
LDW (R9)
LDW (R10)
LDW (R11)
LEA R0,$0000
LINK #1
LINK #2
LINK #3
LINK #4
LJMP R8
LJMP R9
LJMP R10
LJMP R11
LJMP R12
LJMP R13
LM R0,($0000)
LM R1,($0000)
LM R2,($0000)
LM R3,($0000)
LM R4,($0000)
LM R5,($0000)
LM R6,($0000)
LM R7,($0000)
LM R8,($0000)
LM R9,($0000)
LM R10,($0000)
LM R11,($0000)
LM R12,($0000)
LM R13,($0000)
LM R14,($0000)
LM R15,($0000)
LMS R0,($00)
LMS R1,($00)
LMS R2,($00)
LMS R3,($00)
LMS R4,($00)
LMS R5,($00)
LMS R6,($00)
LMS R7,($00)
LMS R8,($00)
LMS R9,($00)
LMS R10,($00)
LMS R11,($00)
LMS R12,($00)
LMS R13,($00)
LMS R14,($00)
LMS R15,($00)
LMULT
LOB
LOOP
LSR
MERGE
MOVE ($00),R0
MOVE R0,#$00
MOVE R0,($00)
MOVE R0,R0
MOVEB (R0),R0
MOVEB R0,(R0)
MOVES R0,R0
MOVEW (R0),R0
MOVEW R0,(R0)
MULT #0
MULT #1
MULT #2
MULT #3
MULT #4
MULT #5
MULT #6
MULT #7
MULT #8
MULT #9
MULT #10
MULT #11
MULT #12
MULT #13
MULT #14
MULT #15
MULT R0
MULT R1
MULT R2
MULT R3
MULT R4
MULT R5
MULT R6
MULT R7
MULT R8
MULT R9
MULT R10
MULT R11
MULT R12
MULT R13
MULT R14
MULT R15
NOP
NOT
OR #1
OR #2
OR #3
OR #4
OR #5
OR #6
OR #7
OR #8
OR #9
OR #10
OR #11
OR #12
OR #13
OR #14
OR #15
OR R1
OR R2
OR R3
OR R4
OR R5
OR R6
OR R7
OR R8
OR R9
OR R10
OR R11
OR R12
OR R13
OR R14
OR R15
PLOT
RAMB
ROL
ROMB
ROR
RPIX
SBC R0
SBC R1
SBC R2
SBC R3
SBC R4
SBC R5
SBC R6
SBC R7
SBC R8
SBC R9
SBC R10
SBC R11
SBC R12
SBC R13
SBC R14
SBC R15
SBK
SEX
SM ($0000),R0
SM ($0000),R1
SM ($0000),R2
SM ($0000),R3
SM ($0000),R4
SM ($0000),R5
SM ($0000),R6
SM ($0000),R7
SM ($0000),R8
SM ($0000),R9
SM ($0000),R10
SM ($0000),R11
SM ($0000),R12
SM ($0000),R13
SM ($0000),R14
SM ($0000),R15
SMS ($00),R0
SMS ($00),R1
SMS ($00),R2
SMS ($00),R3
SMS ($00),R4
SMS ($00),R5
SMS ($00),R6
SMS ($00),R7
SMS ($00),R8
SMS ($00),R9
SMS ($00),R10
SMS ($00),R11
SMS ($00),R12
SMS ($00),R13
SMS ($00),R14
SMS ($00),R15
STB (R0)
STB (R1)
STB (R2)
STB (R3)
STB (R4)
STB (R5)
STB (R6)
STB (R7)
STB (R8)
STB (R9)
STB (R10)
STB (R11)
STOP
STW (R0)
STW (R1)
STW (R2)
STW (R3)
STW (R4)
STW (R5)
STW (R6)
STW (R7)
STW (R8)
STW (R9)
STW (R10)
STW (R11)
SUB #0
SUB #1
SUB #2
SUB #3
SUB #4
SUB #5
SUB #6
SUB #7
SUB #8
SUB #9
SUB #10
SUB #11
SUB #12
SUB #13
SUB #14
SUB #15
SUB R0
SUB R1
SUB R2
SUB R3
SUB R4
SUB R5
SUB R6
SUB R7
SUB R8
SUB R9
SUB R10
SUB R11
SUB R12
SUB R13
SUB R14
SUB R15
SWAP
TO R0
TO R1
TO R2
TO R3
TO R4
TO R5
TO R6
TO R7
TO R8
TO R9
TO R10
TO R11
TO R12
TO R13
TO R14
TO R15
UMULT #0
UMULT #1
UMULT #2
UMULT #3
UMULT #4
UMULT #5
UMULT #6
UMULT #7
UMULT #8
UMULT #9
UMULT #10
UMULT #11
UMULT #12
UMULT #13
UMULT #14
UMULT #15
UMULT R0
UMULT R1
UMULT R2
UMULT R3
UMULT R4
UMULT R5
UMULT R6
UMULT R7
UMULT R8
UMULT R9
UMULT R10
UMULT R11
UMULT R12
UMULT R13
UMULT R14
UMULT R15
WITH R0
WITH R1
WITH R2
WITH R3
WITH R4
WITH R5
WITH R6
WITH R7
WITH R8
WITH R9
WITH R10
WITH R11
WITH R12
WITH R13
WITH R14
WITH R15
XOR #1
XOR #2
XOR #3
XOR #4
XOR #5
XOR #6
XOR #7
XOR #8
XOR #9
XOR #10
XOR #11
XOR #12
XOR #13
XOR #14
XOR #15
XOR R1
XOR R2
XOR R3
XOR R4
XOR R5
XOR R6
XOR R7
XOR R8
XOR R9
XOR R10
XOR R11
XOR R12
XOR R13
XOR R14
XOR R15
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mapping-modes"><a class="header" href="#mapping-modes">Mapping Modes</a></h1>
<p>Asar supports a number of different mapping modes. They control the address translation used by Asar during compilation (aka where in the output file Asar writes to). Historically, SNES cartridges used a number of different mappers to address data in ROM. Those mappers can be supported by using the respective mapping mode in Asar. It's possible, but not recommended, to use different mapping modes on the same ROM. Detailed explanations on each mapping mode are beyond the scope of this manual, so please check the SNES Dev Manual or other specialized resources for that.</p>
<p>NOTE: Changing the mapper after having previously set it will generate warning <code>Wmapper_already_set</code>.</p>
<!-- TODO probably a good idea to document the sa1 mapping modes better -->
<ul>
<li><a name="a0"></a><code>lorom</code>: Switch to LoROM mapping mode.</li>
<li><a name="a1"></a><code>hirom</code>: Switch to HiROM mapping mode.</li>
<li><a name="a2"></a><code>exlorom</code>: Switch to ExLoROM mapping mode.</li>
<li><a name="a3"></a><code>exhirom</code>: Switch to ExHiROM mapping mode.</li>
<li><a name="a4"></a><code>sa1rom [num, num, num, num]</code>: Switch to hybrid SA-1 mapping mode. To tell which banks are mapped in (maximum is 7) use the optional parameter, like so: <code>sa1rom 0,1,4,6</code>. The default is 0,1,2,3.</li>
<li><a name="a5"></a><code>fullsa1rom</code>: Switch to full SA-1 mapping mode.</li>
<li><a name="a6"></a><code>sfxrom</code>: Switch to Super FX mapping mode.</li>
<li><a name="a7"></a><code>norom</code>: Disable Asar's address translation; the SNES address is equal to the PC address. Can be combined with <code>base</code> and macros to implement your own address translation.</li>
</ul>
<p>When no mapping mode is specified, Asar tries to determine the mapping mode from the output ROM. If that isn't possible, Asar defaults to <code>lorom</code>.</p>
<pre><code class="language-asar">lorom
org $008000
db $FF      ; Will write to PC address 0x000000

hirom
org $008000
db $FF      ; Will write to PC address 0x008000
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compatibility-settings"><a class="header" href="#compatibility-settings">Compatibility Settings</a></h1>
<p>Compatibility settings determine how Asar operates in certain situations. They can be changed via a number of commands.</p>
<h2 id="asar-1"><a class="header" href="#asar-1"><code>asar</code></a></h2>
<p><a name="a0"></a></p>
<pre><code class="language-asar">asar {ver}
</code></pre>
<p>The <code>asar</code> command can be used to specify the minimum Asar version your patch is compatible with. The <code>ver</code> parameter specifies the minimum required Asar version. When a user tries to assemble the patch in an older version of Asar, an error will be thrown, stating that the used Asar version is too old. This should be the first command in your patch, otherwise an error will be thrown.</p>
<pre><code class="language-asar">; This patch uses features from Asar 1.40, so it makes sense to require it as a minimum.
asar 1.40

if readfile1(&quot;data.bin&quot;, 0) == 1
    ; Do something
else
    ; Do something else
endif
</code></pre>
<h2 id="namespace-nested"><a class="header" href="#namespace-nested"><code>namespace nested</code></a></h2>
<p><a name="a1"></a></p>
<pre><code class="language-asar">namespace nested {on/off}
</code></pre>
<p>The <code>namespace nested</code> command enables (<code>on</code>) or disables (<code>off</code>) nested namespaces. The default is <code>off</code>. See section <a href="./namespaces.html">Namespaces</a> for details.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="code-formatting-and-syntax"><a class="header" href="#code-formatting-and-syntax">Code Formatting and Syntax</a></h1>
<h2 id="encoding"><a class="header" href="#encoding">Encoding</a></h2>
<p>Asar expects all source files to be UTF-8-encoded and will throw an error when detecting any other encoding.</p>
<h2 id="comments"><a class="header" href="#comments">Comments</a></h2>
<p>You can use <code>;</code> to add comments to your code, making it easier to read and understand for other people. Everything from the <code>;</code> to the end of the line is silently ignored by Asar.</p>
<pre><code class="language-asar">    lda $00        ; Asar only sees the lda $00 and ignores everything else
</code></pre>
<p>There are also multiline comments, which are started with <code>;[[</code> and ended with <code>]]</code>:</p>
<pre><code class="language-asar">lda $00   ;[[ this is a comment
still a comment
more comment ]] : lda $01
</code></pre>
<h2 id="brackets"><a class="header" href="#brackets">Brackets</a></h2>
<p>Brackets, <a name="a0"></a><code>{</code> and <a name="a1"></a><code>}</code>, may be used to help organize your code structurally. They're treated as commands by the assembler, which means they follow the same rules as other commands, but they otherwise have no effect on code assembly and are silently ignored. Since brackets have no effect on code assembly, they don't even have to match, either. It's entirely up to the coder whether, how and in what quantity brackets are used.</p>
<pre><code class="language-asar">    lda $00
    beq .IsZero
    
.GreaterThanZero
    {
        dec $00
    }

.IsZero
    rts
</code></pre>
<h2 id="multi-line-operators"><a class="header" href="#multi-line-operators">Multi-Line Operators</a></h2>
<p>The <code>,</code> and the <code>\</code> operator are formatting operators which make it possible to split commands in Asar into multiple lines. Both are put at the end of a line and work very similarly with only one key difference. During execution, Asar will concatenate subsequent lines to lines ending with either operator and treat them as a single line. When using the comma operator, the comma itself will actually remain a part of the concatenated string, whereas when using the backslash operator, the backslash itself will be removed from the concatenated string. When using the backslash operator, please note that all whitespace following it is ignored, whereas all whitespace preceeding it is preserved. This is by design, since some commands in Asar require spaces to work, whereas other commands (like math commands) only work without spaces.</p>
<pre><code class="language-asar">%some_macro(!arg1, !arg2, !arg3,
    !arg4, !arg5, !arg6)
; This will be treated as &quot;%some_macro(!arg1, !arg2, !arg3, !arg4, !arg5, !arg6)&quot;

lda \
    $7F0000
; This will be treated as &quot;lda $7F0000&quot;

function func(param) = ((param*param)+1000)\
    /256
; This will be treated as &quot;function func(param) = ((param*param)+1000)/256&quot;
</code></pre>
<h2 id="single-line-operator"><a class="header" href="#single-line-operator">Single-Line Operator</a></h2>
<p>Contrary to the multi-line operators, the single-line operator <code>:</code> is a formatting operator which makes it possible to treat a single line of code as multiple lines. It requires a space before and after usage to differentiate it from the : used with certain commands. When used between different commands, Asar interprets it similarly to a new line and treats each command as being on a separate line. This can be used to link multiple commands together into functional blocks and make the code more readable.</p>
<pre><code class="language-asar">lda #$00 : sta $00
        
; Treated as:
lda #00
sta $00
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="program-counter"><a class="header" href="#program-counter">Program Counter</a></h1>
<p>The program counter (short: pc) refers to the position in the ROM at which Asar currently writes assembled code and/or data. It advances automatically whenever Asar writes to the ROM and is affected by the current <a href="./mapping-modes.html">mapping mode</a>, as well as a number of special commands. Note that all commands affecting the pc that take an address expect an SNES address and thus are also affected by the current mapping mode.</p>
<h2 id="org"><a class="header" href="#org"><code>org</code></a></h2>
<p><a name="a0"></a></p>
<pre><code class="language-asar">org {snes_address}
</code></pre>
<p>The org command directly sets the pc to <code>snes_address</code>. Most commonly used inside patches to specify which code to hijack or which data to overwrite.</p>
<pre><code class="language-asar">org $008000
MainEntryPoint:
    ; ...
</code></pre>
<h2 id="base"><a class="header" href="#base"><code>base</code></a></h2>
<p><a name="a1"></a></p>
<pre><code class="language-asar">base {snes_address/off}
</code></pre>
<p>The base command makes Asar act as though the pc was currently set to <code>snes_address</code> without actually setting it; <code>base off</code> deactivates this behavior. This can be useful for writing code that you plan to execute from another location (such as RAM).</p>
<pre><code class="language-asar">org $008000
MainEntryPoint:
    ; Some code which copies SomeRamRoutine to $7E0000 goes here
    ; ...
    jsl $7E0000
    ; ...

SomeRamRoutine:
base $7E0000
    ; ...
base off
    rtl
</code></pre>
<h2 id="skip"><a class="header" href="#skip"><code>skip</code></a></h2>
<p><a name="a2"></a></p>
<pre><code class="language-asar">skip {num_bytes}
skip align {alignment} [offset {offset}]
</code></pre>
<p>The skip command moves the pc by <code>num_bytes</code> bytes. By specifying a negative value, the pc can be moved backwards. When <code>alignment</code> is given, skips to the next multiple of <code>alignment</code>, plus <code>offset</code> if it is specified. Note that the alignment must be a power of 2, if specified. Offset can also be negative, in that case it's treated exactly like <code>alignment+offset</code>. The seeked-to position will always be after the current SNES position, but it might be before the next multiple of <code>alignment</code>: see the last example.</p>
<pre><code class="language-asar">org $008000
skip 5
; pc is now at $008005
skip -1
; pc is now at $008004
skip align 16
; pc is now at $008010
skip align 16 offset 5
; pc is now at $008015
skip align $20 offset $17
; pc is now at $008017
</code></pre>
<h2 id="bank"><a class="header" href="#bank"><code>bank</code></a></h2>
<p><a name="a3"></a></p>
<pre><code class="language-asar">bank {data_bank/noassume/auto}
</code></pre>
<p>The bank command makes Asar's label optimizer act as though the current data bank was set to <code>data_bank</code>. Consider the following example:</p>
<pre><code class="language-asar">bank $FF
        
lda DataTable,x

DataTable:
    db $01,$02,$03,$04
</code></pre>
<p>Asar will always assemble the <code>lda DataTable,x</code> with 24-bit addressing, unless the current pc (or <a href="program-counter.html#base">base address</a>) is inside bank <code>$FF</code> itself. This is intended for code that uses a data bank register different from the code bank register. You can use <code>bank noassume</code> to make Asar act as though the data bank was always in a different bank. Using <code>bank auto</code> restores the default behavior of assuming that the data bank register and the code bank register are the same. Note that the bank command can't point to freespace areas.</p>
<pre><code class="language-asar">org $008000
phb
lda #$FF
pha
plb

bank $FF
; ...
bank auto

plb
</code></pre>
<h2 id="dpbase"><a class="header" href="#dpbase"><code>dpbase</code></a></h2>
<p><a name="a4"></a></p>
<pre><code class="language-asar">dpbase {snes_address}
</code></pre>
<p>The <code>dpbase</code> command makes Asar's label optimizer assume the Direct Page register is set to the specified address. When used with the <code>optimize dp</code> command, this will cause Asar to use 8-bit addressing where possible. For example, in the following code Asar can assemble <code>lda SpriteTable,x</code> as a direct page address.</p>
<pre><code class="language-asar">SpriteTable = $7E0200
dpbase $0200
optimize dp ram

org $008000
lda SpriteTable,x
</code></pre>
<h2 id="optimize-dp"><a class="header" href="#optimize-dp"><code>optimize dp</code></a></h2>
<p><a name="a5"></a></p>
<pre><code class="language-asar">optimize dp {none/ram/always}
</code></pre>
<p>This command changes how aggressive Asar's direct page access optimizer is. With <code>optimize dp none</code> (the default), the direct page optimizer is disabled and direct page accesses will only be done with the <code>.b</code> instruction suffix or with explicit addresses like <code>lda $42</code>. With <code>optimize dp ram</code>, direct page optimization will be performed according to the <a href="program-counter.html#dpbase">dpbase</a> setting, but only on labels in bank <code>$7E</code>. With <code>optimize dp always</code>, direct page optimization will be performed on all labels in banks that have RAM mirrors, i.e. 00-3F and 80-BF, and also on labels in bank 7E.</p>
<h2 id="optimize-address"><a class="header" href="#optimize-address"><code>optimize address</code></a></h2>
<p><a name="a6"></a></p>
<pre><code class="language-asar">optimize address {default/ram/mirrors}
</code></pre>
<p>This command changes how aggressive Asar's label optimizer is. With <code>optimize address default</code>, references to labels will be shortened to 2 bytes only if the label is in the current data bank. With <code>optimize address ram</code>, additionally labels between <code>$7E:0000-$7E:1FFF</code> will be shortened to 2 bytes if the current data bank has RAM mirrors (<code>$00-$3F</code> and <code>$80-$BF</code>). With <code>optimize address mirrors</code>, additionally labels between <code>$00-3F:2000-7FFF</code> (that is, <code>$00:2000-$00:7FFF</code> all the way up to <code>$3F:2000-$3F:7FFF</code>) will be shortened to 2 bytes whenever the current data bank has RAM mirrors. Note that in <a href="program-counter.html#freespace">freespace</a>, the current bank will be assumed from whether the freespace was started as <code>freecode</code> or <code>freedata</code>, not where the freespace was actually placed in the end.</p>
<h2 id="pushpc--pullpc"><a class="header" href="#pushpc--pullpc"><code>pushpc</code> / <code>pullpc</code></a></h2>
<p>The <a name="a7"></a><code>pushpc</code> command pushes the current pc to the stack, the <a name="a8"></a><code>pullpc</code> command restores the pc by pulling its value from the stack. This can be useful for inserting code in another location and then continuing at the original location.</p>
<pre><code class="language-asar">org $008000
        
Main:
    jsl CodeInAnotherBank

pushpc
org $018000

CodeInAnotherBank:
    ; ...
    rtl
    
pullpc

bra Main
</code></pre>
<h2 id="pushbase--pullbase"><a class="header" href="#pushbase--pullbase"><code>pushbase</code> / <code>pullbase</code></a></h2>
<p>The <a name="a9"></a><code>pushbase</code> command pushes the current base to the stack, the <a name="a10"></a><code>pullbase</code> command restores the base by pulling its value from the stack.</p>
<pre><code class="language-asar">base $7E2000
        
InsideRam:
    jsl OutsideOfRam
    ; ...

pushbase
pushpc
base off

freecode

OutsideOfRam:
    ; ...
    jsl InRamAgain
    rtl

pullpc
pullbase

InRamAgain:
    ; ...
    rtl

base off
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="math"><a class="header" href="#math">Math</a></h1>
<p>Math is supported in all opcodes, functions and labels. Asar applies the conventional operator prioritization rules (PEMDAS) in math expressions and supports parentheses for explicit control over the order of operations.</p>
<pre><code class="language-asar">lda #5+6*2      ; the same as &quot;lda #17&quot;
lda #(5+6)*2    ; the same as &quot;lda #22&quot;
</code></pre>
<p>Math statements in Asar support the following operators:</p>
<div class="table-wrapper"><table><thead><tr><th>Op</th><th>Action</th></tr></thead><tbody>
<tr><td><code>+</code></td><td>Addition (Also valid as prefix, but a no-op)</td></tr>
<tr><td><code>-</code></td><td>Subtraction (Or negation prefix)</td></tr>
<tr><td><code>*</code></td><td>Multiplication</td></tr>
<tr><td><code>/</code></td><td>Division</td></tr>
<tr><td><code>%</code></td><td>Modulo (the remainder of a division, fmod() in C)</td></tr>
<tr><td><code>&lt;&lt;</code></td><td>Left-shift ( <code>x &lt;&lt; y</code> formula: x = x * 2^y )</td></tr>
<tr><td><code>&gt;&gt;</code></td><td>Right-shift ( <code>x &gt;&gt; y</code> formula: x = x / 2^y )</td></tr>
<tr><td><code>&amp;</code></td><td>Bitwise AND</td></tr>
<tr><td><code>|</code></td><td>Bitwise OR</td></tr>
<tr><td><code>^</code></td><td>Bitwise XOR (Note: not exponentials)</td></tr>
<tr><td><code>~</code></td><td>Bitwise NOT (Prefix)</td></tr>
<tr><td><code>&lt;:</code></td><td>Bitshift right 16, shorthand for isolating address bank (Prefix)</td></tr>
<tr><td><code>**</code></td><td>Exponentials (2**4 = 2*2*2*2 = pow(2, 4) in C)</td></tr>
</tbody></table>
</div>
<p>Note that whitespace is not supported inside math statements (ed: in asar 2 it is. kinda.), but the <a href="./formatting.html#multi-line-operators">multi-line operator <code>\</code></a> can be used to split them into multiple lines. Using math in labels can be useful when you want to apply an offset to the label:</p>
<pre><code class="language-asar">lda .Data+3    ; Will load $03 into A
        
.Data
    db $00,$01,$02
    db $03,$02,$03
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="labels"><a class="header" href="#labels">Labels</a></h1>
<p>Labels are used to represent a position in the ROM and allow you to code without having to constantly update branches and jumps/calls. They can be used with any opcode, but were specifically designed to be used with branches, jumps, calls, pointer tables etc. When used with branches, they're automatically converted to offsets.</p>
<h2 id="main-labels"><a class="header" href="#main-labels">Main Labels</a></h2>
<pre><code class="language-asar">[#]{identifier}:
</code></pre>
<p>Main labels are the top-most level of labels supported by Asar. They're global and thus can be directly acessed from anywhere. Their identifier can contain any of the following characters: <code>a-z A-Z 0-9 _</code></p>
<pre><code class="language-asar">org $008000

Main:
    %do_frame()
    jmp Main    ; Equal to jmp $8000
</code></pre>
<p>An alternate form of defining main labels is by directly assigning a value to them. A common use-case for this is to make a label point to an existing address inside a ROM. Syntax:</p>
<pre><code class="language-asar">{identifier} = {snes_address}
</code></pre>
<p>where <code>snes_address</code> can be a number or any math statement evaluating to an SNES address. Note that defining a main label this way does not start a new <a href="labels.html#sub-labels">sub label</a> group.</p>
<pre><code class="language-asar">Main:
; ...

SomewhereInRom = $04CA40

.Sub:
; ...

Table:
    dl Main_Sub                 ; Okay!
    dl SomewhereInRom_Sub       ; Error, label not found
</code></pre>
<p>Prefixing a label definition (except label assignments) with a <code>#</code> will define the label without modifying existing label hierarchies. This can be useful for defining global routines inside call-anywhere macros without having them break existing label hierarchies.</p>
<pre><code class="language-asar">macro my_new_routine()
    jsl MyNewRoutine
            
    !macro_routine_defined ?= 0
    
    if !macro_routine_defined == 0
        pushpc
        
        freecode cleaned
        
        #MyNewRoutine:
            incsrc routines/mynewroutine.asm
        
        pullpc
    
        !macro_routine_defined = 1
    endif
endmacro

Main:
    %my_new_routine()
.Sub

    ; Both of these are found
    dl MyNewRoutine
    dl Main_Sub
</code></pre>
<p>Asar includes a label optimizer which attempts to optimize performance by shortening opcodes accessing labels from 24-bit to 16-bit whenever possible. See section <a href="./program-counter.html#optimize-address">Program Counter</a> for details.</p>
<h2 id="sub-labels"><a class="header" href="#sub-labels">Sub Labels</a></h2>
<pre><code class="language-asar">[#].{identifier}[:]
</code></pre>
<p>Sub labels are the second-most level of labels supported by Asar. They're local to the last main label declared and their identifiers can contain the same characters as main labels.</p>
<pre><code class="language-asar">Proc1:
    nop
.Sub
    bra .Sub

Proc2:
    nop
.Sub:   ; Note that the colon is optional
    bra .Sub
</code></pre>
<p>Sub labels allow you to reuse redundantly named labels such as Loop, End, etc. without causing label redefinition errors. A new sub label group is automatically started after a main label is declared. Internally, sub labels are converted to <code>MainLabel_SubLabel</code>, which can be used to access them from anywhere.</p>
<pre><code class="language-asar">Main1:
    ; ...
.Sub1:
    ; ...
.Sub2:
    ; ...
    
Main2:
    ; ...
.Sub1:
    ; ...
.Sub2:
    ; ...
    
Table:
    dl Main1_Sub1
    dl Main1_Sub2
    dl Main2_Sub1
    dl Main2_Sub2
</code></pre>
<p>Sub labels can themselves contain sub labels to an arbitrary depth by prepending additional dots.</p>
<pre><code class="language-asar">Main1:
; ...
.Sub:
; ...
..Deeper:
; ...
...TheEnd:
; ...

Table:
    dl Main1_Sub_Deeper_TheEnd
</code></pre>
<p>Prefixing a sub label definition with a <code>#</code> will define the sub label without modifying existing label hierarchies, but there is probably no practical use for this and it's unintuitive, so it should be avoided.</p>
<h2 id="--labels"><a class="header" href="#--labels">+/- Labels</a></h2>
<pre><code class="language-asar">+[+...][:]

-[-...][:]
</code></pre>
<p>+/- labels are a special type of labels that are different from both main labels and sub labels in that they don't refer to a specific location in code, but rather to a location relative from where they are used. When used inside opcodes etc., <code>+</code> always refers to the next + label and <code>-</code> always refers to the previous - label. You can also chain an arbitrary number of + or an arbitrary number of - to create unique +/- labels that don't overwrite labels with a different number of +/-, for example <code>+++</code> or <code>-----</code>.</p>
<pre><code class="language-asar">    ldx.b #4
        
--              ; A
    lda $10,x
    beq +       ; Branches to &quot;C&quot;
        
    ldy.b #8
    
-               ; B
    %do_something()
    
    dey
    bne -       ; Branches to &quot;B&quot;
    
+:              ; C - note that +/- labels can also include an optional colon in their declaration
    dex
    bpl --      ; Branches to &quot;A&quot;
</code></pre>
<p>+/- labels are useful in a number of situations. For example: inside a long routine with multiple short loops, where even a sub label like <code>.Loop</code> would get repetitive. +/- labels aren't bound to any scope, which means they can technically be used across different scopes. Just like sub labels, +/- labels are converted to main labels internally. Unlike sub labels, they can not be referenced from code directly since their names depend on where in the code they're used, making it impractical to directly refer to them. This is by design. They can, however, be accessed via the Asar DLL API, and their full name may appear in error messages printed by Asar. The naming format used for them is <code>:pos_x_y</code> for + labels and <code>:neg_x_y</code> for - labels, where <code>x</code> = number of chained +/- and <code>y</code> = instance of this label within all +/- labels of the same name (starting from 0 for + labels and from 1 for - labels).</p>
<pre><code class="language-asar">lorom
org $008000

---         ; :neg_3_1
-           ; :neg_1_1
    bra -
--          ; :neg_2_1
-           ; :neg_1_2
    bra ---
    bra --
    bra -
    
    bra ++
    bra +
    bra +++
    
++          ; :pos_2_0
+           ; :pos_1_0
    bra ++
++          ; :pos_2_1
+++         ; :pos_3_0
</code></pre>
<h2 id="macro-labels"><a class="header" href="#macro-labels">Macro Labels</a></h2>
<pre><code class="language-asar">[#]?{identifier}:

?{identifier} = {snes_address}

[#]?.{identifier}[:]

?+[+...]

?-[-...]
</code></pre>
<p>Macro labels are special variations of the labels mentioned in the previous sections. Functionally, they behave the same as the other labels with the exception of being local to the macro they're used in. This means they can't be referenced from outside the respective macro. Macro labels are created by prefixing any of the other label types with a <code>?</code> .</p>
<pre><code class="language-asar">macro do_something()
    ?MacroMainLabel:
    ?.MacroSubLabel
    ?-
        ; All of these are fine!
        dl ?MacroMainLabel
        dl ?.MacroSubLabel
        dl ?-
        dl ?+
        dl ?MacroMainLabel_MacroSubLabel
    ?+
endmacro

%do_something()

; ERROR! ?MacroMainLabel is undefined, because we're not inside %do_something() anymore.
dl ?MacroMainLabel
</code></pre>
<p>Prefixing a macro label definition (except for macro label assignments and macro +/- labels) with a <code>#</code> will define the macro label without modifying existing label hierarchies, but there is probably no practical use for this, so it should be avoided. Like all other labels, macro labels are converted to main labels internally and prefixed with an identifier of <code>:macro_x_</code> where <code>x</code> = total macro call count. They can't be referenced in code directly, except inside their respective macro and using the respective macro label syntax seen above. They can, however, be accessed via the Asar DLL API, and their full name may appear in error messages printed by Asar.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="structs"><a class="header" href="#structs">Structs</a></h1>
<p>Structs are an advanced form of labels with the purpose of making access into structured data blocks easier. The general syntax is as follows</p>
<p><a name="a0"></a><a name="a1"></a></p>
<pre><code class="language-asar">struct {identifier} {snes_address}
    [label...]
endstruct [align {num}]
</code></pre>
<p>where <code>identifier</code> can contain any of the following characters:<br />
<code>a-z A-Z 0-9 _</code><br />
The <code>snes_address</code> parameter can be any number literal or math statement evaluating to an SNES address. This address marks the start of the struct. The <code>label</code> parameter should be any number of labels, ideally coupled with skip commands. These labels become offsets into the struct. Internally, the struct command will do something similar to this</p>
<pre><code class="language-asar">pushpc
base snes_address
</code></pre>
<p>whereas the endstruct command will do something similar to this</p>
<pre><code class="language-asar">base off
pullpc
</code></pre>
<p>Take a look at the simple example below:</p>
<pre><code class="language-asar">struct ObjectList $7E0100
    .Type: skip 1
    .PosX: skip 2
    .PosY: skip 2
    .SizeX: skip 1
    .SizeY: skip 1
endstruct
</code></pre>
<p>This defines a struct called <code>ObjectList</code> at location <code>$7E0100</code> with a size of <code>7</code> (the sum of all skip commands). You can access into this struct like so:</p>
<pre><code class="language-asar">lda ObjectList.PosY
</code></pre>
<p>This is equal to:</p>
<pre><code class="language-asar">lda $7E0103     ; $7E0100+1+2
</code></pre>
<p>The final address is calculated by taking the start of the struct (<code>$7E0100</code>) and adding to that all the skips preceding the <code>.PosY</code> label (<code>1</code> and <code>2</code>). Aside from accessing structs directly, it's also possible to access them as arrays. A simple example:</p>
<pre><code class="language-asar">lda ObjectList[2].PosY
</code></pre>
<p>The final address in this case is calculated by the equation:<br />
<code>struct_start + (array_index * struct_size) + label_offset</code><br />
So in this case, our final address is <code>$7E0100 + (2 * 7) + (1 + 2) = $7E0111</code>. When using structs this way, the optional <code>align</code> parameter becomes relevant. This parameter controls the struct's alignment. Simply put, when setting a struct's alignment, Asar makes sure that its size is always a multiple of that alignment, increasing the size as necessary to make it a multiple. Let's take another look at the example above with an added alignment:</p>
<pre><code class="language-asar">struct ObjectList $7E0100
    .Type: skip 1
    .PosX: skip 2
    .PosY: skip 2
    .SizeX: skip 1
    .SizeY: skip 1
endstruct align 16
</code></pre>
<p>With an alignment of 16 enforced, this struct's size becomes 16 (the first multiple of 16 that 7 bytes fit into). So when accessing the struct like this</p>
<pre><code class="language-asar">lda ObjectList[2].PosY
</code></pre>
<p>the final address becomes <code>$7E0100 + (2 * 16) + (1 + 2) = $7E0123</code>. If we add some data into the struct</p>
<pre><code class="language-asar">struct ObjectList $7E0100
    .Type: skip 1
    .PosX: skip 2
    .PosY: skip 2
    .SizeX: skip 1
    .SizeY: skip 1
    .Properties: skip 10
endstruct align 16
</code></pre>
<p>its original size becomes 17. Since a final size of 16 would now be too small to contain the entire struct, the alignment instead makes the struct's final size become 32 (the first multiple of 16 that 17 bytes fit into), so in our example of</p>
<pre><code class="language-asar">lda ObjectList[2].PosY
</code></pre>
<p>we now end up with a final address of <code>$7E0100 + (2 * 32) + (1 + 2) = $7E0143</code>.</p>
<h2 id="extending-structs"><a class="header" href="#extending-structs">Extending structs</a></h2>
<p>Another feature that is unique to structs is the possibility of extending previously defined structs with new data. The general syntax for this is as follows:</p>
<p><a name="a2"></a></p>
<pre><code class="language-asar">struct {extension_identifier} extends {parent_identifier}
    [label...]
endstruct [align {num}]
</code></pre>
<p>This adds the struct <code>extension_identifier</code> at the end of the previously defined struct <code>parent_identifier</code>. Consider the following example:</p>
<pre><code class="language-asar">struct ObjectList $7E0100
    .Type: skip 1
    .PosX: skip 2
    .PosY: skip 2
    .SizeX: skip 1
    .SizeY: skip 1
endstruct

struct Properties extends ObjectList
    .Palette: skip 1
    .TileNumber: skip 2
    .FlipX: skip 1
    .FlipY: skip 1
endstruct
</code></pre>
<p>The struct <code>ObjectList</code> now contains a child struct <code>Properties</code> which can be accessed like so:</p>
<pre><code class="language-asar">lda ObjectList.Properties.FlipX
</code></pre>
<p>Since extension structs are added at the end of their parent structs, the offset of <code>.FlipX</code> in this example is calculated as<br />
<code>parent_struct_start_address + parent_struct_size + extension_struct_label_offset</code>,<br />
in other words, our final address is <code>$7E0100 + 7 + (1 + 2) = $7E0109</code>. Note that extending a struct also changes its size, so in this example, the final size of the <code>ObjectList</code> struct becomes 12. Extended structs can also be accessed as arrays. This works on the parent struct, as well as the extension struct.</p>
<pre><code class="language-asar">lda ObjectList[2].Properties.FlipX
</code></pre>
<pre><code class="language-asar">lda ObjectList.Properties[2].FlipX
</code></pre>
<p>In the first example, our final address is calculated as<br />
<code>parent_struct_start_address + (combined_struct_size * array_index) + parent_struct_size + extension_struct_label_offset</code>,<br />
whereas in the second example, it's calculated as<br />
<code>parent_struct_start_address + parent_struct_size + (extension_struct_size * array_index) + extension_struct_label_offset</code>,<br />
so we end up with final addresses of <code>$7E0100 + (12 * 2) + 7 + (1 + 2) = $7E0122</code> and <code>$7E0100 + 7 + (5 * 2) + (1 + 2) = $7E0114</code>.</p>
<p>A few further things to note when using structs in Asar:</p>
<!-- TODO: the first point sounds like the exact use case of extension structs tho?? should re-word this -->
<ul>
<li>It's possible to extend a single struct with multiple extension structs. However, this can be counter-intuitive. The size of the extended struct becomes the size of the parent struct plus the size of its largest extension struct, rather than the size of the parent struct plus the sizes of each of its extension structs. This also means that when accessing those extension structs, they all start at the same offset relative to the parent struct. This can be confusing and is often not what's actually intended, so for code clarity, it's recommended to only extend structs with at most a single other struct.</li>
<li>It's possible to enforce alignments when using extension structs. However, this will only determine the alignment of the parent struct and/or the extension struct(s), depending on where it's specified. It won't determine the alignment of the combined struct. This can be confusing and is usually not what is intended. There currently is no universal workaround for this, so when a certain alignment is required for a struct, it's recommended to not use extension structs with it.</li>
<li>It's not possible to access both, a parent struct and its extension struct, as arrays simultanously.</li>
<li>An extension struct can't be extended itself.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="namespaces"><a class="header" href="#namespaces">Namespaces</a></h1>
<p><a name="a0"></a></p>
<pre><code class="language-asar">namespace {identifier}
namespace off
</code></pre>
<p>Namespaces are a feature which makes it easier to avoid name conflicts between different labels without having to give them long or cryptic names. They work similarly to C++ namespaces and accomplish this by automatically adding a prefix to all labels declared or accessed within them. This prefix consists of an identifier, followed by an underscore <code>_</code> . Namespaces can be stacked if desired by enabling the <a href="./compat.html#namespace-nested"><code>namespace nested</code></a> setting. When you try to access a label from within a namespace and Asar doesn't find it in there, it automatically looks in the upper namespaces (up to the global namespace).</p>
<p>Use <code>namespace {identifier}</code> to enter a namespace, where <code>identifier</code> can contain any of the following characters: <code>a-z A-Z 0-9 _</code></p>
<p>Use <code>namespace off</code> to leave the current namespace (or immediately return to the global namespace when nested namespaces are not enabled).</p>
<pre><code class="language-asar">; All of the below is valid

namespace nested on

Main:                           ; Main
Main2:                          ; Main2

namespace Deep

    Main:                       ; Deep_Main
    
    namespace Deeper
    
        Main:                   ; Deep_Deeper_Main
        Main3:                  ; Deep_Deeper_Main3
        
        namespace Deepest
            
            Main:               ; Deep_Deeper_Deepest_Main
            
            dl Main             ; Deep_Deeper_Deepest_Main
            dl Main2            ; Main2
            dl Main3            ; Deep_Deeper_Main3
            
        namespace off
            
        dl Main                 ; Deep_Deeper_Main

    namespace off
            
    dl Main                     ; Deep_Main
    
namespace off


namespace nested off

namespace TheFirst

    Main:                       ; TheFirst_Main
    
    dl Main                     ; TheFirst_Main
    
namespace TheSecond

    Main:                       ; TheSecond_Main
    
    dl Main                     ; TheSecond_Main
    
namespace TheThird

    Main:                       ; TheThird_Main
    
    dl Main                     ; TheThird_Main
    
namespace off


dl Main                         ; Main
dl Deep_Main                    ; Deep_Main
dl Deep_Deeper_Main             ; Deep_Deeper_Main
dl Deep_Deeper_Deepest_Main     ; Deep_Deeper_Deepest_Main

dl TheFirst_Main                ; TheFirst_Main
dl TheSecond_Main               ; TheSecond_Main
dl TheThird_Main                ; TheThird_Main
</code></pre>
<h2 id="pushns--pullns"><a class="header" href="#pushns--pullns"><code>pushns</code> / <code>pullns</code></a></h2>
<p><a name="a1"></a><code>pushns</code> saves the current namespace. <a name="a2"></a><code>pullns</code> restores the last-pushed value of the namespace.</p>
<h2 id="global-labels"><a class="header" href="#global-labels">Global labels</a></h2>
<p>While in a namespace, you can use the keyword <code>global</code> to define labels outside all namespaces. The syntax is <a name="a3"></a><code>global [#]{identifier}:</code>. For example:</p>
<pre><code class="language-asar">
namespace NS
global GlobalLabel:
.Sub: ; this is a sublabel of GlobalLabel

LocalLabel:

global #AnotherGlobal: ; this global won't modify the sublabel hierarchy

.Sub: ; this is a sublabel of LocalLabel
namespace off

; these are all valid:
dl NS_LocalLabel
dl NS_LocalLabel_Sub
dl GlobalLabel
dl GlobalLabel_Sub
dl AnotherGlobal

</code></pre>
<p>Note that <code>#</code> acts the same way as it does for regular labels. Note that you cannot use the <code>global</code> command with sublabels or macro labels. Outside of a namespace, <code>global</code> acts just like a regular label definition.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="defines"><a class="header" href="#defines">Defines</a></h1>
<p>Asar supports a define system that functions similarly to defines in other programming languages, such as C++. Defines are identifiers that you can assign any kind of text to and use in other places as substitues for that text. During compilation, Asar replaces each define it encounters with the respective text assigned to it. Defines are prefixed with a <code>!</code> and declared as follows:</p>
<p><a name="a0"></a></p>
<pre><code class="language-asar">!{identifier} = {value}
!{identifier} = &quot;{value}&quot;
</code></pre>
<p>where <code>identifier</code> is a unique identifier that can contain any of the following characters: <code>a-z A-Z 0-9 _</code></p>
<p>The space on both sides of the = is required, which means that <code>!identifier=value</code> will not work. Since defines are really just placeholders for text, they can contain anything - labels, math formulas, even other defines.</p>
<pre><code class="language-asar">!x = $00
        
lda !x        ; Treated as &quot;lda $00&quot;
lda #!x       ; Treated as &quot;lda #$00&quot;
lda [!x],y    ; Treated as &quot;lda [$00],y&quot;

!y = 34
!x = $12!y
        
lda !x        ; Treated as &quot;lda $1234&quot;
        
!phr = &quot;pha : phx : phy&quot;
        
!phr          ; Treated as &quot;pha : phx : phy&quot;
</code></pre>
<p>To assign text containing whitespace to a define, you must delimit it with two <code>&quot;</code> as shown above with !phr. Besides the regular define operator <code>=</code>, Asar also supports a number of additional define operators with slightly different functionality.</p>
<div class="table-wrapper"><table><thead><tr><th>Operator</th><th>Functionality</th></tr></thead><tbody>
<tr><td><code>=</code></td><td>The standard define operator. Directly assigns text to a define.</td></tr>
<tr><td><code>+=</code></td><td>Appends text to the current value of a define.</td></tr>
<tr><td><code>:=</code></td><td>Equal to the standard <code>=</code>, but resolves all defines in the text to assign before actually assigning it. This makes recursive defines possible.</td></tr>
<tr><td><code>#=</code></td><td>Evalutes the text as though it was a math expression, calculates its result and assigns it to the define. The math is done in-place on the same line the operator is used on.</td></tr>
<tr><td><code>?=</code></td><td>Equal to the standard <code>=</code>, but only assigns text to a define that doesn't exist yet, otherwise does nothing.</td></tr>
</tbody></table>
</div>
<pre><code class="language-asar">!define = 10
!anotherdefine = !define+1
; !define now contains &quot;10&quot; and !anotherdefine now contains &quot;!define+1&quot;
!define = 10
!define += 1
; !define now contains &quot;101&quot;
!define = 10
!define := !define+1
; !define now contains &quot;10+1&quot;
!define = 10
!anotherdefine #= !define+1
; !anotherdefine now contains &quot;11&quot;
!lastdefine ?= 10
!lastdefine ?= 1
; !lastdefine now contains &quot;10&quot;
</code></pre>
<p>Similarly to C's ifdef and undef, Asar allows you to check for a define's existence using the <code>defined(&quot;{identifier}&quot;)</code> function and to delete a define using the <a name="a1"></a><code>undef &quot;{identifier}&quot;</code> command. Make sure to leave the <code>!</code> out of the identifier when using these functions, as Asar would otherwise try to resolve the defines.</p>
<pre><code class="language-asar">!define = &quot;hello&quot;
        
if defined(&quot;define&quot;)
    print &quot;This will be printed!&quot;
endif

undef &quot;define&quot;
        
if defined(&quot;define&quot;)
    print &quot;This won't be printed!&quot;
endif
</code></pre>
<p>Note that Asar tries to replace defines wherever possible, even inside strings. In some occasions, this might be undesirable. See section <a href="./binary.html">Tables</a> for details on how to escape certain characters.</p>
<h2 id="nested-defines"><a class="header" href="#nested-defines">Nested Defines</a></h2>
<p>By default, the define parser in Asar considers every supported character in a connected string to be a part of the define's name. This may not always be desired as it can lead to a certain define becoming inaccessible in a certain situation. In cases like that, the <code>{}</code> operator makes it possible to still use those defines by resovling everything inside the braces immediately.</p>
<pre><code class="language-asar">!hex = $
        
db !hexFF     ; Error - define !hexFF not found
db !{hex}FF   ; OK
</code></pre>
<p>Perhaps the more useful feature of this operator is that it can also be nested to allow for the creation of dynamic define names.</p>
<pre><code class="language-asar">; Please specifiy a mode from 0 to 3
!mode = 1

assert !mode &gt;= 0 &amp;&amp; !mode &lt;= 3, &quot;Please specify a mode from 0 to 3!&quot;

!modename0 = &quot;Default&quot;
!modename1 = &quot;Debug&quot;
!modename2 = &quot;Fast&quot;
!modename3 = &quot;Small&quot;

!modenamestring = !{modename!{mode}}

print &quot;Building in mode: !modenamestring&quot;
</code></pre>
<h2 id="built-in-defines"><a class="header" href="#built-in-defines">Built-in Defines</a></h2>
<p>Aside from user defines, Asar also supports a number of built-in defines. These defines are read-only and any attempt to modify them will throw an error.</p>
<div class="table-wrapper"><table><thead><tr><th>Define</th><th>Details</th></tr></thead><tbody>
<tr><td><code>!assembler</code></td><td>Contains the value <code>asar</code>. Theoretically can be used to differentiate between different assemblers if other assemblers use this define and a syntax similar to Asar.</td></tr>
<tr><td><span style="white-space:pre"><code>!assembler_ver</code></span></td><td>Contains the version number of Asar in the format <code>(major_version * 10000) + (minor_version * 100) + revision</code>. For Asar version 1.60, this contains 10600.</td></tr>
<tr><td><span style="white-space:pre"><code>!assembler_time</code></span></td><td>Contains the current Unix timestamp as an integer (number of seconds since 1970-01-01 00:00:00 UTC).</td></tr>
</tbody></table>
</div>
<pre><code class="language-asar">if not(stringsequal(&quot;!assembler&quot;, &quot;asar&quot;))
    warn &quot;This patch was written for Asar and may not be compatible with your current assembler.&quot;
endif
if !assembler_ver &lt; 10600
    warn &quot;This patch might not behave correctly due to a bug in Asar versions prior to 1.60.&quot;
endif
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="macros"><a class="header" href="#macros">Macros</a></h1>
<p>Macros are a mechanism for recording a sequence of commands that can be used in other places. The main purpose of this is to include commonly used code in multiple places without actually having to rewrite or copy that code every time. Instead you can move it into a macro and write it only once. Macros, in concept, work similarly to defines in that they are a text-replacement mechanism, but they have a few key differences:</p>
<ul>
<li>Macros only record a sequence of commands rather than any kind of text.</li>
<li>A macro call is itself considered a command and thus needs to go on its own line (or separated via the <a href="./formatting.html#single-line-operator">single-line operator <code>:</code></a>). This means that unlike a define, a macro can't just be used whereever.</li>
<li>Macros can include parameters, which are identifiers that are replaced by a text value whenever the respective macro is called. For simplicity, you could consider parameters a macro-specific version of defines.</li>
</ul>
<p>Use the following syntax to define a macro:</p>
<p><a name="a0"></a><a name="a1"></a></p>
<pre><code class="language-asar">macro {identifier}([parameter1_identifier[, parameter2_identifier...]][variadic_token])
    [command1]
    [command2...]
endmacro
</code></pre>
<p>where all the identifiers can contain any of the following characters: <code>a-z A-Z 0-9 _</code></p>
<p>Use the syntax <code>&lt;parameter_identifier&gt;</code> to expand a parameter inside a macro. This works just like placing a <code>!define_identifier</code> anyhwere else in the code. Macros can be recursive (macros calling themselves) and/or nested up to 512 levels deep. This limit only serves the purpose of preventing infinite recursion. The first and last line of the macro definition need to go on their own lines (the <a href="./formatting.html#single-line-operator">single-line operator</a> is not supported here). To call a macro that has already been defined, use the syntax</p>
<pre><code class="language-asar">%{identifier}([parameter1[, parameter2...]])
</code></pre>
<p>where each individual parameter may be wrapped in double quotes (which is required for parameters that contain any whitespace).</p>
<pre><code class="language-asar">macro mov(target, source)
    lda &lt;source&gt;
    sta &lt;target&gt;
endmacro

macro swap(first, second)
    %mov($00, &lt;first&gt;)
    %mov(&lt;first&gt;, &lt;second&gt;)
    %mov(&lt;second&gt;, $00)
endmacro

macro use_x_safely(code)
    phx
    &lt;code&gt;
    plx
endmacro

%swap($01, $02)
%use_x_safely(&quot;ldx $10 : stx $11 : ldx #10 : stx $12&quot;)
</code></pre>
<h2 id="variadic-macros"><a class="header" href="#variadic-macros">Variadic Macros</a></h2>
<p>In addition to named substitutions if the variadic token <code>...</code> is specified as the last parameter asar will allow an arbitrary number of parameters after all prior parameters have been satisfied. To access unnamed parameters of a variadic macro, use the syntax <code>&lt;...[{math}]&gt;</code>, where <code>math</code> is any math expression evaluating to the index of a variadic parameter. These are declared numerically starting from 0 up to the number of provided parameters. To access the number of provided variadic arguments one may use <code>sizeof(...)</code>. Lastly, it is important to note that while traditional macros do not parse defines inside parameters, variadic macros will. This is to allow iteration of arguments by using defines.</p>
<pre><code class="language-asar">macro example0(...)
    db sizeof(...), &lt;...[0]&gt;    ;04 01
endmacro
    
macro example1(...)
    !a #= 0
    while !a &lt; sizeof(...)
        db &lt;...[!a]&gt;        ;01 02 03
        !a #= !a+1
    endwhile
endmacro

macro example2(named_parameter, ...)
    !a #= 0
    while !a &lt; sizeof(...)
        db &lt;...[!a]&gt;        ;02 03 04 05 06 07
        !a #= !a+1
    endwhile
    db &lt;named_parameter&gt;    ;01
endmacro

macro macro_with_optional_arguments(required, ...)
    db &lt;required&gt;
    if sizeof(...) &gt; 0
        db &lt;...[0]&gt;
    endif
endmacro

%example0(1,2,3,4)
%example1(1,2,3)
%example2(1,2,3,4,5,6,7)
%macro_with_optional_arguments(1)
%macro_with_optional_arguments(2, 3)
</code></pre>
<h2 id="nested-macro-definitions"><a class="header" href="#nested-macro-definitions">Nested Macro Definitions</a></h2>
<p>Macro definitions can be nested. Doing this, a few special rules come into play. Normally, macro parameters and defines inside macros are only resolved whenever the respective macro is being called, and macros can only resolve their own parameters. This might be impractical once working with nested macro definitions, so Asar provides a special syntax to control the resolution timing of macro parameters and defines. By prepending a number of <code>^</code> to the respective name, earlier resolution can be forced, called &quot;backwards-resolution&quot;. For example, <code>&lt;^param&gt;</code> will be resolved while the parent macro is being called; <code>!^^define</code> will be resolved while the grand-parent macro is being called, and so forth.</p>
<pre><code class="language-asar">!define_01 = $01
!define_02 = $02

macro threefold_one(shadowed)
    db &lt;shadowed&gt; ; Will be resolved when %threefold_one() is called.
    macro threefold_two(not_shadowed)
        !define_01 = $FF ; Will be resolved when %threefold_two() is called.
        !define_02 = $FF ; Will be resolved when %threefold_two() is called.
        db !define_01 ; Will be resolved when %threefold_two() is called.
        db !^define_02 ; Will be resolved when %threefold_one() is called.
        db &lt;^shadowed&gt; ; Will be resolved when %threefold_one() is called.
        db &lt;not_shadowed&gt;
        macro threefold_three(shadowed)
            db &lt;^^shadowed&gt; ; Will be resolved when %threefold_one() is called.
            db &lt;^not_shadowed&gt; ; Will be resolved when %threefold_two() is called.
            db &lt;shadowed&gt; ; Will be resolved when %threefold_three() is called.
        endmacro
    endmacro
endmacro

%threefold_one($03)
%threefold_two($04)
%threefold_three($05)

; Writes: 03 FF 02 03 04 03 04 05
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="functions"><a class="header" href="#functions">Functions</a></h1>
<p>Functions in Asar can be considered the math equivalent of macros. They are a convenient way of wrapping commonly used math statements, can include parameters and can be called in all places where math is supported. Use the following syntax to define a function:</p>
<p><a name="a0"></a></p>
<pre><code class="language-asar">function {identifier}([param1_name[, param2_name...]]) = {math}
</code></pre>
<p>where all the names can contain any of the following characters: <code>a-z A-Z 0-9 _</code> and where <code>{math}</code> can be any <a href="./math.html">math statement</a> supported by Asar (including the use of other functions). Use a parameter's name to expand it inside a function.</p>
<pre><code class="language-asar">function kilobytes_to_bytes(kb) = kb*1024
function megabytes_to_kilobytes(mb) = mb*1024
function megabytes_to_bytes(mb) = kilobytes_to_bytes(megabytes_to_kilobytes(mb))

; Will print &quot;4 MB = 4194304 bytes.&quot;
print &quot;4 MB = &quot;,dec(megabytes_to_bytes(x)),&quot; bytes.&quot;


function data_index_to_offset(index) = index*2

lda .Data+data_index_to_offset(2)    ; Will load $0002 into A

.Data
    dw $0000
    dw $0001
    dw $0002
</code></pre>
<p>Function definitions must be on a single line and can't include whitespace in their math statements, except when using the <a href="./formatting.html#multi-line-operators">multi-line operator <code>\</code></a>, which can be used to split long function definitions into multiple lines.</p>
<p>Note that user-defined functions can't use string parameters themselves. However, they can take strings as arguments and pass them on to built-in functions.</p>
<pre><code class="language-asar">function readfilenormalized(filename, pos) = readfile4(filename, pos)/2147483648.0
db readfilenormalizd(&quot;datafile.bin&quot;, 0)
</code></pre>
<h2 id="built-in-functions"><a class="header" href="#built-in-functions">Built-in Functions</a></h2>
<p>Aside from user-defined functions mentioned above, Asar also supports a number of built-in functions. Some built-in functions take string parameters, which must be wrapped in double quotes.</p>
<!-- TODO: better way to format this list?? -->
<ul>
<li>
<p><code>read1(pos[, default])</code>, <code>read2(pos[, default])</code>, <code>read3(pos[, default])</code>, <code>read4(pos[, default])</code></p>
<p>Read one/two/three/four byte(s) from the output ROM at SNES location pos. Mainly intended for detecting the presence of certain hijacks/patches in a ROM. Throws an error when given an invalid address, unless the optional parameter default is provided in which case it is returned.</p>
<pre><code class="language-asar">if read1($00FFD5) == $23
    !is_sa1_rom = 1
else
    !is_sa1_rom = 0
endif
</code></pre>
</li>
<li>
<p><code>readfile1(filename, pos[, default])</code>, <code>readfile2(filename, pos[, default])</code>, <code>readfile3(filename, pos[, default])</code>, <code>readfile4(filename, pos[, default])</code></p>
<p>Read one/two/three/four byte(s) from file filename at position pos (see section <a href="./includes.html">Includes</a> for details on Asar's handling of file names). Throws an error when the referenced file doesn't exist or the given position is out-of-bounds, unless the optional parameter default is provided in which case it is returned.</p>
<pre><code class="language-asar">!readresult = readfile4(&quot;datafile.bin&quot;, 0, $FFFFFFFF)
if !readresult != $FFFFFFFF
    print &quot;Read $&quot;,hex(!readresult),&quot; from datafile.bin.&quot;
endif
</code></pre>
</li>
<li>
<p><code>canread1(pos)</code>, <code>canread2(pos)</code>, <code>canread3(pos)</code>, <code>canread4(pos)</code>, <code>canread(pos, num)</code></p>
<p>Returns 1 if reading one/two/three/four/num bytes from the output ROM at SNES location pos would succeed and 0 otherwise.</p>
<pre><code class="language-asar">if canread1($00FFD5) == 1
    print &quot;Detected ROM type: $&quot;,hex(read1($00FFD5))
else
    error &quot;Failed to detect ROM type!&quot;
endif
</code></pre>
</li>
<li>
<p><code>canreadfile1(filename, pos)</code>, <code>canreadfile2(filename, pos)</code>, <code>canreadfile3(filename, pos)</code>, <code>canreadfile4(filename, pos)</code>, <code>canreadfile(filename, pos, num)</code></p>
<p>Returns 1 if reading one/two/three/four/num bytes from file filename at position pos would succeed and 0 otherwise (see section <a href="./includes.html">Includes</a> for details on Asar's handling of file names).</p>
<pre><code class="language-asar">if canreadfile4(&quot;datafile.bin&quot;, 512) == 1
    print &quot;Read $&quot;,hex(readfile4(&quot;datafile.bin&quot;, 512)),&quot; from datafile.bin at position 512.&quot;
else
    error &quot;datafile.bin either doesn't exist or is too small.&quot;
endif
</code></pre>
</li>
<li>
<p><code>filesize(filename)</code></p>
<p>Returns the size of file filename. Throws an error if the file doesn't exist.</p>
<pre><code class="language-asar">!fsize #= filesize(&quot;datafile.bin&quot;)
!fpos = 0

assert !fsize &gt;= 0, &quot;datafile.bin doesn't exist or can't be opened&quot;.
while !fpos &lt; !fsize
    ; Do something with datafile.bin here, like calling readfile1(&quot;datafile.bin&quot;, !fpos)
    ;...
    
    !fpos #= !fpos+1
endwhile
</code></pre>
</li>
<li>
<p><code>getfilestatus(filename)</code></p>
<p>Checks the status of file filename. Returns 0 if the file exists and can be read from, returns 1 if the file doesn't exist and returns 2 if the file exists, but can't be read from for any other reason (like being read-protected, being locked etc.).</p>
<pre><code class="language-asar">assert getfilestatus(&quot;datafile.bin&quot;) != 1, &quot;datafile.bin doesn't seem to exist&quot;
</code></pre>
</li>
<li>
<p><code>sqrt(x)</code></p>
<p>Computes the square root of x.</p>
</li>
<li>
<p><code>sin(x)</code>, <code>cos(x)</code>, <code>tan(x)</code>, <code>asin(x)</code>, <code>acos(x)</code>, <code>atan(x)</code>, <code>arcsin(x)</code>, <code>arccos(x)</code>, <code>arctan(x)</code></p>
<p>Various trigonometric functions. Units are in radians.</p>
</li>
<li>
<p><code>log(x)</code>, <code>log2(x)</code>, <code>log10(x)</code></p>
<p>Logarithmic functions (base-e, base-2 and base-10 respectively).</p>
</li>
<li>
<p><code>snestopc(address)</code>, <code>pctosnes(address)</code></p>
<p>Functions for converting between SNES and PC addresses. Affected by the current <a href="./mapping-modes.html">mapping mode</a>.</p>
<pre><code class="language-asar">print &quot;SNES address $018000 in the current mapping mode is equivalent to PC address 0x&quot;,dec(snestopc($018000))
</code></pre>
</li>
<li>
<p><code>min(a, b)</code>, <code>max(a, b)</code></p>
<p>Return the minimum/maximum of two numbers.</p>
<pre><code class="language-asar">!start_index #= max(!current_index-1, 0)
</code></pre>
</li>
<li>
<p><code>clamp(value, minimum, maximum)</code></p>
<p>Makes sure that value stays within the bounds set by minimum and maximum. Equal to <code>min(max(value, minimum), maximum)</code>.</p>
<pre><code class="language-asar">!used_amount #= clamp(!used_percentage, 0.0, 1.0)*!total_amount
</code></pre>
</li>
<li>
<p><code>safediv(a, b, exception)</code></p>
<p>Returns <code>a/b</code> unless b is 0 in which case exception is returned. Intended for avoiding division by zero errors in functions.</p>
<pre><code class="language-asar">!single_sprite_memory = safediv(!total_sprite_memory, !max_num_sprites, 0)
</code></pre>
</li>
<li>
<p><code>select(statement, true, false)</code></p>
<p>Returns false if statement is 0 and true otherwise. Can be considered an if/else conditional that is usable within functions.</p>
<p>NOTE: Asar always evaluates all parameters of a function before calling it, so if, for example, you pass an expression that divides by zero to select() as true, Asar will throw a division by zero error even if statement evalutes to 0 and thus false would be returned. To work around this, you can use the <code>safediv()</code> function in place of a regular division.</p>
<pre><code class="language-asar">function sprite_size() = select(!extra_bytes_enabled, 16+4, 16)
</code></pre>
</li>
<li>
<p><code>not(value)</code></p>
<p>Returns 1 if value is 0 and 0 in any other case. Useful for negating statements in the <code>select()</code> function.</p>
<pre><code class="language-asar">function required_sprite_memory(num_sprites) = not(!sprites_disabled)*sprite_size()*num_sprites
</code></pre>
</li>
<li>
<p><code>bank(value)</code></p>
<p>Returns <code>value&gt;&gt;16</code></p>
<pre><code class="language-asar">lda #bank(some_label)
</code></pre>
</li>
<li>
<p><code>equal(value, comparand)</code>, <code>notequal(value, comparand)</code>, <code>less(value, comparand)</code>, <code>lessequal(value, comparand)</code>, <code>greater(value, comparand)</code>, <code>greaterequal(value, comparand)</code></p>
<p>Comparison functions. Return 1 if the respective comparison is true and 0 otherwise. Useful as statements in the <code>select()</code> function.</p>
<pre><code class="language-asar">function abs(num) = select(less(num, 0), num*-1, num)
</code></pre>
</li>
<li>
<p><code>and(a, b)</code>, <code>or(a, b)</code>, <code>nand(a, b)</code>, <code>nor(a, b)</code>, <code>xor(a, b)</code></p>
<p>Perform the respective logical operation with a and b. Useful for chaining statements in the <code>select()</code> function.</p>
<pre><code class="language-asar">function total_sprite_extra_bytes(num_sprites) = select(and(not(!sprites_disabled), !extra_bytes_enabled), 4, 0)*num_sprites
</code></pre>
</li>
<li>
<p><code>round(number, precision)</code></p>
<p>Rounds <code>number</code> to <code>precision</code> decimal places. Pass 0 as precision to round to the nearest integer.</p>
<pre><code class="language-asar">if round(!distance, 2) == 0.0
    error &quot;Distance is zero or almost zero. Please choose a bigger value for distance as small values will cause problems.&quot;
endif
</code></pre>
</li>
<li>
<p><code>floor(number)</code>, <code>ceil(number)</code></p>
<p>Rounds a number up (in the case of <code>ceil</code>) or down (in the case of <code>floor</code>) to the nearest integer.</p>
<pre><code class="language-asar">!banks_used #= ceil(!data_size/65536)
</code></pre>
</li>
<li>
<p><code>defined(identifier)</code></p>
<p>Takes an identifier as a string parameter and returns 1 if a define with that identifier exists, 0 otherwise.<br />
NOTE: Don't include the <code>!</code> in the identifier as Asar will otherwise try to expand it as a define before calling the function.</p>
<pre><code class="language-asar">if defined(&quot;include_guard&quot;) == 0
    !include_guard = 1
    ; ...
endif
</code></pre>
</li>
<li>
<p><code>sizeof(identifier)</code></p>
<p>Takes the identifier of a struct as a parameter and returns the base size of that struct (without any extension structs).</p>
<pre><code class="language-asar">struct parent $0000
    .data1: skip 2
endstruct

struct child extends parent
    .data2: skip 3
endstruct

db sizeof(parent)             ; db 2
db sizeof(parent.child)       ; db 3
</code></pre>
</li>
<li>
<p><code>objectsize(identifier)</code></p>
<p>Takes the identifier of a struct as a parameter and returns the object size of that struct. In the case of an extended struct, this will be the base size of the struct plus the size of its largest extension struct. Throws an error if a struct with that name doesn't exist.</p>
<pre><code class="language-asar">struct parent $0000
    .data1: skip 2
endstruct

struct child extends parent
    .data2: skip 3
endstruct

db objectsize(parent)         ; db 5
db objectsize(parent.child)   ; db 3
</code></pre>
</li>
<li>
<p><code>datasize(label)</code></p>
<p>Takes a given label and calculates the distance between it and the next label. It will throw a warning if the distance exceeds 0xFFFF or is the last label in the targeted assembly.</p>
<pre><code class="language-asar">org $008000
main:

lda #datasize(my_table)       ;3
lda #datasize(other_label)    ;0x7FF3 (last label, throws a warning. calculated as $FFFFFF-$00800C)
lda #datasize(main)           ;9


my_table:
    db $00, $00, $02
other_label:
</code></pre>
</li>
<li>
<p><code>stringsequal(string1, string2)</code></p>
<p>Returns 1 if the given string parameters are equal and 0 otherwise.</p>
<pre><code class="language-asar">if not(stringsequal(&quot;!assembler&quot;, &quot;asar&quot;))
    warn &quot;This patch was only tested in Asar and might not work correctly in your assembler.&quot;
endif
</code></pre>
</li>
<li>
<p><code>stringsequalnocase(string1, string2)</code></p>
<p>Returns 1 if the given string parameters are equal and 0 otherwise. The comparison is case-insensitive.</p>
<pre><code class="language-asar">if not(stringsequalnocase(&quot;!assembler&quot;, &quot;ASAR&quot;))
    warn &quot;This patch was only tested in Asar and might not work correctly in your assembler.&quot;
endif
</code></pre>
</li>
<li>
<p><code>char(string, index)</code></p>
<p>Returns the <code>index</code>-th character in <code>string</code> (starting at zero). Note that this function ignores the current table mapping, and also doesn't respect Unicode properly: it returns bytes of the string's UTF-8 encoding. For example, <code>db char(&quot;ä&quot;, 0)</code> writes <code>C3</code>, which is the first byte of 'ä' in UTF-8.</p>
</li>
<li>
<p><code>stringlength(string)</code></p>
<p>Returns the length of <code>string</code> in bytes (encoded as UTF-8). I.e. <code>char(str, stringlength(str)-1)</code> is the last byte of the string.</p>
</li>
<li>
<p><code>pc()</code></p>
<p>Returns the current SNES address. This is a shorthand for placing a label right before the current command.</p>
</li>
<li>
<p><code>realbase()</code></p>
<p>Returns the current address in the ROM being written to. This is not the same as the value of a nearby label when the <code>base</code> command is active: it returns the actual address the code will end up at.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conditionals-and-loops"><a class="header" href="#conditionals-and-loops">Conditionals and Loops</a></h1>
<p>Conditional compilation allows you to only compile specific sections of code when certain conditions are met. This can be used in a number of ways, but is most commonly used in conjunction with defines to make code easily customizable and/or provide some simple configuration options to end users.</p>
<h2 id="if--elseif--else--endif"><a class="header" href="#if--elseif--else--endif"><code>if</code> / <code>elseif</code> / <code>else</code> / <code>endif</code></a></h2>
<p>The most basic form of conditionals are if conditionals. They are given a math statement and only compile their enclosed code if that statement evaluates to a value greater than 0.</p>
<p><a name="a0"></a>
<a name="a1"></a>
<a name="a2"></a>
<a name="a3"></a></p>
<pre><code class="language-asar">if {condition}
    {codeblock}
endif
</code></pre>
<p>To construct condition statements, you can also make use of a number of comparison operators specific to conditionals. They return 1 if their respective comparison is true and 0 otherwise.</p>
<div class="table-wrapper"><table><thead><tr><th>Operator</th><th>Details</th></tr></thead><tbody>
<tr><td><code>a == b</code></td><td>Returns 1 if <code>a</code> is equal to <code>b</code></td></tr>
<tr><td><code>a != b</code></td><td>Returns 1 if <code>a</code> is not equal to <code>b</code></td></tr>
<tr><td><code>a &gt; b</code></td><td>Returns 1 if <code>a</code> is greater than <code>b</code></td></tr>
<tr><td><code>a &lt; b</code></td><td>Returns 1 if <code>a</code> is less than <code>b</code></td></tr>
<tr><td><code>a &gt;= b</code></td><td>Returns 1 if <code>a</code> is greater than or equal to <code>b</code></td></tr>
<tr><td><code>a &lt;= b</code></td><td>Returns 1 if <code>a</code> is less than or equal to <code>b</code></td></tr>
</tbody></table>
</div>
<p>You can use logical operators to chain multiple conditions.</p>
<div class="table-wrapper"><table><thead><tr><th>Operator</th><th>Details</th></tr></thead><tbody>
<tr><td><code>a || b</code></td><td>Returns 1 if at least one of <code>a</code> and <code>b</code> evaluates to 1</td></tr>
<tr><td><code>a &amp;&amp; b</code></td><td>Returns 1 if both of <code>a</code> and <code>b</code> evaluate to 1</td></tr>
</tbody></table>
</div>
<p>Evaluation is lazy (TODO it's not anymore, is it?) which means that the assembler will stop evaluating a condition as soon as the result can be determined (for example, in the condition <code>0 &amp;&amp; my_function()</code>, my_function() will never be called). Note that only one kind of logical operator can be used in a single condition, but conditionals themselves can be nested to an arbitrary depth, which can be used as a workaround here.</p>
<p>Optionally, if conditionals can contain an arbitrary number of elseif branches as well as a single else branch. The assembler checks the if and all elseif branches in succession until a single condition evaluates to <code>&gt; 0</code> - if none does, the code inside the else branch is compiled.</p>
<pre><code class="language-asar">!mode = 0       ; Supported modes: 0, 1, 2, 3
!verbose = 0    ; Set to 1 to enable verbose mode

if !mode == 0
    ; ...
elseif !mode == 1
    ; ...
elseif !mode == 2
    ; ...
elseif !mode == 3
    if !verbose != 0
        print &quot;Oh boy, so you're going with mode 3 today!&quot;
    endif
    ; ...
else
    error &quot;Unsupported mode! Please choose 0, 1, 2 or 3!&quot;
endif
</code></pre>
<p>Alternatively, if statements can also be constructed on a single line via the following syntax:</p>
<pre><code class="language-asar">if {condition} : {codeblock}[ : codeblock...] : endif
</code></pre>
<pre><code class="language-asar">PressedY:
    if !fireballs_enabled : %PlaySoundEffect(!fireball_sfx) : jsr ShootFireball : endif
    rtl
</code></pre>
<p>If you plan to use labels in if conditions, note that there's certain restrictions that apply. More specifically, only static labels can be used. That is, only labels whose address can't change between Asar's passes, as demonstrated by the following example:</p>
<pre><code class="language-asar">FirstLabel = $018000
        
freecode
    lda SecondLabel,x
    
SecondLabel:
    db $00,$01,$02,$03
    
; All good. FirstLabel was statically defined.
if FirstLabel == 0
endif

; Error Elabel_in_conditional. The label could move between passes.
if SecondLabel == 0
endif
</code></pre>
<h2 id="while"><a class="header" href="#while"><code>while</code></a></h2>
<p><a name="a4"></a>
<a name="a5"></a></p>
<pre><code class="language-asar">while {condition}
    {code}
endwhile
</code></pre>
<p>A special variation of if conditionals are while loops. Instead of compiling their enclosed code only once, they compile it repeatedly until their condition evaluates to <code>&lt;= 0</code>. Typically, this would be used with a define that is modified inside the loop. This can be useful for generating data tables.</p>
<pre><code class="language-asar">!counter = 0
        
while !counter &lt; $10
    db (!counter&lt;&lt;8)|$00,(!counter&lt;&lt;8)|$01,(!counter&lt;&lt;8)|$02,(!counter&lt;&lt;8)|$03
    db (!counter&lt;&lt;8)|$04,(!counter&lt;&lt;8)|$05,(!counter&lt;&lt;8)|$06,(!counter&lt;&lt;8)|$07
    db (!counter&lt;&lt;8)|$08,(!counter&lt;&lt;8)|$09,(!counter&lt;&lt;8)|$0A,(!counter&lt;&lt;8)|$0B
    db (!counter&lt;&lt;8)|$0C,(!counter&lt;&lt;8)|$0D,(!counter&lt;&lt;8)|$0E,(!counter&lt;&lt;8)|$0F
            
    !counter #= !counter+1
endwhile
</code></pre>
<p>Be warned as improper use of while loops can lead to infinite loops and thus a dead-lock of the assembler, as Asar won't attempt to detect those.</p>
<h2 id="for"><a class="header" href="#for"><code>for</code></a></h2>
<p><a name="a6"></a>
<a name="a7"></a></p>
<pre><code class="language-asar">for {variable} = {start}..{end}
    {code}
endfor
</code></pre>
<p>For loops repeat the contents a specified number of times. In the for loop body, you have access to a loop counter as a define. The range is specified as start-inclusive and end-exclusive. For example:</p>
<pre><code class="language-asar">for i = 1..5
    db !i
    db 2*!i
endfor
</code></pre>
<p>This will write the bytes <code>01 02 02 04 03 06 04 08</code>.</p>
<p>You can also put for loops on a single line, however in this case due to the order in which Asar parses defines, you will not be able to use the loop counter. For example:</p>
<pre><code class="language-asar">for i = 0..10 : nop : endfor
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="binary-data"><a class="header" href="#binary-data">Binary Data</a></h1>
<p>Asar supports a number of commands which allow you to insert binary data directly into the ROM.</p>
<h2 id="tables"><a class="header" href="#tables">Tables</a></h2>
<p><a name="a0"></a></p>
<pre><code class="language-asar">db {value}[,value...]
dw {value}[,value...]
dl {value}[,value...]
dd {value}[,value...]
</code></pre>
<p>Table commands let you insert a number or a list of numbers directly into the ROM as raw bytes. Use <code>db</code> for 8-bit numbers, <code>dw</code> for 16-bit numbers, <code>dl</code> for 24-bit numbers and <code>dd</code> for 32-bit numbers respectively, where <code>value</code> can be a number literal, a math statement, a label or a Unicode string delimited by double quotes. When using <code>dw</code>, <code>dl</code> or <code>dd</code>, each number is converted to little-endian. Big numbers are truncated to smaller integers as needed.</p>
<pre><code class="language-asar">org $0189AB
Label:

; This will write the following data to the ROM:
; $01  $03  $07  $AB  $41 $42 $43
db $01,$0203,$04050607,Label,&quot;ABC&quot;
; This will write the following data to the ROM:
; $01 $00  $03 $02  $07 $06  $AB $89  $41 $00 $42 $00 $43 $00
dw $01,$0203,$04050607,Label,&quot;ABC&quot;
; $01 $00 $00  $03 $02 $00  $07 $06 $05  $AB $89 $01  $41 $00 $00 $42 $00 $00 $43 $00 $00
dl $01,$0203,$04050607,Label,&quot;ABC&quot;
; $01 $00 $00 $00  $03 $02 $00 $00  $07 $06 $05 $04  $AB $89 $01 $00  $41 $00 $00 $00 $42 $00 $00 $00 $43 $00 $00 $00
dd $01,$0203,$04050607,Label,&quot;ABC&quot;
</code></pre>
<p>By default, each character in a Unicode string used in a table maps onto the respective Unicode code points it's composed of. This mapping can be customized via character literal assignments:</p>
<p><a name="a1"></a></p>
<pre><code class="language-asar">'{character}' = {value}
</code></pre>
<p>Where <code>character</code> is a Unicode code point and <code>value</code> is any math expression, specifying what value that code point will be remapped to. Only single code points can be remapped at this time - e.g., a precomposed &quot;Ä&quot; will work, while a split &quot;¨&quot; and an &quot;A&quot; will throw an error.<br />
To reset all mappings to a direct Unicode code point mapping, use the command <a name="a2"></a><code>cleartable</code>. Additionally, the <a name="a3"></a><code>pushtable</code> command lets you push all current mappings onto a stack, whereas the <a name="a4"></a><code>pulltable</code> command lets you restore the mappings from that stack.</p>
<pre><code class="language-asar">; Contents of table1.asm:
;'A' = $1A
;'B' = $1B
;'C' = $1C
;'日' = $2A
;'本' = $2B
;'語' = $2C

; Contents of table2.asm:
;'A' = $1D
;'B' = $1E
;'C' = $1F
;'日' = $2D
;'本' = $2E
;'語' = $2F

; This writes $41 $42 $43 $E5 (from U+65E5) $2C (from U+672C) $9E (from U+8A9E)
db &quot;ABC日本語&quot;

incsrc &quot;table1.asm&quot;

; This writes $1A $1B $1C $2A $2B $2C
db &quot;ABC日本語&quot;

pushtable
incsrc &quot;table2.asm&quot;

; This writes $1D $1E $1F $2D $2E $2F
db &quot;ABC日本語&quot;

pulltable

; This writes $1A $1B $1C $2A $2B $2C
db &quot;ABC日本語&quot;

cleartable

; This writes $41 $42 $43 $E5 $2C $9E
db &quot;ABC日本語&quot;

'A' = $20
'B' = $20+1
'C' = $20+2
'日' = $20+3
'本' = $20+4
'語' = $20+5

; Those both write $20 $21 $22 $23 $24 $25
db &quot;ABC日本語&quot;
db 'A','B','C','日','本','語'
</code></pre>
<p>Note that Asar tries to replace defines wherever possible - even inside strings. Sometimes, this might be undesired. In those cases, you can prefix the <code>!</code> with a <code>\</code> to escape it. The <code>\</code> itself can be escaped with another <code>\</code>. In the case of a <code>&quot;</code> it can be escaped with an additional <code>&quot;</code>.</p>
<pre><code class="language-asar">!define = &quot;text&quot;

; This writes &quot;text&quot; to the ROM
db &quot;!define&quot;

; This writes &quot;!define&quot; to the ROM
db &quot;\!define&quot;

; This writes &quot;\text&quot; to the ROM
db &quot;\\!define&quot;
; This writes 'something &quot;cool&quot;' to the ROM
db &quot;something &quot;&quot;cool&quot;&quot;&quot;
</code></pre>
<h2 id="fillbyte--fill"><a class="header" href="#fillbyte--fill"><code>fillbyte</code> / <code>fill</code></a></h2>
<p><a name="a5"></a></p>
<pre><code class="language-asar">fillbyte {byte}
</code></pre>
<p><a name="a6"></a></p>
<pre><code class="language-asar">fill {num}
fill align {alignment} [offset {offset}]
</code></pre>
<p>The fillbyte and fill commands let you write a specific byte value to the ROM multiple times. The <code>byte</code> parameter of fillbyte specifies which value to write, wheres fill writes that value to the output ROM <code>num</code> times. If <code>alignment</code> is specified, the value will be written repeatedly until the SNES address has the specified alignment, similar to <a href="./program-counter.html#skip"><code>skip align</code></a>.</p>
<pre><code class="language-asar">fillbyte $FF
; This writes $FF $FF $FF $FF $FF $FF $FF $FF
fill 8
org $008005
; this writes $FF until SNES address $00800A (=$8008 + 2)
fill align 8 offset 2
</code></pre>
<p>It's also possible to write 16-bit, 24-bit or 32-bit values with the fill command by using <a name="a7"></a><code>fillword</code>, <a name="a8"></a><code>filllong</code> or <a name="a9"></a><code>filldword</code> instead of <code>fillbyte</code>. Note that the <code>num</code> parameter of fill still specifies the number of bytes to write in those cases. Values might get truncated as needed to exactly reach the specified number of bytes to write.</p>
<h2 id="padbyte--pad"><a class="header" href="#padbyte--pad"><code>padbyte</code> / <code>pad</code></a></h2>
<p><a name="a10"></a></p>
<pre><code class="language-asar">padbyte {byte}
</code></pre>
<p><a name="a11"></a></p>
<pre><code class="language-asar">pad {snes_address}
</code></pre>
<p>The <code>padbyte</code> and <code>pad</code> commands let you write a specific byte value to the ROM until the pc reaches a certain SNES address. The <code>byte</code> parameter of padbyte specifies which value to write, wheres pad writes that value to the output ROM until the pc reaches <code>snes_address</code>.</p>
<pre><code class="language-asar">org $008000
padbyte $FF
; This writes $FF $FF $FF $FF
pad $008004
</code></pre>
<p>It's also possible to write 16-bit, 24-bit or 32-bit values with the pad command by using <a name="a12"></a><code>padword</code>, <a name="a13"></a><code>padlong</code> or <a name="a14"></a><code>paddword</code> instead of <code>padbyte</code>. Note that the <code>snes_address</code> parameter of pad still specifies the end offset of the write in those cases. Values might get truncated as needed to exactly reach the specified end offset.</p>
<h2 id="incbin"><a class="header" href="#incbin"><code>incbin</code></a></h2>
<p><a name="a15"></a></p>
<pre><code class="language-asar">incbin {filename}[:range_start..range_end]
</code></pre>
<p>The incbin command copies a binary file directly into the output ROM. The <code>filename</code> parameter specifies which file to copy (enclose in double quotes to use file names with spaces, see section <a href="./includes.html">Includes</a> for details on Asar's handling of file names) and the optional <code>range_start</code> and <code>range_end</code> parameters are math expressions which specify a range of data to copy from the file (a <code>range_end</code> of 0 copies data until the end of the file; not specifying a range copies the entire file).</p>
<pre><code class="language-asar">; datafile.bin contains the following bytes:
; $00 $01 $02 $03 $04 $05 $06 $07 $08 $09 $0A $0B $0C $0D $0E $0F

; This writes $00 $01 $02 $03 $04 $05 $06 $07 $08 $09 $0A $0B $0C $0D $0E $0F
incbin &quot;datafile.bin&quot;

; This writes $09 $0A $0B $0C $0D $0E
incbin &quot;datafile.bin&quot;:$9..$F

; This writes $01 $02 $03 $04
incbin &quot;datafile.bin&quot;:$F-$E..2+3
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="includes"><a class="header" href="#includes">Includes</a></h1>
<p>Includes make it possible for your code to reference other files. This can be done for a number of reasons. The most common scenarios are to split code into multiple source files (see <a href="includes.html#incsrc"><code>incsrc</code></a>) or to separate code from data (see <a href="./binary.html#incbin"><code>incbin</code></a>). Whenever using a command or function referencing another file, Asar tries to locate that file by applying a set of rules to the file path in a specific order:</p>
<ol>
<li>If the path is an <strong>absolute</strong> path:
<ol>
<li>Asar tries to locate the file directly via the specified path.</li>
<li>If this fails, an error is thrown.</li>
</ol>
</li>
<li>If the path is a <strong>relative</strong> path:
<ol>
<li>Asar tries to locate the file relatively to the file currently being assembled. (Caution: when used inside macros, paths are relative to the macro definition rather than to the macro call).</li>
<li>If this fails, Asar tries to locate the file relatively to any of the include search paths that were specified, in the order they were specified in, until the file is found. (See section <a href="./usage.html">Usage</a> for details on include search paths).</li>
<li>If all of the previous fail, an error is thrown.</li>
</ol>
</li>
</ol>
<p>Asar supports Unicode file names where available, including on Windows.</p>
<h2 id="incsrc"><a class="header" href="#incsrc"><code>incsrc</code></a></h2>
<p><a name="a0"></a></p>
<pre><code class="language-asar">incsrc {filename}
</code></pre>
<p>The incsrc command makes Asar assemble the file referenced by the <code>filename</code> parameter (enclose in double quotes to use file names with spaces, see section <a href="includes.html#includes">Includes</a> for details on Asar's handling of file names). The file is assembled in-place which means that Asar instantly switches to the new file and only returns to the previous file once assembling the new file has finished. All of Asar's state (labels, defines, functions, pc etc.) is shared between files. When including other files, there is a recursion limit of 512 levels. This limit only serves the purpose of preventing infinite recursion. For an easier understanding of incsrc, you can visualize it as a command which pastes the contents of another file directly into the current file (although that's not actually how it's implemented and there are differences in the way relative file paths are handled).</p>
<pre><code class="language-asar">; Contents of routine.asm:
;AnotherRoutine:
;    lda #$FF
;    sta $00
;    rts

Main:
    jsr AnotherRoutine
    bra Main

incsrc &quot;routine.asm&quot;
        
</code></pre>
<h2 id="include--includefrom"><a class="header" href="#include--includefrom"><code>include</code> / <code>includefrom</code></a></h2>
<p><a name="a1"></a></p>
<pre><code class="language-asar">include
</code></pre>
<p><a name="a2"></a></p>
<pre><code class="language-asar">includefrom {filename}
</code></pre>
<p>The <code>include</code> and <code>includefrom</code> commands specify that a file is only to be included in another file and not to be assembled directly. When a user tries to assemble a file containing include or includefrom directly, an error is thrown. The <code>includefrom</code> command behaves identically to the include command with the exception that it is passed the name of the file it is meant to be included from (note that Asar doesn't verify whether it's actually included from that file, it only checks whether it's included from another file at all). When making use of include or includefrom, they must be the first command within their respective file and can't be used in combination with the <a href="./compat.html#asar">asar</a> command in the same file.</p>
<pre><code class="language-asar">; Contents of shared.asm:
;includefrom main.asm
;
;if read1($00FFD5) == $23
;    !is_sa1_rom = 1
;else
;    !is_sa1_rom = 0
;endif


asar 1.37

incsrc &quot;shared.asm&quot;

if !is_sa1_rom != 0
    ; ...
endif
</code></pre>
<h2 id="includeonce"><a class="header" href="#includeonce"><code>includeonce</code></a></h2>
<p><a name="a3"></a></p>
<pre><code class="language-asar">includeonce
</code></pre>
<p>The includeonce command places an include guard on the file that is currently being assembled. This prevents it from being assembled again when included again. This is intended for shared files which may be included from multiple source files, but should only be assembled once to prevent redefinition errors etc.</p>
<pre><code class="language-asar">; Contents of shared.asm:
;
;includeonce
;
;MyRoutine = $018000
;MyOtherRoutine = $028000


; Note that the second include does not throw
; redefinition errors, thanks to the &quot;includeonce&quot;.
incsrc &quot;shared.asm&quot;
incsrc &quot;shared.asm&quot;

jsl MyRoutine
jsl MyOtherRoutine
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="freespace"><a class="header" href="#freespace">Freespace</a></h1>
<p>Freespace is a concept that comes into play when extending an existing ROM. To insert new code or data into a ROM, the ROM must contain enough continuous unused space for everything to fit into. Space like that is referred to as freespace. Many tools attempt to find freespace in a ROM by looking for continuous blocks of a certain value (most commonly <code>$00</code>). This method on its own isn't reliable as freespace finders could erroneously detect binary data or code with a certain pattern as freespace. For this reason, the RATS format was invented to protect data inserted into a ROM (see <a href="https://web.archive.org/web/20180525193101/http://old.smwiki.net/wiki/ROM_Allocation_Tag_System">SMW Wiki</a> for details on the RATS format). When placing RATS tags at the beginning of occupied memory blocks inside a ROM, freespace finders can search for them to know which parts of the ROM not to overwrite. Asar supports a number of commands for working with freespace directly, including freespace finders with automatic RATS tag generation.</p>
<h2 id="freespace--freecode--freedata--segment"><a class="header" href="#freespace--freecode--freedata--segment"><code>freespace</code> / <code>freecode</code> / <code>freedata</code> / <code>segment</code></a></h2>
<p><a name="a0"></a></p>
<pre><code class="language-asar">freespace {ram/noram}[,norats][,align][,cleaned][,static][,bankcross][,bank={num}][,start={num}][,pin={label}]
freecode [options...]
freedata [options...]
segment [ram/noram][,align][,bankcross][,bank={num}][,start={num}][,pin={label}]
</code></pre>
<p>The freespace command makes Asar search the output ROM for a freespace area large enough to contain the following section of code/data. If such an area is found, the pc is placed at its beginning and a RATS tag automatically written. If no such area is found, an error is thrown. The parameters control what kind of freespace to look for.</p>
<p>The <code>freecode</code> command is an alias of <code>freespace ram</code>, whereas <code>freedata</code> is an alias of <code>freespace noram</code>. The <code>segment</code> command is an alias for <code>freespace norats</code>. (Additionally, with <code>segment</code> specifying <code>ram</code> or <code>noram</code> is optional and defaults to <code>noram</code>.)</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Details</th></tr></thead><tbody>
<tr><td><code>ram</code></td><td>The freespace finder searches for an area where RAM mirrors are available (banks $10 to $3F). Recommended when inserting code.</td></tr>
<tr><td><code>noram</code></td><td>The freespace finder searches for an area where RAM mirrors aren't available (banks $40 to $6F and $F0 to $FF). If no such area is found, it searches in the remaining banks ($10 to $3F). Recommended when inserting data.</td></tr>
<tr><td><code>norats</code></td><td>Do not write a RATS tag. This is mostly useful for homebrews, or other setups where the ROM is rebuilt from scratch. Using this option makes the <code>ram</code>/<code>noram</code> options optional, defaulting to <code>noram</code>. It also cannot be used with <code>cleaned</code> or <code>static</code>, which are specfic to the RATS system.</td></tr>
<tr><td><code>align</code></td><td>The freespace finder searches for an area at the beginning of a bank.</td></tr>
<tr><td><code>cleaned</code></td><td>Suppresses the warning about freespace leaking. Useful when Asar's leak detection misbehaves on an autoclean with a complicated math statement or similar.</td></tr>
<tr><td><code>static</code></td><td>Prevents the freespace area from moving once assigned. This also prevents it from growing (an error is thrown if the area would need to grow). Useful in situations where data needs to remain in a certain location (for example: when another tool or another patch needs to access it).</td></tr>
<tr><td><code>bank=</code></td><td>Only search for freespace in the given bank. Mostly useful when using <code>norats</code>.</td></tr>
<tr><td><code>start=</code></td><td>Search for freespace starting at the specified position in ROM. Useful for hacking non-SMW games, where the original ROM might be bigger or smaller. Note that technically, this limits the freespace finder to positions that are after the location of <code>start</code> in the ROM file: For example, when using <code>$C00000</code> as the start position in <code>hirom</code>, the entire ROM will be searched, since <code>$C00000</code> is at the start of the ROM file.</td></tr>
<tr><td><code>pin=</code></td><td>Pin this freespace to another one, forcing them to be placed in the same bank.</td></tr>
<tr><td><code>bankcross</code></td><td>Allow this freespace to cross bank borders. You must also use <code>check bankcross off</code> inside the freespace to allow the data inside it to cross borders. Note that all of the concerns regarding <code>check bankcross off</code> also apply here.</td></tr>
</tbody></table>
</div>
<p>Every boolean option also has a negative version prefixed with <code>no</code> that allows disabling it to restore the default behavior. (In the case of <code>norats</code>, using <code>rats</code> will restore the default behavior.)</p>
<p>One thing to note about freespaces is that if Asar places two freespace areas within the same bank, it will use 24-bit addressing in cases where they reference each other, despite 16-bit addressing being possible in theory. This can be worked around by only using a single freespace area instead. It's not recommended to explicitly use 16-bit addressing in these cases as the two freespace areas are not guaranteed to always end up in the same bank for all users.</p>
<pre><code class="language-asar">; Let's assume this to be some location in the ROM originally containing
;lda #$10
;sta $1F
org $01A56B
    autoclean jsl MyNewCode
    
freecode

MyNewCode:
    ; Do something here
    ; ...
    
.Return:
    ; We overwrote some code from the original ROM with our org, so we have to restore it here
    lda #$10
    sta $1F
    
    rtl
</code></pre>
<h2 id="freespacebyte"><a class="header" href="#freespacebyte"><code>freespacebyte</code></a></h2>
<p><a name="a1"></a></p>
<pre><code class="language-asar">freespacebyte {value}
</code></pre>
<p>This command sets the byte which Asar considers to be free space. This value will be used for searching for freespace, as padding when resizing the ROM, or when cleaning up old freespaces.</p>
<h2 id="freespace_settings"><a class="header" href="#freespace_settings"><code>freespace_settings</code></a></h2>
<p><a name="a2"></a></p>
<pre><code class="language-asar">freespace_settings {options...}
</code></pre>
<p>This command allows giving default values for the <code>freespace</code>/<code>freecode</code>/... commands. The syntax is the same as the <code>freespace</code> command. Asar will act like any options provided here are prepended to all <code>freespace</code>/etc commands.</p>
<pre><code class="language-asar">freespace_settings start=$088000
freecode static ; this will act like `freespace start=$088000,ram,static`
; (the `ram` comes from using freecode instead of freespace:
;  note how it's added after the default settings.)
</code></pre>
<h2 id="autoclean"><a class="header" href="#autoclean"><code>autoclean</code></a></h2>
<p><a name="a3"></a></p>
<pre><code class="language-asar">autoclean jml/jsl/lda/cmp/.../dl {label}
autoclean {snes_address}
</code></pre>
<p>The autoclean command makes it possible for Asar to automatically clean up and reuse all of the freespace allocated by a patch when applying that patch again. The purpose of this is to prevent freespace leaks. Normally, applying a patch including a freespace (or similar) command to the same ROM multiple times would allocate a new freespace area each time. Since Asar automatically protects allocated freespace via RATS tags, all freespace areas previously allocated by the same patch would leak and become unusable, making the output ROM run out of freespace eventually. The autoclean command can prevent this by freeing up freespace areas previously allocated by the patch before allocating new ones. How it accomplishes this depends on how it is used:</p>
<ul>
<li><strong>When used with an assembly instruction (most commonly <code>jml</code> or <code>jsl</code>):</strong><br />
The <code>label</code> parameter must be a label pointing to inside a freespace area. The instruction can be any instruction that supports long (24-bit) addressing. When the patch is applied and the autoclean is encountered, Asar checks whether the output ROM contains the same instruction at the current pc. If it does, and the instruction points into a freespace area with a valid RATS tag, the RATS tag is removed along with its contents.</li>
<li><strong>When used with a <code>dl</code>:</strong><br />
The <code>label</code> parameter must be a label pointing to inside a freespace area. When the patch is applied and the autoclean is encountered, Asar checks whether the output ROM contains an address pointing to the expanded area of the ROM (banks $10+) at the current pc. If it does, Asar checks whether that address points to an area protected by a RATS tag (including the RATS tag itself). If it does, Asar cleans up that area and removes the RATS tag.</li>
<li><strong>When used with just an address:</strong><br />
The <code>snes_address</code> parameter must be any label, number literal or math statement evaluating to an SNES address pointing to inside a freespace area. When the patch is applied and the autoclean is encountered, Asar checks whether that address points to the expanded area of the ROM (banks $10+). If it does, Asar checks whether it points to an area protected by a RATS tag (including the RATS tag itself). If it does, Asar cleans up that area and removes the RATS tag.</li>
</ul>
<p>When using autoclean with an instruction or dl, Asar will also assemble the respective line of code at the current pc. For simplicity, you can treat the autoclean command like a modifier in those cases. A few more things to note when using the autoclean command:</p>
<ul>
<li>The autoclean command itself may not be used inside a freespace area. To automatically clean up freespace that is only referenced within another freespace area, you can use the <a href="freespace.html#prot"><code>prot</code></a> command.</li>
<li>It is safe to have multiple autoclean commands pointing to the same freespace area.</li>
<li>You can not use autoclean with a label pointing to the very end of a freespace area.</li>
</ul>
<pre><code class="language-asar">; Let's assume this to be some location in the ROM containing a function pointer table or similar
org $00A5F2
    autoclean dl MyNewFunction1
    autoclean dl MyNewFunction2
    
freecode

MyNewFunction1:
    ; ...
    rtl
    
MyNewFunction2:
    ; ...
    rtl
</code></pre>
<h2 id="prot"><a class="header" href="#prot"><code>prot</code></a></h2>
<p><a name="a4"></a></p>
<pre><code class="language-asar">prot {label}[,label...]
</code></pre>
<p>The prot command makes it possible for Asar to automatically clean up a freespace area that is only referenced within another freespace area and thus can't be cleaned via an autoclean directly. It must be used at the beginning of a freespace area (right after the freespace command), where the <code>label</code> parameter must be a label pointing to inside a freespace area (you can pass up to 85 labels separated by commas to a single prot). When a freespace area containing a prot is cleaned by an autoclean, all freespace areas referenced by the prot are also cleaned up.</p>
<pre><code class="language-asar">org $0194BC
    autoclean jsl MyNewFunction
    
    
freecode
prot SomeLargeData

MyNewFunction:
    ldx.b #0
    
.Loop:
    {
        lda SomeLargeData,x
        cmp #$FF
        beq .Return
        
        ; ...
        
        inx
        
        bra .Loop
    }
    
.Return:
    rtl
    
    
freedata

SomeLargeData:
    db $00,$01,$02,$03
    ; ...
    db $FF
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="text-output"><a class="header" href="#text-output">Text Output</a></h1>
<p>Text output functions allow you to communicate certain information, states, warnings, errors etc. to end users of your code.</p>
<h2 id="print"><a class="header" href="#print"><code>print</code></a></h2>
<p>The <code>print</code> command lets you output general-purpose text to the user. Most commonly this is used to inform the user about certain states or to output debug information. Usage:</p>
<p><a name="a0"></a></p>
<pre><code class="language-asar">print {text_or_function}[,text_or_function...]
</code></pre>
<p>where <code>text_or_function</code> can be either a string delimited by double quotes or one of the print-specific functions below:</p>
<div class="table-wrapper"><table><thead><tr><th>Function</th><th>Details</th></tr></thead><tbody>
<tr><td><code>bin(x[, width])</code></td><td>Prints x as a binary (base-2) integer, where x can be any math statement. If width is provided, the output is padded to at least this many digits using zeroes.</td></tr>
<tr><td><code>dec(x[, width])</code></td><td>Prints x as a decimal (base-10) integer, where x can be any math statement. If width is provided, the output is padded to at least this many digits using zeroes.</td></tr>
<tr><td><code>hex(x[, width])</code></td><td>Prints x as a hexadecimal (base-16) integer, where x can be any math statement. If width is provided, the output is padded to at least this many digits using zeroes.</td></tr>
<tr><td><code>double(x[, precision])</code></td><td>Prints x as a decimal number with precision decimal places (default: 5), where x can be any math statement.</td></tr>
<tr><td><code>pc</code></td><td>Prints the current PC.</td></tr>
<tr><td><code>freespaceuse</code></td><td>Prints the total number of bytes used by commands that acquire freespace (such as freespace, freecode, freedata etc.). You can use the command <a name="a1"></a><code>reset freespaceuse</code> to reset this value.</td></tr>
<tr><td><code>bytes</code></td><td>Prints the total number of bytes written to the output ROM. You can use the command <a name="a2"></a><code>reset bytes</code> to reset this value.</td></tr>
</tbody></table>
</div>
<h2 id="warn"><a class="header" href="#warn"><code>warn</code></a></h2>
<p>The <code>warn</code> command lets you output a warning message to the user. Usage:</p>
<p><a name="a3"></a></p>
<pre><code class="language-asar">warn [text_or_function...]
</code></pre>
<p>where <code>custom_warning_text</code> can be a custom warning text and uses the same format as the <code>print</code> command. A warning does not cause compilation to fail, so it can be used to inform the user about potential dangers. Warning messages are printed to stderr.</p>
<pre><code class="language-asar">if read1($00FFD5) == $23
    warn &quot;SA-1 compatibility of this patch is untested, use with caution!&quot;
endif
</code></pre>
<h2 id="error"><a class="header" href="#error"><code>error</code></a></h2>
<p>The <code>error</code> command lets you output an error message to the user. Usage:</p>
<p><a name="a4"></a></p>
<pre><code class="language-asar">error [text_or_function...]
</code></pre>
<p>where <code>custom_error_text</code> can be a custom error text and uses the same format as the <code>print</code> command. An error causes compilation to fail, so it should be used to inform the user about irrecoverable error states. Error messages are printed to stderr.</p>
<pre><code class="language-asar">if read1($00FFD5) == $23
    error &quot;This patch is not SA-1 compatible!&quot;
endif
</code></pre>
<h2 id="assert"><a class="header" href="#assert"><code>assert</code></a></h2>
<p>An assert can be considered a short version of the code</p>
<pre><code class="language-asar">if {condition}
else
    error [text_or_function...]
endif
</code></pre>
<p>and is used via the syntax</p>
<p><a name="a5"></a></p>
<pre><code class="language-asar">assert {condition}[,text_or_function...]
</code></pre>
<p>where <code>custom_error_text</code> can be a custom error text and uses the same format as the <code>print</code> command. If <code>condition</code> evaluates to <code>&lt;= 0</code>, an error is thrown, otherwise nothing happens.</p>
<pre><code class="language-asar">assert read1($00FFD5) != $23, &quot;This patch is not SA-1 compatible!&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="checks"><a class="header" href="#checks">Checks</a></h1>
<p>Checks allow Asar to monitor certain states and throw warnings or errors when certain criteria are met. This can be helpful for catching or preventing certain problems.</p>
<h2 id="check-title"><a class="header" href="#check-title"><code>check title</code></a></h2>
<p><a name="a0"></a></p>
<pre><code class="language-asar">check title &quot;{title}&quot;
</code></pre>
<p>The check title command verifies that the title stored in the output ROM is identical to <code>title</code>. If it isn't, an error is thrown (unless <code>--no-title-check</code> is passed to the application, in which case only a warning is thrown - see section <a href="./usage.html#--no-title-check">Usage</a> for details). The purpose of this command is to assure that patches are applied to the correct output ROM.</p>
<pre><code class="language-asar">; This patch is only for a Super Mario World ROM
check title &quot;SUPER MARIOWORLD     &quot;

; Remove small bonus stars from game
org $009053
    nop #3
    
org $009068
    nop #3
</code></pre>
<h2 id="check-bankcross"><a class="header" href="#check-bankcross"><code>check bankcross</code></a></h2>
<p><a name="a1"></a></p>
<pre><code class="language-asar">check bankcross {off/half/full}
</code></pre>
<p>The <code>check bankcross</code> command enables (<code>full</code> or <code>half</code>) or disables (<code>off</code>) throwing errors when a bank border is crossed while assembling a file. The default is <code>full</code>, which checks whether the code crosses from pc $FFFF to $0000 in the next bank, and throws an error if that happens. With <code>half</code>, Asar will additionally check crossings from $7FFF to $8000. Use <code>off</code> with caution as some features may not behave correctly with bank border checking disabled and some places may still check for bank borders, anyways.</p>
<pre><code class="language-asar">check bankcross off

org $80FFFF

    db $00,$00
    
check bankcross full

print pc    ; Will print 818001 when using LoROM mapper
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="warnings"><a class="header" href="#warnings">Warnings</a></h1>
<p>Warnings are messages that Asar outputs to inform the user about potentially unintended or risky code that isn't critical and thus doesn't cause assembly to fail on its own. These messages can be useful for detecting potential problems in the code, but in some situations may be undesirable. For this reason, Asar supports a few methods of explicitly enabling or disabling certain warnings (see section <a href="./usage.html">Usage</a> for details on how to configure warnings via the command line). Additionally, there are warnings which may be useful in some situations, but would be intrusive in most other situations. They are disabled by default and have to be enabled explicitly to be used. Commands that enable or disable warnings refer to them via their names. The easiest way of finding the name of a specific warning is to look at the console output of a patch producing it. Asar will always output the warning name along with the respective warning. A list of all warnings can also be found <a href="./warning-list.html">here</a>.</p>
<h2 id="disabled-warnings"><a class="header" href="#disabled-warnings">Disabled Warnings</a></h2>
<p>This is a list of all warnings that are disabled by default and have to be enabled explicitly.</p>
<div class="table-wrapper"><table><thead><tr><th>Warning name</th><th>Details</th></tr></thead><tbody>
<tr><td><code>Wimplicitly_sized_immediate</code></td><td>Thrown when opcodes are sized implicitly and Asar has to assume a size. An opcode is considered to be sized explicitly when either a length specifier is used or a simple hex constant that can be assumed to be of a specific size (that is, a hex constant with either two or four digits). Opcodes that don't support multiple sizes are always considered to be sized explicitly. Everything else is considered to be sized implicitly and will throw this warning when enabled.</td></tr>
<tr><td><code>Wcheck_memory_file</code></td><td>Only relevant for the DLL API. Thrown when a file is accessed that was either not provided as a memory file or that isn't found in memory. Mainly intended for debugging purposes and can be used to assure that files are actually read from the correct location.</td></tr>
</tbody></table>
</div>
<h2 id="warnings-pushpull"><a class="header" href="#warnings-pushpull"><code>warnings {push/pull}</code></a></h2>
<p><a name="a0"></a></p>
<pre><code class="language-asar">warnings {push/pull}
</code></pre>
<p>The <code>warnings push</code> command pushes the current state of enabled and disabled warnings to the stack. The <code>warnings pull</code> command pulls it back from the stack.</p>
<pre><code class="language-asar">warnings push
; Disable &quot;freespace leaked&quot; warning
warnings disable Wfreespace_leaked

freecode

; [...]

warnings pull
</code></pre>
<h2 id="warnings-enabledisable"><a class="header" href="#warnings-enabledisable"><code>warnings {enable/disable}</code></a></h2>
<p><a name="a1"></a></p>
<pre><code class="language-asar">warnings {enable/disable} {name}
</code></pre>
<p>The <code>warnings enable</code> command enables the warning with the specified name, the <code>warnings disable</code> command disables it. Warnings enabled or disabled via this command override warnings enabled or disabled via the command line (see section <a href="./usage.html">Usage</a> for details). When using these commands inside shared code, it's recommended to do so in conjunction with <a href="warnings.html#warnings-push-pull"><code>warnings {push/pull}</code></a> to prevent the modified settings from leaking into other files.</p>
<pre><code class="language-asar">warnings disable Wwarn_command

warn &quot;This text in invisible!&quot;

warn enable Wwarn_command

warn &quot;This text in visible!&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="list-of-commands"><a class="header" href="#list-of-commands">List of commands</a></h1>
<p>This is a list of all commands Asar supports, linking to the manual chapter explaining them. In addition to these, Asar accepts assembly instructions, the list of which depends on the currently active architecture (<a href="./arch-65816.html">65816</a>, <a href="./arch-spc700.html">spc700</a>, <a href="./arch-superfx.html">superfx</a>).</p>
<p><code>arch {name}</code>: <a href="arch.html#a0">Architectures</a><br />
<code>spcblock {target_address} [{engine_type}]</code>: <a href="arch.html#a1">Architectures</a><br />
<code>endspcblock [execute {execution_address}]</code>: <a href="arch.html#a2">Architectures</a><br />
<code>lorom</code>: <a href="mapping-modes.html#a0">Mapping Modes</a><br />
<code>hirom</code>: <a href="mapping-modes.html#a1">Mapping Modes</a><br />
<code>exlorom</code>: <a href="mapping-modes.html#a2">Mapping Modes</a><br />
<code>exhirom</code>: <a href="mapping-modes.html#a3">Mapping Modes</a><br />
<code>sa1rom [num, num, num, num]</code>: <a href="mapping-modes.html#a4">Mapping Modes</a><br />
<code>fullsa1rom</code>: <a href="mapping-modes.html#a5">Mapping Modes</a><br />
<code>sfxrom</code>: <a href="mapping-modes.html#a6">Mapping Modes</a><br />
<code>norom</code>: <a href="mapping-modes.html#a7">Mapping Modes</a><br />
<code>asar {ver}</code>: <a href="compat.html#a0">Compatibility Settings</a><br />
<code>namespace nested {on/off}</code>: <a href="compat.html#a1">Compatibility Settings</a><br />
<code>{</code>: <a href="formatting.html#a0">Code Formatting and Syntax</a><br />
<code>}</code>: <a href="formatting.html#a1">Code Formatting and Syntax</a><br />
<code>org {snes_address}</code>: <a href="program-counter.html#a0">Program Counter</a><br />
<code>base {snes_address/off}</code>: <a href="program-counter.html#a1">Program Counter</a><br />
<code>skip {num_bytes}</code>: <a href="program-counter.html#a2">Program Counter</a><br />
<code>skip align {alignment} [offset {offset}]</code>: <a href="program-counter.html#a2">Program Counter</a><br />
<code>bank {data_bank/noassume/auto}</code>: <a href="program-counter.html#a3">Program Counter</a><br />
<code>dpbase {snes_address}</code>: <a href="program-counter.html#a4">Program Counter</a><br />
<code>optimize dp {none/ram/always}</code>: <a href="program-counter.html#a5">Program Counter</a><br />
<code>optimize address {default/ram/mirrors}</code>: <a href="program-counter.html#a6">Program Counter</a><br />
<code>pushpc</code>: <a href="program-counter.html#a7">Program Counter</a><br />
<code>pullpc</code>: <a href="program-counter.html#a8">Program Counter</a><br />
<code>pushbase</code>: <a href="program-counter.html#a9">Program Counter</a><br />
<code>pullbase</code>: <a href="program-counter.html#a10">Program Counter</a><br />
<code>struct {identifier} {snes_address}</code>: <a href="structs.html#a0">Structs</a><br />
<code>endstruct [align {num}]</code>: <a href="structs.html#a1">Structs</a><br />
<code>struct {identifier} extends {identifier}</code>: <a href="structs.html#a2">Structs</a><br />
<code>namespace {identifier}</code>: <a href="namespaces.html#a0">Namespaces</a><br />
<code>namespace off</code>: <a href="namespaces.html#a0">Namespaces</a><br />
<code>pushns</code>: <a href="namespaces.html#a1">Namespaces</a><br />
<code>pullns</code>: <a href="namespaces.html#a2">Namespaces</a><br />
<code>global [#]{identifier}:</code>: <a href="namespaces.html#a3">Namespaces</a><br />
<code>!{identifier} = {value}</code>: <a href="defines.html#a0">Defines</a><br />
<code>!{identifier} = &quot;{value}&quot;</code>: <a href="defines.html#a0">Defines</a><br />
<code>undef &quot;{identifier}&quot;</code>: <a href="defines.html#a1">Defines</a><br />
<code>macro {identifier}(...)</code>: <a href="macros.html#a0">Macros</a><br />
<code>endmacro</code>: <a href="macros.html#a1">Macros</a><br />
<code>function {identifier}(...) = {math}</code>: <a href="functions.html#a0">Functions</a><br />
<code>if {condition}</code>: <a href="conditionals.html#a0">Conditionals and Loops</a><br />
<code>elseif {condition}</code>: <a href="conditionals.html#a1">Conditionals and Loops</a><br />
<code>else</code>: <a href="conditionals.html#a2">Conditionals and Loops</a><br />
<code>endif</code>: <a href="conditionals.html#a3">Conditionals and Loops</a><br />
<code>while {condition}</code>: <a href="conditionals.html#a4">Conditionals and Loops</a><br />
<code>endwhile</code>: <a href="conditionals.html#a5">Conditionals and Loops</a><br />
<code>for {variable} = {start}..{end}</code>: <a href="conditionals.html#a6">Conditionals and Loops</a><br />
<code>endfor</code>: <a href="conditionals.html#a7">Conditionals and Loops</a><br />
<code>db {value}[,value...]</code>: <a href="binary.html#a0">Binary Data</a><br />
<code>dw {value}[,value...]</code>: <a href="binary.html#a0">Binary Data</a><br />
<code>dl {value}[,value...]</code>: <a href="binary.html#a0">Binary Data</a><br />
<code>dd {value}[,value...]</code>: <a href="binary.html#a0">Binary Data</a><br />
<code>'{character}' = {value}</code>: <a href="binary.html#a1">Binary Data</a><br />
<code>cleartable</code>: <a href="binary.html#a2">Binary Data</a><br />
<code>pushtable</code>: <a href="binary.html#a3">Binary Data</a><br />
<code>pulltable</code>: <a href="binary.html#a4">Binary Data</a><br />
<code>fillbyte {byte}</code>: <a href="binary.html#a5">Binary Data</a><br />
<code>fill {num}</code>: <a href="binary.html#a6">Binary Data</a><br />
<code>fill align {alignment} [offset {offset}]</code>: <a href="binary.html#a6">Binary Data</a><br />
<code>fillword</code>: <a href="binary.html#a7">Binary Data</a><br />
<code>filllong</code>: <a href="binary.html#a8">Binary Data</a><br />
<code>filldword</code>: <a href="binary.html#a9">Binary Data</a><br />
<code>padbyte {byte}</code>: <a href="binary.html#a10">Binary Data</a><br />
<code>pad {snes_address}</code>: <a href="binary.html#a11">Binary Data</a><br />
<code>padword</code>: <a href="binary.html#a12">Binary Data</a><br />
<code>padlong</code>: <a href="binary.html#a13">Binary Data</a><br />
<code>paddword</code>: <a href="binary.html#a14">Binary Data</a><br />
<code>incbin {filename}[:range_start..range_end]</code>: <a href="binary.html#a15">Binary Data</a><br />
<code>incsrc {filename}</code>: <a href="includes.html#a0">Includes</a><br />
<code>include</code>: <a href="includes.html#a1">Includes</a><br />
<code>includefrom {filename}</code>: <a href="includes.html#a2">Includes</a><br />
<code>includeonce</code>: <a href="includes.html#a3">Includes</a><br />
<code>freespace {ram/noram}[,norats][,align][,cleaned][,static][,bankcross][,bank={num}][,start={num}][,pin={label}]</code>: <a href="freespace.html#a0">Freespace</a><br />
<code>freecode [options...]</code>: <a href="freespace.html#a0">Freespace</a><br />
<code>freedata [options...]</code>: <a href="freespace.html#a0">Freespace</a><br />
<code>segment [ram/noram][,align][,bankcross][,bank={num}][,start={num}][,pin={label}]</code>: <a href="freespace.html#a0">Freespace</a><br />
<code>freespacebyte {value}</code>: <a href="freespace.html#a1">Freespace</a><br />
<code>freespace_settings {options...}</code>: <a href="freespace.html#a2">Freespace</a><br />
<code>autoclean jml/jsl/lda/cmp/.../dl {label}</code>: <a href="freespace.html#a3">Freespace</a><br />
<code>autoclean {snes_address}</code>: <a href="freespace.html#a3">Freespace</a><br />
<code>prot {label}[,label...]</code>: <a href="freespace.html#a4">Freespace</a><br />
<code>print {text_or_function}[,text_or_function...]</code>: <a href="prints.html#a0">Text Output</a><br />
<code>reset freespaceuse</code>: <a href="prints.html#a1">Text Output</a><br />
<code>reset bytes</code>: <a href="prints.html#a2">Text Output</a><br />
<code>warn [text_or_function...]</code>: <a href="prints.html#a3">Text Output</a><br />
<code>error [text_or_function...]</code>: <a href="prints.html#a4">Text Output</a><br />
<code>assert {condition}[,text_or_function...]</code>: <a href="prints.html#a5">Text Output</a><br />
<code>check title &quot;{title}&quot;</code>: <a href="checks.html#a0">Checks</a><br />
<code>check bankcross {off/half/full}</code>: <a href="checks.html#a1">Checks</a><br />
<code>warnings {push/pull}</code>: <a href="warnings.html#a0">Warnings</a><br />
<code>warnings {enable/disable} {name}</code>: <a href="warnings.html#a1">Warnings</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="list-of-all-warnings"><a class="header" href="#list-of-all-warnings">List of all warnings</a></h1>
<p>This list is extracted directly from the source code. Some warnings might be unused or have incomplete messages (due to the messages being partially computed at runtime).</p>
<div class="table-wrapper"><table><thead><tr><th>Warning name</th><th>Message</th><th>Enabled by default</th></tr></thead><tbody>
<tr><td>Wrelative_path_used</td><td>Relative %s path passed to asar_patch_ex() - please use absolute paths only to prevent undefined behavior!</td><td>yes</td></tr>
<tr><td>Wrom_too_short</td><td>ROM is too short to have a title. (Expected '%s')</td><td>yes</td></tr>
<tr><td>Wrom_title_incorrect</td><td>ROM title is incorrect. Expected '%s', got '%s'.</td><td>yes</td></tr>
<tr><td>Wspc700_assuming_8_bit</td><td>This opcode does not exist with 16-bit parameters, assuming 8-bit.</td><td>yes</td></tr>
<tr><td>Wassuming_address_mode</td><td>The addressing mode %s is not valid for this instruction, assuming %s.%s</td><td>yes</td></tr>
<tr><td>Wset_middle_byte</td><td>It would be wise to set the 008000 bit of this address.</td><td>yes</td></tr>
<tr><td>Wfreespace_leaked</td><td>This freespace appears to be leaked.</td><td>yes</td></tr>
<tr><td>Wwarn_command</td><td>warn command%s</td><td>yes</td></tr>
<tr><td>Wimplicitly_sized_immediate</td><td>Implicitly sized immediate.</td><td>no</td></tr>
<tr><td>Wcheck_memory_file</td><td>Accessing file '%s' which is not in memory while W%d is enabled.</td><td>no</td></tr>
<tr><td>Wdatasize_last_label</td><td>Datasize used on last detected label '%s'.</td><td>yes</td></tr>
<tr><td>Wdatasize_exceeds_size</td><td>Datasize exceeds 0xFFFF for label '%s'.</td><td>yes</td></tr>
<tr><td>Wmapper_already_set</td><td>A mapper has already been selected.</td><td>yes</td></tr>
<tr><td>Wfeature_deprecated</td><td>DEPRECATION NOTIFICATION: Feature &quot;%s&quot; is deprecated and will be REMOVED in the future. Please update your code to conform to newer styles. Suggested work around: %s.</td><td>yes</td></tr>
<tr><td>Winvalid_warning_id</td><td>Warning '%s' (passed to %s) doesn't exist.</td><td>yes</td></tr>
<tr><td>Wbyte_order_mark_utf8</td><td>UTF-8 byte order mark detected and skipped.</td><td>yes</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="list-of-all-errors"><a class="header" href="#list-of-all-errors">List of all errors</a></h1>
<p>This list is extracted directly from the source code. Some errors might be unused or have incomplete messages (due to the messages being partially computed at runtime).</p>
<div class="table-wrapper"><table><thead><tr><th>Error name</th><th>Message</th></tr></thead><tbody>
<tr><td>Elimit_reached</td><td>Over %d errors detected. Aborting.</td></tr>
<tr><td>Ewerror</td><td>One or more warnings was detected with werror on.</td></tr>
<tr><td>Ebuffer_too_small</td><td>The given buffer is too small to contain the resulting ROM.</td></tr>
<tr><td>Eparams_null</td><td>params passed to asar_patch_ex() is null.</td></tr>
<tr><td>Eparams_invalid_size</td><td>Size of params passed to asar_patch_ex() is invalid.</td></tr>
<tr><td>Ecmdl_define_invalid</td><td>Invalid define name in %s: '%s'.</td></tr>
<tr><td>Ecmdl_define_override</td><td>%s '%s' overrides a previous define. Did you specify the same define twice?</td></tr>
<tr><td>Ecreate_rom_failed</td><td>Couldn't create ROM.</td></tr>
<tr><td>Eopen_rom_failed</td><td>Couldn't open ROM.</td></tr>
<tr><td>Eopen_rom_not_smw_extension</td><td>Doesn't look like an SMW ROM. (Maybe its extension is wrong?)</td></tr>
<tr><td>Eopen_rom_not_smw_header</td><td>Doesn't look like an SMW ROM. (Maybe it's headered?)</td></tr>
<tr><td>Estddefines_no_identifier</td><td>stddefines.txt contains a line with a value, but no identifier.</td></tr>
<tr><td>Estddefine_after_closing_quote</td><td>Broken std defines. (Something after closing quote)</td></tr>
<tr><td>Efailed_to_open_file</td><td>Failed to open file '%s'.</td></tr>
<tr><td>Efile_not_found</td><td>File '%s' wasn't found.</td></tr>
<tr><td>Efile_offset_out_of_bounds</td><td>File offset %s out of bounds for file '%s'.</td></tr>
<tr><td>Emismatched_parentheses</td><td>Mismatched parentheses.</td></tr>
<tr><td>Einvalid_hex_value</td><td>Invalid hex value.</td></tr>
<tr><td>Einvalid_binary_value</td><td>Invalid binary value.</td></tr>
<tr><td>Einvalid_character</td><td>Invalid character.</td></tr>
<tr><td>Estring_literal_not_terminated</td><td>String literal not terminated.</td></tr>
<tr><td>Emalformed_function_call</td><td>Malformed function call.</td></tr>
<tr><td>Einvalid_number</td><td>Invalid number.</td></tr>
<tr><td>Egarbage_near_quoted_string</td><td>Garbage near quoted string.</td></tr>
<tr><td>Emismatched_quotes</td><td>Mismatched quotes.</td></tr>
<tr><td>Erom_too_short</td><td>ROM is too short to have a title. (Expected '%s')</td></tr>
<tr><td>Erom_title_incorrect</td><td>ROM title is incorrect. Expected '%s', got '%s'.</td></tr>
<tr><td>Ebank_border_crossed</td><td>A bank border was crossed, SNES address $%06X.</td></tr>
<tr><td>Estart_of_file</td><td>This command may only be used at the start of a file.</td></tr>
<tr><td>Einvalid_version_number</td><td>Invalid version number.</td></tr>
<tr><td>Easar_too_old</td><td>This version of Asar is too old for this patch.</td></tr>
<tr><td>Erelative_branch_out_of_bounds</td><td>Relative branch out of bounds. (Distance is %s).</td></tr>
<tr><td>Esnes_address_doesnt_map_to_rom</td><td>SNES address %s doesn't map to ROM.</td></tr>
<tr><td>Esnes_address_out_of_bounds</td><td>SNES address %s out of bounds.</td></tr>
<tr><td>Einvalid_tcall</td><td>Invalid tcall.</td></tr>
<tr><td>Euse_xplus</td><td>Use (x+) instead.</td></tr>
<tr><td>Eopcode_length_too_long</td><td>Opcode length is too long.</td></tr>
<tr><td>Esuperfx_invalid_short_address</td><td>Invalid short address parameter: $%s. (Must be even number and $0000-$01FE)</td></tr>
<tr><td>Esuperfx_invalid_register</td><td>Invalid register for opcode; valid range is %d-%d.</td></tr>
<tr><td>Einvalid_opcode_length</td><td>Invalid opcode length specification.</td></tr>
<tr><td>Einvalid_mapper</td><td>Invalid mapper.</td></tr>
<tr><td>Enan</td><td>NaN encountered.</td></tr>
<tr><td>Edivision_by_zero</td><td>Division by zero.</td></tr>
<tr><td>Emodulo_by_zero</td><td>Modulo by zero.</td></tr>
<tr><td>Eunknown_operator</td><td>Unknown operator.</td></tr>
<tr><td>Einvalid_input</td><td>Invalid input.</td></tr>
<tr><td>Einvalid_function_name</td><td>Invalid function name.</td></tr>
<tr><td>Efunction_not_found</td><td>Function '%s' wasn't found.</td></tr>
<tr><td>Efunction_redefined</td><td>Function '%s' redefined.</td></tr>
<tr><td>Ebroken_function_declaration</td><td>Broken function declaration.</td></tr>
<tr><td>Ewrong_num_parameters</td><td>Wrong number of parameters to function.</td></tr>
<tr><td>Einvalid_param_name</td><td>Invalid parameter name.</td></tr>
<tr><td>Einvalid_label_name</td><td>Invalid label name.</td></tr>
<tr><td>Elabel_not_found</td><td>Label '%s' wasn't found.</td></tr>
<tr><td>Elabel_redefined</td><td>Label '%s' redefined.</td></tr>
<tr><td>Ebroken_label_definition</td><td>Broken label definition.</td></tr>
<tr><td>Emacro_label_outside_of_macro</td><td>Macro label outside of a macro.</td></tr>
<tr><td>Einvalid_namespace_name</td><td>Invalid namespace name.</td></tr>
<tr><td>Einvalid_namespace_use</td><td>Invalid use of namespace command.</td></tr>
<tr><td>Einvalid_struct_name</td><td>Invalid struct name.</td></tr>
<tr><td>Estruct_not_found</td><td>Struct '%s' wasn't found.</td></tr>
<tr><td>Estruct_redefined</td><td>Struct '%s' redefined.</td></tr>
<tr><td>Estruct_invalid_parent_name</td><td>Invalid parent name.</td></tr>
<tr><td>Einvalid_label_missing_closer</td><td>Invalid label name, missing array closer.</td></tr>
<tr><td>Einvalid_subscript</td><td>Invalid array subscript after first scope resolution.</td></tr>
<tr><td>Elabel_missing_parent</td><td>This label has no parent.</td></tr>
<tr><td>Estruct_without_endstruct</td><td>struct without matching endstruct.</td></tr>
<tr><td>Enested_struct</td><td>Can not nest structs.</td></tr>
<tr><td>Emissing_struct_params</td><td>Missing struct parameters.</td></tr>
<tr><td>Etoo_many_struct_params</td><td>Too many struct parameters.</td></tr>
<tr><td>Emissing_extends</td><td>Missing extends keyword.</td></tr>
<tr><td>Einvalid_endstruct_count</td><td>Invalid endstruct parameter count.</td></tr>
<tr><td>Eexpected_align</td><td>Expected align parameter.</td></tr>
<tr><td>Eendstruct_without_struct</td><td>endstruct can only be used in combination with struct.</td></tr>
<tr><td>Ealignment_too_small</td><td>Alignment must be &gt;= 1.</td></tr>
<tr><td>Einvalid_define_name</td><td>Invalid define name.</td></tr>
<tr><td>Edefine_not_found</td><td>Define '%s' wasn't found.</td></tr>
<tr><td>Ebroken_define_declaration</td><td>Broken define declaration.</td></tr>
<tr><td>Eoverriding_builtin_define</td><td>Trying to set define '%s', which is the name of a built-in define and thus can't be modified.</td></tr>
<tr><td>Edefine_label_math</td><td>!Define #= Label is not allowed with non-static labels.</td></tr>
<tr><td>Emismatched_braces</td><td>Mismatched braces.</td></tr>
<tr><td>Einvalid_macro_name</td><td>Invalid macro name.</td></tr>
<tr><td>Emacro_not_found</td><td>Macro '%s' wasn't found.</td></tr>
<tr><td>Emacro_redefined</td><td>Macro '%s' redefined. First defined at: %s:%d</td></tr>
<tr><td>Ebroken_macro_declaration</td><td>Broken macro declaration.</td></tr>
<tr><td>Einvalid_macro_param_name</td><td>Invalid macro parameter name.</td></tr>
<tr><td>Emacro_param_not_found</td><td>Macro parameter '%s' wasn't found.%s</td></tr>
<tr><td>Emacro_param_redefined</td><td>Macro parameter '%s' redefined</td></tr>
<tr><td>Ebroken_macro_usage</td><td>Broken macro usage.</td></tr>
<tr><td>Emacro_wrong_num_params</td><td>Wrong number of parameters to macro.</td></tr>
<tr><td>Emisplaced_endmacro</td><td>Misplaced endmacro.</td></tr>
<tr><td>Eunclosed_macro</td><td>Unclosed macro: '%s'.</td></tr>
<tr><td>Elabel_in_conditional</td><td>Non-static label in %s command.</td></tr>
<tr><td>Emisplaced_elseif</td><td>Misplaced elseif.</td></tr>
<tr><td>Eelseif_in_while</td><td>Can't use elseif in a while loop.</td></tr>
<tr><td>Emisplaced_endif</td><td>Misplaced endif.</td></tr>
<tr><td>Emisplaced_else</td><td>Misplaced else.</td></tr>
<tr><td>Eelse_in_while_loop</td><td>Can't use else in a while loop.</td></tr>
<tr><td>Eunclosed_if</td><td>Unclosed if statement.</td></tr>
<tr><td>Eunknown_command</td><td>Unknown command.</td></tr>
<tr><td>Ebroken_incbin</td><td>Broken incbin command.</td></tr>
<tr><td>Erecursion_limit</td><td>Recursion limit reached.</td></tr>
<tr><td>Ecant_be_main_file</td><td>This file may not be used as the main file.%s</td></tr>
<tr><td>Eno_labels_here</td><td>Can't use non-static labels here.</td></tr>
<tr><td>Einvalid_freespace_request</td><td>Invalid freespace request.</td></tr>
<tr><td>Estatic_freespace_autoclean</td><td>A static freespace must be targeted by at least one autoclean.</td></tr>
<tr><td>Estatic_freespace_growing</td><td>A static freespace may not grow.</td></tr>
<tr><td>Eno_freespace_in_mapped_banks</td><td>No freespace found in the mapped banks. (Requested size: %s)</td></tr>
<tr><td>Eno_freespace</td><td>No freespace found. (Requested size: %s)</td></tr>
<tr><td>Eprot_not_at_freespace_start</td><td>PROT must be used at the start of a freespace block.</td></tr>
<tr><td>Eprot_too_many_entries</td><td>Too many entries to PROT.</td></tr>
<tr><td>Eautoclean_in_freespace</td><td>autoclean used in freespace.</td></tr>
<tr><td>Eautoclean_label_at_freespace_end</td><td>Don't autoclean a label at the end of a freespace block, you'll remove some stuff you're not supposed to remove.</td></tr>
<tr><td>Ebroken_autoclean</td><td>Broken autoclean command.</td></tr>
<tr><td>Epulltable_without_table</td><td>Using pulltable when there is no table on the stack yet.</td></tr>
<tr><td>Epad_in_freespace</td><td>pad does not make sense in a freespaced code.</td></tr>
<tr><td>Ebase_label_invalid</td><td>base Label is not valid.</td></tr>
<tr><td>Epushpc_without_pullpc</td><td>pushpc without matching pullpc.</td></tr>
<tr><td>Epullpc_without_pushpc</td><td>pullpc without matching pushpc.</td></tr>
<tr><td>Epullpc_different_arch</td><td>pullpc in another architecture than the pushpc.</td></tr>
<tr><td>Epullbase_without_pushbase</td><td>pullbase without matching pushbase.</td></tr>
<tr><td>Einvalid_check</td><td>Invalid check command.</td></tr>
<tr><td>Eassertion_failed</td><td>Assertion failed%s</td></tr>
<tr><td>Eerror_command</td><td>error command%s</td></tr>
<tr><td>Einvalid_print_function_syntax</td><td>Invalid printable string syntax.</td></tr>
<tr><td>Eunknown_variable</td><td>Unknown variable.</td></tr>
<tr><td>Epushwarnings_without_pullwarnings</td><td>warnings push without matching warnings pull.</td></tr>
<tr><td>Epullwarnings_without_pushwarnings</td><td>warnings pull without matching warnings push.</td></tr>
<tr><td>Efailed_to_open_file_access_denied</td><td>Failed to open file '%s'. Access denied.</td></tr>
<tr><td>Efailed_to_open_not_regular_file</td><td>Failed to open file '%s'. Not a regular file (did you try to use a directory?)</td></tr>
<tr><td>Ebad_dp_base</td><td>The dp base should be page aligned (i.e. a multiple of 256), got %s</td></tr>
<tr><td>Ebad_dp_optimize</td><td>Bad dp optimize value %s, expected: [none, ram, always]</td></tr>
<tr><td>Ebad_address_optimize</td><td>Bad dp optimize value %s, expected: [default, ram, mirrors]</td></tr>
<tr><td>Ebad_optimize</td><td>Bad optimize value %s, expected: [dp, address]</td></tr>
<tr><td>Erequire_parameter</td><td>Missing required function parameter</td></tr>
<tr><td>Eexpected_parameter</td><td>Not enough parameters in calling of function %s</td></tr>
<tr><td>Eunexpected_parameter</td><td>Too many parameters in calling of function %s</td></tr>
<tr><td>Eduplicate_param_name</td><td>Duplicated parameter name: %s in creation of function %s</td></tr>
<tr><td>Einvalid_alignment</td><td>Invalid alignment. Expected a power of 2.</td></tr>
<tr><td>Ealignment_too_big</td><td>Requested alignment too large.</td></tr>
<tr><td>Enegative_shift</td><td>Bitshift amount is negative.</td></tr>
<tr><td>Emacro_not_varadic</td><td>Invalid use of %s, active macro is not variadic.</td></tr>
<tr><td>Evararg_sizeof_nomacro</td><td>Invalid use of sizeof(...), no active macro.</td></tr>
<tr><td>Emacro_wrong_min_params</td><td>Variadic macro call with too few parameters</td></tr>
<tr><td>Evararg_out_of_bounds</td><td>Variadic macro parameter %s is out of bounds.%s</td></tr>
<tr><td>Evararg_must_be_last</td><td>Variadic macro parameter must be the last parameter.</td></tr>
<tr><td>Einvalid_global_label</td><td>Global label definition contains an invalid label [%s].</td></tr>
<tr><td>Espc700_addr_out_of_range</td><td>Address %s out of range for instruction, valid range is 0000-1FFF</td></tr>
<tr><td>Elabel_ambiguous</td><td>Label (%s) location is ambiguous due to straddling optimization border.</td></tr>
<tr><td>Efeature_unavaliable_in_spcblock</td><td>This feature may not be used while an spcblock is active</td></tr>
<tr><td>Eendspcblock_without_spcblock</td><td>Use of endspcblock without matching spcblock</td></tr>
<tr><td>Emissing_endspcblock</td><td>Use of endspcblock without matching spcblock</td></tr>
<tr><td>Espcblock_inside_struct</td><td>Can not start an spcblock while a struct is still open</td></tr>
<tr><td>Espcblock_too_few_args</td><td>Too few args passed to spcblock</td></tr>
<tr><td>Espcblock_too_many_args</td><td>Too many args passed to spcblock</td></tr>
<tr><td>Eunknown_spcblock_type</td><td>Unknown spcblock format</td></tr>
<tr><td>Ecustom_spcblock_missing_macro</td><td>Custom spcblock types must refer to a valid macro</td></tr>
<tr><td>Espcblock_macro_doesnt_exist</td><td>Macro specified to custom spcblock was not found</td></tr>
<tr><td>Eextra_spcblock_arg_for_type</td><td>Only custom spcblock type takes a fourth argument</td></tr>
<tr><td>Espcblock_macro_must_be_varadic</td><td>Custom spcblock macros must be variadic</td></tr>
<tr><td>Espcblock_macro_invalid_static_args</td><td>Custom spcblock macros must have three static arguments</td></tr>
<tr><td>Espcblock_custom_types_incomplete</td><td>Custom spcblock types are not yet supported. One day.</td></tr>
<tr><td>Einvalid_endspcblock_arg</td><td>Invalid argument to endspcblock: &quot;%s&quot;</td></tr>
<tr><td>Eunknown_endspcblock_format</td><td>Unsupported endspcblock format. Currently supported formats are &quot;endspcblock&quot; and &quot;endspcblock execute [label]&quot;</td></tr>
<tr><td>Einternal_error</td><td>An internal error occured (%s). This is a bug in Asar, please report it at https://github.com/RPGHacker/asar/issues, along with a patch that reproduces it if possible.</td></tr>
<tr><td>Epushns_without_pullns</td><td>pushns without matching pullns.</td></tr>
<tr><td>Epullns_without_pushns</td><td>pullns without matching pushns.</td></tr>
<tr><td>Elabel_forward</td><td>The use of forward labels is not allowed in this context.</td></tr>
<tr><td>Eundefined_char</td><td>'%s' is not defined in the character table</td></tr>
<tr><td>Einvalid_utf8</td><td>Invalid text encoding detected. Asar expects UTF-8-encoded text. Please re-save this file in a text editor of choice using UTF-8 encoding.</td></tr>
<tr><td>Ecmdl_utf16_to_utf8_failed</td><td>UTF-16 to UTF-8 string conversion failed: %s.</td></tr>
<tr><td>Ebroken_command</td><td>Broken %s command. %s</td></tr>
<tr><td>Eoob</td><td>Operation out of bounds: Requested index %d for object of size %d</td></tr>
<tr><td>Eunclosed_vararg</td><td>Variadic macro parameter wasn't closed properly.</td></tr>
<tr><td>Einvalid_vararg</td><td>Trying to use variadic macro parameter syntax to resolve a non variadic argument &lt;%s&gt;.</td></tr>
<tr><td>Einvalid_depth_resolve</td><td>Invalid %s resolution depth: Trying to backwards-resolve a %s using %i '^', but current scope only supports up to %i '^'.</td></tr>
<tr><td>Eplatform_paths</td><td>Platform-specific paths aren'supported. Please use platform-independent paths (use / instead of \\).</td></tr>
<tr><td>Ebad_single_line_for</td><td>Single-line for loop not allowed here.</td></tr>
<tr><td>Ebroken_for_loop</td><td>Broken for loop command: %s</td></tr>
<tr><td>Emissing_org</td><td>Missing org or freespace command.</td></tr>
<tr><td>Eunclosed_block_comment</td><td>Unclosed block comment.</td></tr>
<tr><td>Ebad_addr_mode</td><td>This addressing mode is not valid for this instruction.</td></tr>
<tr><td>Ebad_access_width</td><td>This addressing mode can accept %s arguments, but the provided argument is %d-bit.</td></tr>
<tr><td>Elabel_before_if</td><td>Labels are not allowed before &quot;%s&quot; commands. Suggestion: move the label to a separate line.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="asar-changelog"><a class="header" href="#asar-changelog">Asar Changelog</a></h1>
<h2 id="v200"><a class="header" href="#v200">v2.0.0</a></h2>
<p><strong>Release:</strong> ???</p>
<h3 id="contributors"><a class="header" href="#contributors">Contributors:</a></h3>
<ul>
<li>trillian</li>
<li>RPG Hacker</li>
<li>p4plus2</li>
</ul>
<h3 id="new-features"><a class="header" href="#new-features">New features:</a></h3>
<ul>
<li>UTF-8 support: Asar now expects all source files to be UTF-8-encoded. Unicode code points (encoded as UTF-8) are now supported in table files, math commands, tables etc. Unicode file names are now also supported on Windows. (trillian, RPG Hacker)</li>
<li>Added support for nested macro definitions. (RPG Hacker)</li>
<li>Improved readability of some error messages. (RPG Hacker)</li>
<li>Generally improved error formatting of Asar and added the <code>--full-error-stack</code> option to display complete call stacks. (RPG Hacker)</li>
<li>Added multiline comments using <code>;[[ comment ]]</code> (trillian)</li>
<li>Freespaces have a bunch of new features which make them more useful outside of SMW hacking - new options for disabling RATS tags, looking for code in a specific bank or a specific part of ROM. Along with this, freespace allocation should now be a bit more efficient, and the 125 freespace limit has been lifted. (trillian)</li>
<li>Freespaces can now have some options applied by default using the <code>freespace_settings</code> command. (trillian)</li>
<li>Allowed spaces in math. (p4plus2)</li>
<li>A struct can now be used directly like a regular label. (p4plus2)</li>
<li>Greatly improved &quot;invalid instruction&quot; errors, which now tell you when an addressing mode doesn't exist for the current instruction, instead of saying &quot;unknown command&quot; for everything. (trillian)</li>
<li><code>autoclean</code> can now be used with more instructions, allowing such contraptions as <code>autoclean cmp label,x</code> if desired. (trillian)</li>
</ul>
<h3 id="bug-fixes"><a class="header" href="#bug-fixes">Bug fixes:</a></h3>
<ul>
<li>Asar no longer strips just any white space from defines, allowing them to more closely reflect user intent. (p4plus2)</li>
<li>Using <code>org $xxxxxx : db $00</code> to expand the ROM to a specific size will now allow the freespace finder to use the newly created space. (trillian)</li>
<li>In <code>norom</code>, using <code>base</code> will now no longer give bank cross errors for the &quot;real&quot; position, since there are no real banks in norom. (trillian)</li>
<li>Better branch instruction handling: some legal but previously rejected branches (especially wrapping around bank borders) are now accepted, and some illegal branches are now properly rejected. (binary1230)</li>
<li>A bunch more bugfixes and crash fixes that are too minor to list here</li>
</ul>
<h3 id="removed-features"><a class="header" href="#removed-features">Removed features:</a></h3>
<ul>
<li>All features that were deprecated in Asar v1.90 or earlier.</li>
</ul>
<hr />
<h2 id="v190"><a class="header" href="#v190">v1.90</a></h2>
<p><strong>Release:</strong> February 23, 2024</p>
<h3 id="contributors-1"><a class="header" href="#contributors-1">Contributors:</a></h3>
<ul>
<li>RPG Hacker</li>
<li>trillian</li>
<li>p4plus2</li>
<li>Atari2</li>
<li>Alcaro</li>
<li>spooonsss</li>
</ul>
<h3 id="notes"><a class="header" href="#notes">Notes:</a></h3>
<ul>
<li>The primary purpose of this release is to be a stepping stone towards Asar 2.0. For this purpose, a lot of features have been deprecated and will now throw warnings. Please fix any of those warnings you come across in your patches to assure they will still assemble in Asar 2.0.</li>
</ul>
<h3 id="new-features-1"><a class="header" href="#new-features-1">New features:</a></h3>
<ul>
<li>The <code>error</code>, <code>warn</code> and <code>assert</code> commands now support the same functions as the <code>print</code> command. (RPG Hacker)</li>
<li>Static labels (i.e. labels that don't move between passes) can now be used in more places, including if statements. (RPG Hacker)</li>
<li>Asar can be built as a static library. (Atari2)</li>
<li>Asar now uses named warnings and errors instead of magic numbers as identifiers. (p4plus2, RPG Hacker)</li>
<li>Variadic macro parameters now use the syntax <code>&lt;...[math]&gt;</code>, which makes them less ambiguous and helps prevent syntax parsing bugs. (RPG Hacker)</li>
<li>HiROM, ExHiROM, and ExLoROM mappers can now use <code>freecode</code>. (p4plus2)</li>
<li><code>check bankcross</code> now allows disabling checking for half-bank crossings (going from $7FFF to $8000). (p4plus2)</li>
<li>New <code>pc()</code> and <code>realbase()</code> functions: return the current SNES address that is being written to. (p4plus2, trillian)</li>
<li>Namespaces can now be saved using <code>pushns</code> and <code>pullns</code>. (p4plus2)</li>
<li><code>while</code> loops can now be ended with <code>endwhile</code>. (p4plus2)</li>
<li>It's now possible to use macro arguments and macro labels in files that are <code>incsrc</code>'d from macros. (trillian)</li>
<li>Added <code>for</code> loops, used like <code>for i = 1..10</code>. These are more convenient than while loops in most cases and are the main replacement for <code>rep</code>. (trillian)</li>
<li><code>incbin</code> now has a new syntax for including a range of the target file which looks like the for loop range syntax and is less ambiguous. (trillian)</li>
<li>Added <code>spcblock</code> feature as a replacement for <code>spc-inline</code>, which allows defining blocks of SPC data, but in a more flexible way that can easily be extended in the future. (p4plus2)</li>
<li>Added the <code>--error-limit</code> option, which allows raising the limit on the number of errors that Asar will print before stopping. (trillian)</li>
<li><code>freespacebyte</code> command to set the byte value used for searching for freespace and expanding the ROM. (trillian)</li>
</ul>
<h3 id="bug-fixes-1"><a class="header" href="#bug-fixes-1">Bug fixes:</a></h3>
<ul>
<li>Variadic arguments in macros can now also take zero arguments, which can be used to implement optional arguments. (RPG Hacker)</li>
<li>Escaping quotes in macro calls now works more reliably. (RPG Hacker)</li>
<li>Macro calls &amp; definitions no longer break as easily from including whitespace. (RPG Hacker)</li>
<li>For invalid table files, Asar now prints the line number of the first invalid entry. (RPG Hacker)</li>
<li>Addr-to-line mappings now include <code>autoclean jml/jsl</code> commands, pseudo opcodes like <code>asl #4</code>, and most other data-writing commands like <code>db/dw/dl</code>. (spooonsss, RPG Hacker, trillian)</li>
<li><code>'''</code> and <code>';'</code> are now valid can now be used without causing errors. (trillian, RPG Hacker)</li>
<li>Fixed some edge case bugs in Asar's virtual filesystem (usable via the DLL) on Windows. (Atari2)</li>
<li>The <code>--version</code> commandline flag now causes asar to exit afterwards, which is the expected behavior for command-line flags. (Alcaro)</li>
<li>Fixed some bugs with the label optimizer, making it optimize better. (p4plus2)</li>
<li>Fixed freespaces sometimes being a few bytes too long. (trillian)</li>
<li>Assigning labels with = now puts them in the right namespace. (p4plus2)</li>
<li>Fixed some memory leaks and possible crashes in the DLL. (trillian)</li>
<li>Fixed some phantom errors when using forward labels. (trillian)</li>
<li>Asar should now allow as much recursion as system resources allow, and then throw a nice error instead of crashing. (Atari2.0, trillian, p4plus2)</li>
<li><code>optimize address</code> now works a bit more consistently (new behavior also properly documented in manual). (trillian)</li>
<li>Fixed bug where pointing multiple autocleans at the same freespace would sometimes eat some of the data in it. (spooonsss)</li>
</ul>
<h3 id="deprecated-features"><a class="header" href="#deprecated-features">Deprecated features:</a></h3>
<ul>
<li>Warning and error IDs: Use new name strings instead.</li>
<li>xkas compatibility mode: port your patch to asar instead. Everything xkas compatibility mode does should already throw warnings.</li>
<li><code>JMP.l</code>: Use <code>JML</code> instead.</li>
<li>Quoted symbolic arguments to functions (e.g. <code>sizeof(&quot;my_struct&quot;)</code>): Remove the quotes (<code>sizeof(my_struct)</code>).</li>
<li>Redefining previously defined functions.</li>
<li><code>math round</code> and <code>math pri</code>: Use parentheses and explicit rounding where xkas-style math emulation is needed instead.</li>
<li><code>if !condition</code> to negate conditions: Use <code>if not(condition)</code> instead.</li>
<li>While blocks ending with <code>endif</code>: Use <code>endwhile</code> instead.</li>
<li><code>check bankcross on</code>: Use <code>check bankcross full</code> or <code>check bankcross half</code> instead.</li>
<li><code>rep</code> to repeat commands: Use while loops, unrolled loops or for loops instead.</li>
<li>Windows-specific paths (e.g. <code>incsrc dir\file.asm</code>): Use cross-platform paths instead (<code>incsrc dir/file.asm</code>).</li>
<li><code>table</code> command: Assign characters directly instead, like <code>'a' = $00</code>.</li>
<li><code>spc700-inline</code>: Use <code>spcblock</code> and <code>endspcblock</code> instead.</li>
<li><code>spc700-raw</code>: use <code>arch spc700</code> and <code>norom</code>.</li>
<li><code>fastrom</code>: Has never actually worked and can be removed.</li>
<li><code>header</code>: Doesn't do anything and can be removed.</li>
<li><code>#</code> before numbers in <code>db/dw/dl/dd</code> statements: this was intended for xkas compatibility but was for some reason enabled everywhere without a warning. The <code>#</code> does nothing and can be removed.</li>
<li>Non-UTF-8 source files: Re-save your source files as UTF-8 in a text editor of choice.</li>
<li><code>;@command</code> and <code>@command</code> notation: Use <code>command</code> instead.</li>
<li>Single-line/inline if statements: Use full if blocks with an <code>if</code>/<code>endif</code> pair instead. (Note that you can still have an if statement entirely on one line, you just need to have an <code>: endif</code> at the end of it.)</li>
<li><code>freespace fixed</code>: Use <code>freespace static</code> instead.</li>
<li><code>&lt;math&gt;</code> syntax for variadic macro parameters: Use <code>&lt;...[math]&gt;</code> instead.</li>
<li>incbin with a range like <code>incbin file.bin:0-F</code>: use <code>incbin file.bin:$0..$10</code> instead. (note that the new syntax is end-exclusive.)</li>
<li><code>incbin file.bin -&gt; target</code>: put an <code>org</code> or <code>freespace</code> command before the incbin.</li>
<li><code>if a = b</code>: use <code>if a == b</code> instead.</li>
<li>Comments starting with <code>;[[</code> : These mark the start of block comments in Asar 2.0, so either remove the <code>[[</code> for the time being, or make the commented line end with a <code>]]</code>.</li>
<li>Using <code>A</code> as a label name ambiguously, e.g. <code>lda a</code>: in Asar 2 this will be interpreted as trying to use the &quot;A&quot; addressing mode, and will give an error. You can use <code>A+0</code> if you really must refer to the label as is.</li>
<li>The <code>startpos</code> command of the <code>spc700-inline</code> architecture: use the optional <code>execute</code> argument to <code>endspcblock</code> instead.</li>
<li>Specifying the byte to use for freespace like <code>freecode $ff</code>. Use the new separate <code>freespacebyte</code> command for it.</li>
<li>The <code>warnpc</code> command: use <code>assert pc() &lt;= $xxxxxx</code> instead.</li>
</ul>
<hr />
<h2 id="v181"><a class="header" href="#v181">v1.81</a></h2>
<p><strong>Release:</strong> January 20, 2021</p>
<h3 id="contributors-2"><a class="header" href="#contributors-2">Contributors:</a></h3>
<ul>
<li>p4plus2</li>
</ul>
<h3 id="bug-fixes-2"><a class="header" href="#bug-fixes-2">Bug fixes:</a></h3>
<ul>
<li>Prevent defines from being resolved in false branches of if statements when inside variadic macros</li>
<li>Fix a phantom error when referencing a struct before defining it</li>
</ul>
<hr />
<h2 id="v180"><a class="header" href="#v180">v1.80</a></h2>
<p><strong>Release:</strong> January 18, 2021</p>
<h3 id="contributors-3"><a class="header" href="#contributors-3">Contributors:</a></h3>
<ul>
<li>RPG Hacker</li>
<li>randomdude999</li>
<li>p4plus2</li>
<li>CypherSignal</li>
<li>LDAsuku</li>
<li>Katrina</li>
<li>Atari2.0</li>
<li>Vitor Vilela</li>
</ul>
<h3 id="new-features-2"><a class="header" href="#new-features-2">New features:</a></h3>
<ul>
<li>The C DLL binding for Windows should now print a few more details if loading the DLL failed. (RPG Hacker)</li>
<li>The <code>print</code> command has a new <code>bin()</code> function. Also, <code>bin()</code>, <code>dec()</code> and <code>hex()</code> now take an optional width argument that allows padding the number with zeroes. (randomdude999)</li>
<li>Labels can now be used in the condition of an <code>assert</code> command. (randomdude999)</li>
<li>The WLA symbol file now includes an address-to-line mapping, which can be used by some debuggers to provide source-level debugging. (CypherSignal)</li>
<li>The <code>sizeof()</code> and <code>objectsize()</code> functions don't need quotes around the struct name anymore. For backwards compatibilty, quotes are still allowed. (p4plus2)</li>
<li>There is a new label optimizer, which can convert RAM labels to direct page or word accesses where possible. For this there are 3 new commands: <code>dpbase</code>, <code>optimize dp</code> and <code>optimize address</code>. (p4plus2)</li>
<li>The <code>floor()</code> and <code>ceil()</code> functions have been added. (randomdude999)</li>
<li>The <code>bank()</code> and <code>&lt;:</code> function and math operator have been added (p4plus2)</li>
<li>The <code>datasize()</code> function has been added. (p4plus2)</li>
<li>Warning if the mapper mode is changed after being set (p4plus2)</li>
<li>Major improvements to internal string handling in asar (makes asar significantly faster) (p4plus2)</li>
<li>Variadic macro support (p4plus2)</li>
<li>Support for global labels (p4plus2)</li>
<li>Errors about crossing banks have been improved, now they print the exact line where the bank border was crossed instead of saying it was &quot;somewhere before this point&quot;. (randomdude999)</li>
<li>Add <code>fill align</code> and <code>skip align</code> (randomdude999)</li>
</ul>
<h3 id="bug-fixes-3"><a class="header" href="#bug-fixes-3">Bug fixes:</a></h3>
<ul>
<li>The Asar DLL can now be loaded in Windows applications that define UNICODE. (RPG Hacker)</li>
<li>Labels can now start with underscores. (LDAsuku)</li>
<li>An <code>undef</code> command inside an unexecuted <code>if</code> statement would still get executed. This is now fixed. (randomdude999)</li>
<li>The <code>assert</code> command would give strange errors when the condition to test contained a comma. This is now fixed. (randomdude999)</li>
<li>Trailing commas can now be used to join lines that contain more than one comma, and the joined lines can now have comments. (randomdude999)</li>
<li>An invalid warning ID in a <code>warnings enable</code> command no longer prints the error message three times. (randomdude999)</li>
<li>When using the Asar DLL, built-in defines (e.g. <code>!assembler_ver</code>) are now always present. Previously they were missing when the DLL was called without specifying a standard defines file. (randomdude999)</li>
<li>Repeatable instructions (like <code>LSR #4</code> don't accept labels in their argument anymore. (randomdude999)</li>
<li>Asar no longer writes an incorrect checksum for ROMs whose size isn't a power of 2, e.g. 2.5MB, 3MB, 6MB. (randomdude999)</li>
<li>The &quot;It would be wise to set the 008000 bit&quot; warning has been relaxed and isn't thrown for labels in banks 70-7F. (randomdude999)</li>
<li>Overwriting built-in functions now throws a warning. Overwriting user-defined functions now also throws a warning for consistency. (randomdude999)</li>
<li>Opcode length specifications were sometimes being ignored in <code>arch spc700</code>. Now <code>adc.w a, $0</code> properly assembles to <code>85 00 00</code> instead of <code>84 00</code>. (randomdude999)</li>
<li>Fixed case sensitivity problem in function calls. (p4plus2)</li>
<li>Fixed struct definition with label base corrupting label name. (p4plus2)</li>
<li>Fixed missing error on certain types of label. (p4plus2)</li>
<li>Fix some phantom errors in math processor (randomdude999)</li>
<li>Fixed a memory leak in the cli version of asar (p4plus2)</li>
<li>Fixed a memory corruption in spc700 processing (p4plus2)</li>
<li>Fixed various memory bugs (found via valgrind/fsanitize) (p4plus2)</li>
<li>Fixed a case where if statements wouldn't always throw an error (randomdude999)</li>
<li>Fixed a case where you could get invisible errors when prefixing commands with <code>@</code> (randomdude999)</li>
<li>Fixed <code>arch superfx</code> ignoring all commands with more than 2 words (randomdude999)</li>
<li>Fixed non-ASCII characters in strings being written as garbage (Katrina)</li>
<li>Fixed crashes when getting into an infinite recursion loop (randomdude999)</li>
<li>Improvements to syntax highlighting in the Asar manual (Atari2.0)</li>
<li>The C# wrapper has been updated to work with Asar versions 1.60 and newer. (Vitor Vilela)</li>
<li>Improved error message for SPC instructions with out of range arguments (randomdude999)</li>
</ul>
<hr />
<h2 id="v171"><a class="header" href="#v171">v1.71</a></h2>
<p><strong>Release:</strong> January 6, 2019</p>
<h3 id="contributors-4"><a class="header" href="#contributors-4">Contributors:</a></h3>
<ul>
<li>randomdude999</li>
</ul>
<h3 id="bug-fixes-4"><a class="header" href="#bug-fixes-4">Bug fixes:</a></h3>
<ul>
<li>The Super FX ROM mapping should now properly support freespace.</li>
<li>The <code>canread()</code> functions returned true for the first byte after the end of the ROM. That has been fixed.</li>
<li>Using <code>check bankcross off</code> now should mess with the PC less (i.e. no forced fastrom addressing).</li>
<li>Using the <code>error</code> command now doesn't print the line of code that caused the error. All warnings except for the one from the <code>warn</code> command should now print the line of code that caused the warning. (note that not all warnings or errors are associated with a specific line of code.)</li>
</ul>
<hr />
<h2 id="v170"><a class="header" href="#v170">v1.70</a></h2>
<p><strong>Release:</strong> January 4, 2019</p>
<h3 id="contributors-5"><a class="header" href="#contributors-5">Contributors:</a></h3>
<ul>
<li>randomdude999</li>
<li>boldowa</li>
</ul>
<h3 id="new-features-3"><a class="header" href="#new-features-3">New features:</a></h3>
<ul>
<li>The <code>fullsa1rom</code> mapper now supports automatic freespace searching. (randomdude999)</li>
<li><code>incbin</code> ranges can now use math as an alternative to unprefixed hex. To use this, surround the math with parentheses. For example, <code>incbin file:(4+2)-($F+$10)</code>. Note that in math statements, unprefixed numbers are decimal, not hex! (randomdude999)</li>
</ul>
<h3 id="bug-fixes-5"><a class="header" href="#bug-fixes-5">Bug fixes:</a></h3>
<ul>
<li>Fixed quite a few crashes in Asar:
<ul>
<li>Fixed a crash when including a directory (randomdude999, found by <a href="http://smwc.me/u/Selicre">Selicre</a>)</li>
<li>Fixed a crash when using a macro sublabel outside of a macro (randomdude999)</li>
<li>Fixed a crash when having unmatched structs in a weird way (randomdude999)</li>
<li>Fixed a crash when appending to a non-existent define (randomdude999, found by Selicre)</li>
<li>Fixed a crash when Asar encountered mismatched quotes after define evaluation (randomdude999, found by Alcaro)</li>
</ul>
</li>
<li>Made Asar about 2x faster than before (randomdude999)</li>
<li>Values larger than $80000000 in things like <code>dd</code> should work better (randomdude999)</li>
<li>Fixed a freespace leak when using <code>prot</code> (randomdude999, found by WhiteYoshiEgg)</li>
<li>Fixed Windows header includes, to make cross-compilation of Asar on Linux work better (boldowa)</li>
</ul>
<hr />
<h2 id="v161"><a class="header" href="#v161">v1.61</a></h2>
<p><strong>Release:</strong> August 22, 2018</p>
<h3 id="contributors-6"><a class="header" href="#contributors-6">Contributors:</a></h3>
<ul>
<li>randomdude999</li>
</ul>
<h3 id="bug-fixes-6"><a class="header" href="#bug-fixes-6">Bug fixes:</a></h3>
<ul>
<li>Fixed asar quietly skipping assembling a line if it had a label followed by 3 or more spaces and ended with <code>&quot;</code>.</li>
<li>In 1.60, <code>if !condition</code> was removed without a proper deprecation process. It has been re-added with a deprecation warning, because a few patches still managed to use it.</li>
</ul>
<hr />
<h2 id="v160"><a class="header" href="#v160">v1.60</a></h2>
<p><strong>Release:</strong> July 6, 2018</p>
<h3 id="contributors-7"><a class="header" href="#contributors-7">Contributors:</a></h3>
<ul>
<li>RPG Hacker</li>
<li>boldowa/6646</li>
<li>zetaPRIME</li>
<li>Horrowind</li>
<li>randomdude999</li>
<li>TheBiob</li>
<li>BenJuan26</li>
<li>Vitor Vilela</li>
<li>KevinCathcart</li>
<li>KungFuFurby</li>
</ul>
<h3 id="new-features-4"><a class="header" href="#new-features-4">New features:</a></h3>
<ul>
<li>
<p>Asar is now officially hosted on GitHub: <a href="https://github.com/RPGHacker/asar">https://github.com/RPGHacker/asar</a></p>
</li>
<li>
<p>Asar now uses CMake, which should make it easier to build on different platforms and with different compilers. (RPG Hacker, randomdude999, boldowa)</p>
</li>
<li>
<p>Added a proper manual in HTML format to Asar, rather than just having the xkas manual and a TXT file with all changes. (RPG Hacker)</p>
</li>
<li>
<p>Added Python binding for the Asar DLL. (randomdude999)</p>
</li>
<li>
<p>Added <code>defined()</code> function (randomdude999) and <code>undef</code> command. (zetaPRIME)</p>
</li>
<li>
<p>Added simple syntax highlighting for Sublime Text. (randomdude999)</p>
</li>
<li>
<p>+/- label declarations can also end with an optional <code>:</code> now for consistency. (RPG Hacker)</p>
</li>
<li>
<p>Added macro-local variations for +/- labels and sub labels, which are also prefixed with a <code>?</code>. (RPG Hacker)</p>
</li>
<li>
<p>Added macro main label assignment. (RPG Hacker)</p>
<pre><code class="language-asar">macro my_macro()
    ?MacroLabel = $008000
    
    dl ?MacroLabel  ; Valid
endmacro

%my_macro()

dl ?MacroLabel      ; Error!
</code></pre>
</li>
<li>
<p>Added support for a new type of label declaration: prefixing a label or sub label declaration (including macro labels) with <code>#</code> will create that label without modifying existing label hierarchies. This is mainly intended for hacky incsrc/routine macros as used by GPS, which can break existing label hierarchies when used. (RPG Hacker)</p>
<pre><code class="language-asar">macro my_new_routine()
    jsl MyNewRoutine
            
    !macro_routine_defined ?= 0
    
    if !macro_routine_defined == 0
        pushpc
        
        freecode cleaned
        
        #MyNewRoutine:
            incsrc routines/mynewroutine.asm
        
        pullpc
    
        !macro_routine_defined = 1
    endif
endmacro

Main:
    %my_new_routine()
.Sub

    ; Both of these are found
    dl MyNewRoutine
    dl Main_Sub
</code></pre>
<p>Note that while it's technically possible to use this feature on sub labels, macro labels and macro sub labels, I don't think there's any reasonable use case for this. In most cases, regular macro labels and regular macro sub labels are recommended for usage inside macros.</p>
</li>
<li>
<p>Added support for include search paths. (RPG Hacker)</p>
</li>
<li>
<p>Added asar_patch_ex() function to DLL API, which works like asar_patch(), but takes additional parameters. (RPG Hacker)</p>
</li>
<li>
<p>You can now escape <code>!</code> by doing <code>\!</code> (useful for preventing Asar to replace defines in certain places). (randomdude999)</p>
</li>
<li>
<p>You can now escape <code>\</code> by doing <code>\\</code>. (RPG Hacker)</p>
</li>
<li>
<p>Added support for <code>pushbase</code>/<code>pullbase</code>. (randomdude999, RPG Hacker)</p>
</li>
<li>
<p>Added <code>check title</code> command which makes Asar verify the title of the output ROM (to assure a patch is applied to the correct ROM). (randomdude999)</p>
</li>
<li>
<p>Added support for nested namespaces. (randomdude999, RPG Hacker)<br />
Enable them via the command:</p>
<pre><code class="language-asar">namespace nested on
</code></pre>
</li>
<li>
<p>Added support for <code>check bankcross off</code> which disables checking for bank crossing. Use with caution; might not work with certain features or outright break some stuff. (randomdude999, RPG Hacker)</p>
</li>
<li>
<p>Added a new, simple README. (randomdude999, RPG Hacker)</p>
</li>
<li>
<p>Added a <code>filesize()</code> function and a <code>getfilestatus()</code> function. (randomdude999)</p>
</li>
<li>
<p>Added support for <code>stdincludes.txt</code> and <code>stddefines.txt</code> - see manual for details. (RPG Hacker, randomdude999)</p>
</li>
<li>
<p>Added support for setting defines via the command line or DLL API. See manual (section: usage) for details. (randomdude999)</p>
</li>
<li>
<p>Added <code>includeonce</code> command for shared files which may be included multiple times, but should only be assembled once. (RPG Hacker)</p>
</li>
<li>
<p>Added support for generating a symbols file. Currently, WLA and no$sns format are supported. (KevinCathcart)</p>
</li>
<li>
<p>Opcode length specifiers (<code>.b</code>, <code>.w</code> and <code>.l</code>) are now also supported for the SPC700 architecture. (KungFuFurby)</p>
</li>
<li>
<p>Added <code>stringsequal()</code> and <code>stringsequalnocase()</code> functions. (RPG Hacker)</p>
</li>
<li>
<p>Added support for some built-in defines. Currently, <code>!assembler</code> and <code>!assembler_ver</code> are supported. Trying to modify those defines will throw an error. (RPG Hacker)</p>
</li>
<li>
<p>Added IDs to all warnings and errors, together with functionality to enable or disable specific warnings. (RPG Hacker)</p>
</li>
<li>
<p>Added a new optional warning that has to be enabled manually to throw warnings when opcodes are implicitly sized. (KevinCathcart)</p>
</li>
<li>
<p>Added functionality to allow overriding Asar's default behavior of enabling/disabling checksum generation based on context. (randomdude999)</p>
</li>
</ul>
<h3 id="bug-fixes-7"><a class="header" href="#bug-fixes-7">Bug fixes:</a></h3>
<ul>
<li>
<p>Fixed various bugs in the DLL interface. It should now hopefully be possible to apply multiple patches in succession via the DLL interface without resorting to hacks. (RPG Hacker, randomdude999, boldowa)</p>
</li>
<li>
<p>Rewrote big parts of test applications once again to make it a lot easier to test a bunch of ASM files and actually get some meaningful information out of it. (RPG Hacker)</p>
</li>
<li>
<p>Fixed the way <code>;@</code> works. This command was really meant for backwards-compatibility with xkas and is supposed to assemble everything following it, which it now does again. (RPG Hacker)<br />
As a result of this change, any of the following are now valid Asar code:</p>
<pre><code class="language-asar">;@asar 1.60
@asar 1.60
asar 1.60
</code></pre>
<p>When Asar finds an unknown command on a line starting with <code>;@</code> or <code>@</code>, it only throws a warning instead of an error. You can make use of this fact by using optional features from newer Asar versions and still have your patch assemble in old Asar versions, where those features are ignored (don't know how practicable and useful this really is, but in theory, it should be possible). And of course it can be used for patches that are compatible with both xkas and Asar, not that that's particularly useful anymore in this day and age.</p>
</li>
<li>
<p>Changed format of existing command line arguments for consistency. (RPG Hacker)</p>
</li>
<li>
<p>LoROM banks <code>$70</code> to <code>$7D</code> can be used correctly. (randomdude999)</p>
</li>
<li>
<p>Struct definitions are cleared correctly in Asar lib. (randomdude999)</p>
</li>
<li>
<p>Fixed a freeze that could occur when using <code>freedata align</code>. (TheBiob)</p>
</li>
<li>
<p>Fixed a bug in <code>pad</code> command that made it not update the pc correctly and also made it trigger a bank cross error before actually writing any data into a new bank. (RPG Hacker)</p>
</li>
<li>
<p>Fixed a rare crash when using the command-line interface in ways you're not supposed to use it. (randomdude999)</p>
</li>
<li>
<p>Fixed <code>readfile()</code>/<code>canreadfile()</code> crashing when reading from more than 16 different files in the same patch. (randomdude999)</p>
</li>
<li>
<p>Fixed the ROM title being reported incorrectly. (randomdude999)</p>
</li>
<li>
<p>Fixed using really large values in math with <code>math round on</code> making the values negative sometimes. (randomdude999)</p>
</li>
<li>
<p>Fixed an SA-1 mapping issue. (Vitor Vilela, randomdude999)</p>
</li>
<li>
<p>Fixed <code>print double()</code> not working when any of their arguments contain commas or parentheses. (randomdude999)</p>
</li>
<li>
<p>Made it possible to pass string parameters to functions like <code>readfile1()</code> via user-defined functions. Previously, this failed as Asar expected all parameters in user-defined functions to be numbers. (KevinCathcart)</p>
</li>
<li>
<p>Fixed a bug related to evaluation of parameters in user-defined functions. In some situations, Asar returned the incorrect parameter. For example: given a user-defined function with a parameter <code>ab</code> and a paramater <code>abc</code>, Asar occasionally returned the parameter <code>abc</code> when referencing the paramter <code>ab</code>. (KevinCathcart)</p>
</li>
<li>
<p>Added more undocumented features to the manual. (RPG Hacker)</p>
</li>
<li>
<p>0x hex literals were supported by Asar on some platforms, which wasn't supposed to be the case. Made sure 0x hex literals throw errors on all platforms. (randomdude999)</p>
</li>
</ul>
<h3 id="deprecated-features-1"><a class="header" href="#deprecated-features-1">Deprecated features:</a></h3>
<ul>
<li>Started the process of deprecating xkas compatibility mode. From now on, using xkas compatibility features will throw warnings. In a future version of Asar, xkas compatibility will be removed entirely.</li>
<li>Started deprecating <code>autoclear</code>, which is an alias of <code>autoclean</code>. Please use only <code>autoclean</code> from now on.</li>
<li>Started deprecating <code>freespace fixed</code>, which is an alias of <code>freespace static</code>. Please use only <code>freespace static</code> from now on.</li>
<li>Deprecated and removed support for <code>if !condition</code>. This feature was planned for deprecation as it bites with Asar's define syntax, but it was removed earlier than planned because, after inspecting the code, it was determined that it didn't work properly and probably wasn't even usable in versions prior to 1.60 at all. The only way to use it in Asar 1.60 was by using the new escape sequence for !, which didn't exist in earlier Asar versions. Thus it can be assumed that the feature wasn't used in previous Asar versions and can be removed safely. To negate conditions in Asar 1.60, either use the built-in logic functions (<code>if !(a == 0 &amp;&amp; b == 0)</code> becomes <code>if not(and(equal(a, 0),equal(b, 0)))</code>) or directly negate the condition (<code>if !(a == 0 &amp;&amp; b == 0)</code> becomes <code>if a != 0 || b != 0</code>).</li>
</ul>
<hr />
<h2 id="v150"><a class="header" href="#v150">v1.50</a></h2>
<p><strong>Release:</strong> February 28, 2017</p>
<h3 id="contributors-8"><a class="header" href="#contributors-8">Contributors:</a></h3>
<ul>
<li>RPG Hacker</li>
<li>p4plus2</li>
</ul>
<h3 id="new-features-5"><a class="header" href="#new-features-5">New features:</a></h3>
<ul>
<li>Added support for structs.</li>
<li>Added API to Asar lib for getting information on all blocks of data written by Asar.</li>
<li>Added API to Asar lib for getting the mapper currently used by Asar.</li>
<li>Added support for ExLoROM and ExHiROM mappers.<br />
NOTE: Based entirely on conversion tables I got from Ladida; don't know if these conversions are actually correct. Some features may not work as intended when using those mappers (such as <code>freedata</code>, for example), but I can't verify this.</li>
<li>Added <code>pushtable</code> and <code>pulltable</code> commands, which let you back-up or restore the current character table to the/from the stack.</li>
<li>Added <code>ext\notepad-plus-plus\syntax-highlighting.xml</code>. This file can be imported into Notepad++ as a user-defined language to add syntax highlighting for Asar patches, featuring all commands currently supported by Asar. By default, this syntax highlighting is enabled on all files with an extension of <code>.asm</code> or <code>.asr</code>, but this can be customized via Notepad++.</li>
</ul>
<h3 id="bug-fixes-8"><a class="header" href="#bug-fixes-8">Bug fixes:</a></h3>
<ul>
<li>Lines starting with <code>@</code> or <code>;@</code> that don't map to a recognized special command now only throw warnings at best and no errors.</li>
<li>Rewrote code of tests a little to make them easier to execute and make them clean up their own mess.</li>
<li>C# wrapper for Asar DLL was non-functional since it didn't specify a calling convention, making it always lead to an exception in some scenarios.</li>
</ul>
<h3 id="notes-1"><a class="header" href="#notes-1">Notes:</a></h3>
<ul>
<li>Just like the last version, this version of Asar was built in MSVC rather than g++, but this time I also updated the Asar DLL (which I had overlooked last time). I'm not sure if Windows applications are compatible with DLLs that were built by a different compiler, so if you're planning to use the DLL, this is something to watch out for. If you're planning to use a compiler other than MSVC, I recommend just rebuilding the DLL from source in whatever compiler you're using (or directly including the Asar library code in your project).</li>
</ul>
<hr />
<h2 id="v140"><a class="header" href="#v140">v1.40</a></h2>
<p><strong>Release:</strong> October 23, 2016</p>
<h3 id="contributors-9"><a class="header" href="#contributors-9">Contributors:</a></h3>
<ul>
<li>RPG Hacker</li>
</ul>
<h3 id="new-features-6"><a class="header" href="#new-features-6">New features:</a></h3>
<ul>
<li>
<p><code>readfile</code> functions: <code>readfile1(filename, offset)</code>, <code>readfile2(filename, offset)</code>, <code>readfile3(filename, offset)</code>, <code>readfile4(filename, offset)</code> - similiar to <code>read1()</code> etc. functions, except data is read from another file instead of from the ROM (note that offset is a PC offset, not a SNES offset). You can pass an optional third value which is returned if the read fails. These functions are primarily intended for reading bytes from another file and then doing math with them. For example: reading bytes from a Lunar Magic .pal file, converting them into a different format and then writing them to the ROM as a table that can directly be DMA'd to CGRAM without further conversions (all conversions happen at compile-time). As an additional bonus, all of those functions cache any file passed to them (up to 16 simultanous files), which means that multiple readfile() calls on the same file will keep the file open rather than repeatedly opening and closing the file.</p>
</li>
<li>
<p><code>canreadfile</code> functions: <code>canreadfile1(filename, offset)</code>, <code>canreadfile2(filename, offset)</code>, <code>canreadfile3(filename, offset)</code>, <code>canreadfile4(filename, offset)</code>, <code>canreadfile(filename, offset, length)</code> - basically the <code>readfile()</code> equivalents of <code>canread1()</code> etc.</p>
</li>
<li>
<p><code>snestopc(address)</code> and <code>pctosnes(address)</code> functions: for manually converting addresses (note that those functions are dependent on the ROM's current mapping mode, so use them with caution - chances are you will never need them at all).</p>
</li>
<li>
<p><code>max(a, b)</code>, <code>min(a, b)</code> and <code>clamp(value, min, max)</code> functions: <code>max()</code>/<code>min()</code> return the maximum/minimum of two values, whereas <code>clamp()</code> makes sure that that value is <code>&gt;= min</code> and <code>&lt;= max.</code></p>
</li>
<li>
<p><code>safediv(dividend, divisor, exception)</code> function: divides <code>dividend</code> by <code>divisor</code>, unless <code>divisor</code> is 0, in which case <code>exception</code> is returned.</p>
</li>
<li>
<p><code>select(statement, true, false)</code> function: if <code>statement</code> is 0, <code>false</code> is returned, in any other case, <code>true</code> is returned. Basically, a mathematical version of &quot;if/else&quot;. Please note that unlike if/else blocks, function arguments in Asar are always evaluated before a function returns. In other words: if you do <code>select(1, 1/1, 1/0)</code>, Asar will throw a &quot;division by zero&quot; error, even though the function would return 1/1. In this particular case, it's recommended to simply use the <code>safediv()</code> function in place of a regular division.</p>
</li>
<li>
<p><code>not(value)</code> function: returns 1 if <code>value</code> is 0 and 0 in any other case.</p>
</li>
<li>
<p>comparison functions: <code>equal(a, b)</code>, <code>notequal(a, b)</code>, <code>less(a, b)</code>, <code>lessequal(a, b)</code>, <code>greater(a, b)</code>, <code>greaterequal(a, b)</code> - rather self-explanatory, return 1 if the respective comparison is true and 0 otherwise. Primarily intended to be passed as statement to <code>select()</code> function.</p>
</li>
<li>
<p>logical functions: <code>and(a, b)</code>, <code>or(a, b)</code>, <code>nand(a, b)</code>, <code>nor(a, b)</code>, <code>xor(a, b)</code> - also self-explanatory, return 1 if the respective logical operation is true and 0 otherwise. Primarily intended to be passed as statement to <code>select()</code> function.</p>
</li>
<li>
<p><code>while</code> loops: Added compile-time <code>while</code> loops to Asar. Those work similar to if conditionals, with the difference that their blocks are assembled repeatedly until their condition becomes false. For easier implementation and higher compatibility, while loops are terminated with <code>endif</code>, just like <code>if</code> conditionals. When using while loops, be careful not to cause an infinite loop. Asar won't make any effort to detect those.</p>
</li>
<li>
<p>Multiline operator: You can now put <code>\</code> at the end of any line of source code and Asar will append the next line to it. This is similar to putting a <code>,</code> at the end of a line, with the difference, that the <code>\</code> itself does not appear in the concatenated string, whereas the <code>,</code> would. This is useful to split long function definitions into multiplie lines, for example. Note that all whitespace following the <code>\</code> is ignored, whereas whitespace preceeding the <code>\</code> isn't. Therefore</p>
<pre><code class="language-asar">db\
$FF
</code></pre>
<p>turns into</p>
<pre><code class="language-asar">db$FF
</code></pre>
<p>for example, whereas</p>
<pre><code class="language-asar">db \
$FF
</code></pre>
<p>turns into</p>
<pre><code class="language-asar">db $FF
</code></pre>
</li>
<li>
<p><code>double(num)</code> print function: Can be passed to print to print a double variable with its fractional part. Has a default precision of 5 decimal places, but can be passed an optional second argument to override the precision.</p>
</li>
<li>
<p><code>round(num, precision)</code> function: Rounds the double variable <code>num</code> to <code>precision</code> decimal places. Pass 0 as precision to round to the nearest integer.</p>
</li>
</ul>
<h3 id="bug-fixes-9"><a class="header" href="#bug-fixes-9">Bug fixes:</a></h3>
<ul>
<li>
<p>Asar 1.37 officially suppported overloaded versions of <code>read1()</code> to <code>read4()</code>, but always threw &quot;Wrong number of parameters to function&quot; errors when actually using those overloaded versions.</p>
</li>
<li>
<p>Asar 1.37 threw &quot;Wrong number of parameters to function&quot; error for function <code>canread()</code> when passing 2 arguments to it, because it actually treated it as <code>canread1()</code> due to an internal error in string comparison.</p>
</li>
<li>
<p>Using better double -&gt; int conversions in some places - where</p>
<pre><code class="language-asar">dd $FFFFFFFF
</code></pre>
<p>would assemble to <code>00 00 00 80</code> (<code>$80000000</code>) in Asar 1.37, it now assembles to <code>FF FF FF FF</code></p>
</li>
<li>
<p>Defines in <code>elseif</code> conditionals now get properly resolved.</p>
</li>
<li>
<p>The <code>#=</code> define operator now doesn't truncate its value when using <code>math round off</code>, making it possible to do double-precision math with it.</p>
</li>
<li>
<p>Asar 1.37 detected misplaced elses and endifs, but not misplaced elseifs.</p>
</li>
<li>
<p>Putting <code>@xkas : @asar 1.37</code> on the first line would previously lead to an error, whereas putting <code>@asar 1.37 : @xkas</code> there would not. Both variations lead to an error message now, since it really doesn't make much sense to use them together in any combination.</p>
</li>
<li>
<p>Special commands like <code>@asar</code> or <code>@include</code> could previously be used on the first line only and needed to be chained with a <code>:</code> inbetween. They can now be used on any line as long as no other command comes before or inbetween them.</p>
</li>
<li>
<p>Asar 1.37 fixed a bug in SuperFX compilation, but <code>src/test/arch-superfx.asm</code> was never edited to acknowledge this fix, so the test always failed</p>
</li>
<li>
<p>Added different define operators (<code>=</code>, <code>+=</code>, <code>:=</code>, <code>#=</code>, <code>?=</code>) to manual.txt. Those have been in Asar for quite a while, but were never documented yet, although they can be quite useful.</p>
</li>
</ul>
<h3 id="notes-2"><a class="header" href="#notes-2">Notes:</a></h3>
<ul>
<li>This version of Asar was built in MSVC rather than g++, mainly because I already had that installed and use Visual Studo as an IDE, anyways. Functionally, this shouldn't make any difference, unless using Asar in unintended ways, where anything goes. I did build the Linux version in g++ to confirm compatibility, though.</li>
</ul>
<hr />
<h2 id="v137"><a class="header" href="#v137">v1.37</a></h2>
<p><strong>Release:</strong> March 26, 2016</p>
<h3 id="contributors-10"><a class="header" href="#contributors-10">Contributors:</a></h3>
<ul>
<li>Raidenthequick</li>
</ul>
<h3 id="new-features-7"><a class="header" href="#new-features-7">New features:</a></h3>
<ul>
<li>New <code>freespace</code> argument added; a <code>$xx</code> byte that will search the ROM for contiguous sections of that byte. Before it was hardcoded to only search for <code>$00</code>. Default is still <code>$00</code> if not supplied, so past patches should not be broken.</li>
<li>In line with this, <code>autoclean</code> was hardcoded to clean using <code>$00</code>. This was fixed also to clean with the byte supplied by freecode, or <code>$00</code> if not supplied.</li>
</ul>
<h3 id="bug-fixes-10"><a class="header" href="#bug-fixes-10">Bug fixes:</a></h3>
<ul>
<li>Super FX short addressing fixed, and added error checking for valid short address. For example, <code>lms r0,($00D4)</code> used to output <code>3D A0 D4</code>, which is actually incorrect because short addressing doubles the byte supplied by the instruction to give a range from <code>$0000</code>-<code>$01FE</code> with just one byte (since Super FX reads words). This now outputs <code>3D A0 6A</code> which is correct. Also, asar now throws an error for anything outside <code>$0000</code>-<code>$01FE</code> as well as all odd-numbered addresses for both <code>sms</code> and <code>lms</code> instructions. (Odd-numbered addresses cannot be accessed using short addressing due to the multiplying by 2.)</li>
<li>Super FX and SPC700 labels were broken if used within freespace. This has been fixed by doing what 65816 does: mask the address with <code>0xFFFFFF</code> because freespace addresses use a high byte to indicate that they're freespace.</li>
<li>Fixed SA-1 mapping using wrong Super MMC banks range.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="historical-changelog"><a class="header" href="#historical-changelog">Historical changelog</a></h1>
<p>This part of the changelog was written retroactively and may be incorrect and/or incomplete.</p>
<h2 id="v136"><a class="header" href="#v136">v1.36</a></h2>
<p><strong>Release:</strong> November 28, 2013</p>
<h3 id="contributors-11"><a class="header" href="#contributors-11">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-8"><a class="header" href="#new-features-8">New features:</a></h3>
<ul>
<li>Added the fullsa1rom mapper.</li>
<li>Asar now halts if more than 20 errors are detected.</li>
</ul>
<h3 id="bug-fixes-11"><a class="header" href="#bug-fixes-11">Bug fixes:</a></h3>
<ul>
<li>Fixed a warning about $xx,y not existing if $xxxx,y doesn't exist either</li>
<li>Fixed sublabels requiring a parent label even in xkas compatibility mode</li>
<li>Fixed a memory leak in the DLL</li>
</ul>
<hr />
<h2 id="v135"><a class="header" href="#v135">v1.35</a></h2>
<p><strong>Release:</strong> December 13, 2012</p>
<h3 id="contributors-12"><a class="header" href="#contributors-12">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-9"><a class="header" href="#new-features-9">New features:</a></h3>
<ul>
<li>Made freecode print the size of the requested freespace if allocation fails.</li>
</ul>
<h3 id="bug-fixes-12"><a class="header" href="#bug-fixes-12">Bug fixes:</a></h3>
<ul>
<li>Fixed a crash caused by incbin'ing a file and specifying an endpoint beyond the end of the file.</li>
<li>Blocked readN on exactly one byte after the end of the input ROM.</li>
</ul>
<h3 id="deprecated-features-2"><a class="header" href="#deprecated-features-2">Deprecated features:</a></h3>
<ul>
<li>fastrom has been removed. It gives far too many problems relative to its advantages (are there any?). In exchange, freespace searching in lorom is now always fastrom enabled. (The command itself still exists, but it does nothing.</li>
</ul>
<hr />
<h2 id="v"><a class="header" href="#v">v?.??</a></h2>
<p><strong>Release:</strong> November 11, 2012</p>
<h3 id="contributors-13"><a class="header" href="#contributors-13">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-10"><a class="header" href="#new-features-10">New features:</a></h3>
<ul>
<li>Added -DTIMELIMIT support on Windows. Note that it's more limited than on Linux; it seems to only check the time limit every seven seconds, it can't print error messages, and it bugs up on anything above 429 seconds. (But you shouldn't need to set it above one or two anyways.)</li>
</ul>
<h3 id="bug-fixes-13"><a class="header" href="#bug-fixes-13">Bug fixes:</a></h3>
<ul>
<li>Missing an org/freespace command now no longer places the first byte at SNES $FFFFFF, but jumps to $008000 directly.</li>
<li>Allowed JMP.l in xkas mode...</li>
<li>Fixed PC-&gt;SNES conversion for 0x380000 and higher.</li>
<li>Fixed BEQ a.</li>
<li>fastrom : org $8000 : db $01 : warnpc $8001 no longer throws errors.</li>
<li>Made bit shifting unsigned, to match how xkas behaves.</li>
<li>Made db $0-10 return -10, not -16.</li>
<li>Including a file that enables xkas mode, while xkas mode is already enabled, no longer throws errors.</li>
<li>Fixed dd $FFFFFFFF acting like dd $7FFFFFFF.</li>
<li>Fixed compile errors on GCC 4.7.</li>
<li>Made blockreleasedebug and blockdebugrelease not show up anymore.</li>
<li>Files saying @asar can no longer be included from files saying ;@xkas.</li>
<li>Locked org $F00000.</li>
</ul>
<hr />
<h2 id="v133b"><a class="header" href="#v133b">v1.33b</a></h2>
<p><strong>Release:</strong> October 26, 2012</p>
<h3 id="contributors-14"><a class="header" href="#contributors-14">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-14"><a class="header" href="#bug-fixes-14">Bug fixes:</a></h3>
<ul>
<li>Rearranged the manual a little to have a more obvious filename.</li>
<li>Nuked a debug code that kept printing nonsense.</li>
</ul>
<h3 id="notes-3"><a class="header" href="#notes-3">Notes</a></h3>
<ul>
<li>Asar now considers OS X a non-Linux Unix-line and recommends -Dlinux.</li>
</ul>
<hr />
<h2 id="v133"><a class="header" href="#v133">v1.33</a></h2>
<p><strong>Release:</strong> October 22, 2012</p>
<h3 id="contributors-15"><a class="header" href="#contributors-15">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-11"><a class="header" href="#new-features-11">New features:</a></h3>
<ul>
<li>Made incbin file.bin -&gt; $123456 possible. This one can go as far as you want; it doesn't mind crossing banks nor exceeding the size of a RATS tag. It does, however, demand to know the SNES position in advance; you can't use labels here. (It also refuses to go outside the ROM)</li>
<li>Added a sandbox mode that disables everything that loads external files. Only accessible by recompiling (-DSANDBOX) since it should only be useful for people who have compilers already.</li>
<li>Added a way to make the process abort if it runs too long. Linux+recompile (-DTIMELIMIT=60) only.</li>
</ul>
<h3 id="bug-fixes-15"><a class="header" href="#bug-fixes-15">Bug fixes:</a></h3>
<ul>
<li>Nuked some spurious warnings in incsrc/incbin if the base path contains backslashes.</li>
<li>Made Asar a little more eager to detect bank crossings. Now those errors appear in the correct file.</li>
<li>Made REP #$FFFF throw errors instead of repeating 65535 times.</li>
<li>Fixed a bunch of weird code in the freespace finders.</li>
<li>Made sure . does not count as a label.</li>
<li>Fixed LDA Label,y in emulation mode. Asar tried using 24-bit addressing for that, but there is no such addressing mode.</li>
<li>Another accuracy improvement in emulation mode.</li>
<li>Detonated some more SPC700 inaccuracies and bugs.</li>
<li>Made JMP ($1234)+($3412) assemble to JMP abs, not JMP (abs).</li>
</ul>
<hr />
<h2 id="v132"><a class="header" href="#v132">v1.32</a></h2>
<p><strong>Release:</strong> October 8, 2012</p>
<h3 id="contributors-16"><a class="header" href="#contributors-16">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-12"><a class="header" href="#new-features-12">New features:</a></h3>
<ul>
<li>Added @xkas, which will revert to maximum xkas compatibility mode and change the behaviour of a couple of commands (as well as throwing warnings on various Asar-only commands).</li>
<li>Any line starting with ;@ will now be assembled. This is intended to be combined with the above one to create ;@xkas, which will send Asar into xkas mode while letting xkas ignore it, but you can also use ;@if 0 : org !Freespace : ;@endif : ;@freecode (except with the colons replaced with linebreaks).</li>
<li>Replaced bank off with bank auto, and added bank noassume, which always uses long addressing if possible.</li>
<li>Removed the @ trick for suppressing warnings. Its only legit use was telling Asar that a freespace is cleaned in a way it can't understand. freecode cleaned is the new way to say that.</li>
<li>Whitespace, blank lines and comments are now allowed to exist before @asar, ;@xkas and @include/@includefrom.</li>
<li>Added !define ?= value, which sets !define to value if !define is previously undefined.</li>
</ul>
<h3 id="bug-fixes-16"><a class="header" href="#bug-fixes-16">Bug fixes:</a></h3>
<ul>
<li>Blocked \ in incsrc/bin because linux.</li>
<li>Reworked prot a bit. You can now use multiple prot statements in the same freespace; Asar has always allowed cleaning them out anyways. The old implementation was rather hacky.</li>
<li>Fixed build scripts a little. Some files didn't get included.</li>
<li>Fixed the internal ROM size when expanding SA-1 ROMs.</li>
<li>Killed some dead code.</li>
<li>Made db 0x80 assemble properly with math round on (the default).</li>
<li>Killed a phantom error on ALS A and a couple of similar constructions.</li>
<li>Squished a possible moving labels error.</li>
<li>Fixed a bug where the major version of Asar got compared backwards in @asar.</li>
</ul>
<hr />
<h2 id="v131"><a class="header" href="#v131">v1.31</a></h2>
<p><strong>Release:</strong> September 13, 2012</p>
<h3 id="contributors-17"><a class="header" href="#contributors-17">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-13"><a class="header" href="#new-features-13">New features:</a></h3>
<ul>
<li>Added incbin file.bin -&gt; Labelname support.</li>
<li>Added align detail to freespace/freecode/freedata.</li>
<li>Made reset freespaceuse a valid operation.</li>
<li>Added arch spc700.</li>
</ul>
<h3 id="bug-fixes-17"><a class="header" href="#bug-fixes-17">Bug fixes:</a></h3>
<ul>
<li>Killed some more Linux compile errors.</li>
</ul>
<h3 id="deprecated-features-3"><a class="header" href="#deprecated-features-3">Deprecated features:</a></h3>
<ul>
<li>Deprecated arch spc700-raw.</li>
</ul>
<hr />
<h2 id="v130"><a class="header" href="#v130">v1.30</a></h2>
<p><strong>Release:</strong> August 24, 2012</p>
<h3 id="contributors-18"><a class="header" href="#contributors-18">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-14"><a class="header" href="#new-features-14">New features:</a></h3>
<ul>
<li>Added SuperFX mapper and arch superfx.</li>
<li>Unlocked $[F0-FF]:[8000-FFFF] in lorom again. Turns out bsnes only maps SRAM to the lower halves of those banks.</li>
<li>Added an elseif command.</li>
<li>Added &amp;&amp; and || support to if/etc conditionals.</li>
<li>Reworked the Relative branch out of bounds errors a little, so it tells how far outside the bounds they are.</li>
<li>Added print dec($1234) and print hex(1234).</li>
<li>Attached test suite in the source zip, in case some other programmers are interested.</li>
<li>Added @include and @includefrom, which throws errors if Asar is invoked directly on them.</li>
<li>Added a -pause=<action> flag on the command line. Valid actions are &quot;yes&quot;, &quot;warn&quot;, &quot;err&quot;, and &quot;no&quot; (default).</li>
<li>Added a couple of synonyms to the single-bit SPC700 opcodes.</li>
<li>Added underscore-prefixed versions of all builtin functions.</li>
<li>Added error-safe readN and canreadN.</li>
</ul>
<h3 id="bug-fixes-18"><a class="header" href="#bug-fixes-18">Bug fixes:</a></h3>
<ul>
<li>Reworded the 125 freespaces limit to make sure nobody can think there's a limit of 250 labels.</li>
<li>Made readN()ing and writing to the same byte in ROM well defined (it gives the same value as it had in the input ROM).</li>
<li>Made the size guesser a little smarter. It now assumes .b for LDA #$123456/65536.</li>
<li>Killed a phantom error on the very rare code pattern db $80/(Label2-Label1) : Label1: : db 0 : Label2: and similar.</li>
<li>Adjusted the error messages read1/etc gives if the address is invalid.</li>
<li>Suppressed a couple of useless errors if labels are redefined.</li>
<li>Killed a couple of Invalid endif errors if an if statement is invalid.</li>
<li>Repaired nested pushpc/freedata.</li>
</ul>
<hr />
<h2 id="v129"><a class="header" href="#v129">v1.29</a></h2>
<p><strong>Release:</strong> July 19, 2012</p>
<h3 id="contributors-19"><a class="header" href="#contributors-19">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-15"><a class="header" href="#new-features-15">New features:</a></h3>
<ul>
<li>Added -v and -version switches.</li>
<li>Removed the lock on $700000-$7DFFFF in HiROM as it's not mapped to SRAM there.</li>
<li>Edited the library API a bit.</li>
</ul>
<h3 id="bug-fixes-19"><a class="header" href="#bug-fixes-19">Bug fixes:</a></h3>
<ul>
<li>Added an error message for mov (x)+,a in the SPC700 modes.</li>
<li>Nuked a bug making tabs not treated as spaces in all contexts.</li>
<li>Fixed a bug where Label = 123 checked that there is an org in front.</li>
<li>Fixed a bug where the line number was removed if the last code block on a line crossed a bank border.</li>
</ul>
<hr />
<h2 id="v128"><a class="header" href="#v128">v1.28</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-20"><a class="header" href="#contributors-20">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-16"><a class="header" href="#new-features-16">New features:</a></h3>
<ul>
<li>Flipped the switch to autocorrect the checksum to on by default.</li>
</ul>
<h3 id="bug-fixes-20"><a class="header" href="#bug-fixes-20">Bug fixes:</a></h3>
<ul>
<li>Nuked some double spaces in outputs.</li>
<li>Fixed sa1rom mapping breaking on everything except the first megabyte.</li>
<li>Fixed a couple of bugs with valid table files being rejected.</li>
</ul>
<hr />
<h2 id="v127"><a class="header" href="#v127">v1.27</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-21"><a class="header" href="#contributors-21">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-17"><a class="header" href="#new-features-17">New features:</a></h3>
<ul>
<li>Made freespace fixed a synonym of freespace static.</li>
<li>Made Asar try to autodetect whether the ROM is LoROM or HiROM. Homebrews default to LoROM.</li>
</ul>
<h3 id="bug-fixes-21"><a class="header" href="#bug-fixes-21">Bug fixes:</a></h3>
<ul>
<li>Zapped a phantom error if the code arch spc700-raw : org $010000 : db $00 is used.</li>
<li>Nuked some pointless errors with static freespaces.</li>
<li>Zapped a bunch of bugs with static/fixed freespace.</li>
<li>Killed a bug that crashed Asar if a line contained both commas and unmatched quotes.</li>
<li>Replaced the Press Enter to continue with the standard Press any key to continue prompt on Windows.</li>
<li>Refactored some parts of the math parser, to get rid of some possible escaping NaNs.</li>
<li>Added some #errors if no frontend is chosen, and edited some others a bit.</li>
<li>Adjusted Linux support a bit. Looks like it bitrotted.</li>
<li>Fixed some off-by-one errors in spc700-inline.</li>
</ul>
<hr />
<h2 id="v126"><a class="header" href="#v126">v1.26</a></h2>
<p><strong>Release:</strong> April 28, 2012 or earlier</p>
<h3 id="contributors-22"><a class="header" href="#contributors-22">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-18"><a class="header" href="#new-features-18">New features:</a></h3>
<ul>
<li>Added support for db +1. There's no reason not to allow it.</li>
</ul>
<h3 id="bug-fixes-22"><a class="header" href="#bug-fixes-22">Bug fixes:</a></h3>
<ul>
<li>Removed some more files made useless by dropping asar-clr.dll.</li>
<li>Fixed a bug where db $12,$34 broke in the spc700 modes.</li>
<li>Fixed a bug where an invisible bank border was hit if a base command was used without an org command.</li>
</ul>
<hr />
<h2 id="v125"><a class="header" href="#v125">v1.25</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-23"><a class="header" href="#contributors-23">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-19"><a class="header" href="#new-features-19">New features:</a></h3>
<ul>
<li>Rewrote the .NET library as a C# wrapper around asar.dll using P/Invokes, for better Linux compatibility (Mono really seems to hate C++/CLI). This also means that asar-clr.dll no longer exists.</li>
<li>Made errors not shred the ROM in the library frontend.</li>
</ul>
<h3 id="bug-fixes-23"><a class="header" href="#bug-fixes-23">Bug fixes:</a></h3>
<ul>
<li>Killed a bunch of moving label errors if a PROT is misplaced. No point throwing 300 errors for one misplaced line.</li>
<li>Fixed error messages erroneously being printed to stdout instead of stderr.</li>
<li>Fixed errors with prot being incompatible with fastrom.</li>
<li>Fixed an uninitialized variable.</li>
<li>Fixed a buffer underflow Valgrind whined about.</li>
<li>Zapped a null pointer bug in the library if a file was not found.</li>
<li>Nuked a bug where the library did not clear out previous errors when applying a new patch.</li>
</ul>
<hr />
<h2 id="v124"><a class="header" href="#v124">v1.24</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-24"><a class="header" href="#contributors-24">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-20"><a class="header" href="#new-features-20">New features:</a></h3>
<ul>
<li>Added SA-1 support. Syntax is sa1rom 0,1,2,3, where the four numbers are the bank numbers, 0 through 7. It's allowed to not give them; that will result in 0,1,2,3 being picked as default.</li>
<li>Added freespace finding support for hirom and sa1rom.</li>
<li>Made Asar remove extranous quotes around filenames if a file is pulled to the Asar window.</li>
<li>Minor adjustment to the ROM title verifier.</li>
</ul>
<h3 id="bug-fixes-24"><a class="header" href="#bug-fixes-24">Bug fixes:</a></h3>
<ul>
<li>Fixed a phantom error if prot isn't used directly after a free* statement.</li>
<li>Fixed a bogus error if prot is placed at any of the first eight bytes of a bank.</li>
<li>Repaired autoclean, which appears to have broken a few versions ago.</li>
<li>Fixed a crash bug if the ROM does not exist and couldn't be created.</li>
</ul>
<hr />
<h2 id="v123"><a class="header" href="#v123">v1.23</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-25"><a class="header" href="#contributors-25">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-25"><a class="header" href="#bug-fixes-25">Bug fixes:</a></h3>
<ul>
<li>Fixed around ten broken SPC700 opcodes.</li>
</ul>
<hr />
<h2 id="v122"><a class="header" href="#v122">v1.22</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-26"><a class="header" href="#contributors-26">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-21"><a class="header" href="#new-features-21">New features:</a></h3>
<ul>
<li>Added a few special cases for some functions, and adjusted some compiler flags. The result is dramatically improved performance.</li>
<li>Adjusted the string table a bit.</li>
</ul>
<h3 id="bug-fixes-26"><a class="header" href="#bug-fixes-26">Bug fixes:</a></h3>
<ul>
<li>Fixed an uninitialized value in the macro handling code that may (but usually doesn't) throw errors if a macro has no arguments.</li>
<li>Repaired partial incbin if the filename is quoted.</li>
</ul>
<hr />
<h2 id="v121"><a class="header" href="#v121">v1.21</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-27"><a class="header" href="#contributors-27">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-27"><a class="header" href="#bug-fixes-27">Bug fixes:</a></h3>
<ul>
<li>Fixed: read1() etc. went missing.</li>
</ul>
<hr />
<h2 id="v120b-"><a class="header" href="#v120b-">v1.20b (?)</a></h2>
<p><strong>Release:</strong> March 4, 2012</p>
<h3 id="contributors-28"><a class="header" href="#contributors-28">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-28"><a class="header" href="#bug-fixes-28">Bug fixes:</a></h3>
<ul>
<li>Added freecode static and norom to changes.txt.</li>
</ul>
<hr />
<h2 id="v120-"><a class="header" href="#v120-">v1.20 (?)</a></h2>
<p><strong>Release:</strong> March 4, 2012</p>
<h3 id="contributors-29"><a class="header" href="#contributors-29">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-22"><a class="header" href="#new-features-22">New features:</a></h3>
<ul>
<li>freecode/freedata have been expanded: They now take an optional parameter containing comma separated parameters on how to hand out the freespace. Valid parameters are ram, noram, and static. ram tells Asar that this code needs the RAM mirrors and puts the code in banks 10-3F; noram tells Asar that the code (or table) does not need the RAM mirrors, and therefore uses banks 40-6F if possible; static demands that the freespace does not move; if it grows, Asar throws an error. freespace has also been added; freecode is a shortcut to freespace ram.</li>
<li>Added hirom support. It works just like in xkas: hirom : org $C00000 : JML Main. Also added norom, where the PC address is the same as the SNES address (not counting SMC headers); use this (and base) if you want to implement your own mapper (preferably in a macro).</li>
<li>Simplified table code, and made it accept assigning stuff to the = character.</li>
<li>LDY #Label&gt;&gt;16 (and LDA/LDX/etc) is now considered 8bit. This should reduce the need for explicit .b hints.</li>
<li>Asar can now use the last byte of the ROM as freespace.</li>
<li>Made the default value for untouched table bytes be more random to make errors in usage more obvious.</li>
<li>Lowered the recursion limit a bit.</li>
<li>You can now drop the extensions on both filenames, if you want to.</li>
<li>Asar now tries to no longer parse defines inside if 0 blocks. Note that this doesn't help on single-line if statements; you'll need a multiline if.</li>
<li>Added !def := val, which expands everything inside the value before setting it (making !a := a!a a perfectly safe operation).</li>
<li>Added !def #= val, which expands the value into an integer and stores it into the define. !a #= 1+1 : L!a: is a valid operation.</li>
</ul>
<h3 id="bug-fixes-29"><a class="header" href="#bug-fixes-29">Bug fixes:</a></h3>
<ul>
<li>Fixed fastrom again again again.</li>
<li>Labels before the first org/freecode/etc are now considered to be at $008000, not $FFFFFFFF. (They're still considered invalid.)</li>
<li>Some minor fixes in autoclean dl Label.</li>
<li>Repaired the ** operator.</li>
<li>Calling a function no longer hits a user-defined function starting with the name of called function.</li>
<li>Fixed skip command, which previously only edited the base address.</li>
</ul>
<hr />
<h2 id="v114-"><a class="header" href="#v114-">v1.14 (?)</a></h2>
<p><strong>Release:</strong> February 8, 2012</p>
<h3 id="contributors-30"><a class="header" href="#contributors-30">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-30"><a class="header" href="#bug-fixes-30">Bug fixes:</a></h3>
<ul>
<li>Killed a crash bug.</li>
</ul>
<hr />
<h2 id="v113-"><a class="header" href="#v113-">v1.13 (?)</a></h2>
<p><strong>Release:</strong> February 7, 2012 (?)</p>
<h3 id="contributors-31"><a class="header" href="#contributors-31">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-23"><a class="header" href="#new-features-23">New features:</a></h3>
<ul>
<li>Added a random icon, to fit the Nordic theme of Asar's name.</li>
<li>Made asar_patch destroy the ROM if any errors are encountered, to ensure that nobody attempts to use a ROM that may contain subtle breakage.</li>
<li>A label can now be on the same line as a macro call.</li>
</ul>
<h3 id="bug-fixes-31"><a class="header" href="#bug-fixes-31">Bug fixes:</a></h3>
<ul>
<li>Fixed the bug that makes macros look like they're called from themselves if the macro call is broken.</li>
</ul>
<hr />
<h2 id="v112-"><a class="header" href="#v112-">v1.12 (?)</a></h2>
<p><strong>Release:</strong> February 6, 2012 or earlier</p>
<h3 id="contributors-32"><a class="header" href="#contributors-32">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-32"><a class="header" href="#bug-fixes-32">Bug fixes:</a></h3>
<ul>
<li>Fixed fastrom mode again...</li>
<li>Fixed crashes when closing Asar while waiting for input.</li>
<li>Macro definitions are now ignored inside if 0 blocks.</li>
<li>Macros and incsrc may now be called inside if 1 blocks.</li>
<li>Locked banks $F0-$FF from usage. They are not usable.</li>
</ul>
<h3 id="deprecated-features-4"><a class="header" href="#deprecated-features-4">Deprecated features:</a></h3>
<ul>
<li>Removed most of the emulation mode. The only remaining change is that it makes Asar print the errors to stdout instead of stderr, since that quirk isn't fixable by editing the ASM files.</li>
</ul>
<hr />
<h2 id="v111-"><a class="header" href="#v111-">v1.11 (?)</a></h2>
<p><strong>Release:</strong> January 25, 2012 or earlier</p>
<h3 id="contributors-33"><a class="header" href="#contributors-33">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-24"><a class="header" href="#new-features-24">New features:</a></h3>
<ul>
<li>Prefixing a command with @ will now make Asar not print warnings for that line.</li>
</ul>
<h3 id="bug-fixes-33"><a class="header" href="#bug-fixes-33">Bug fixes:</a></h3>
<ul>
<li>JMP and JSR within the current bank with bank active has been fixed.</li>
<li>xkas appears to allow sublabels starting with numbers. Asar has been updated to do the same.</li>
<li>fastrom no longer messes up branches.</li>
<li>autoclean read3($123456) can now be used before the first org.</li>
<li>db ($04&lt;&lt;2)|($80&gt;&gt;1) no longer breaks due to unmatched parentheses.</li>
<li>Fixed problem with autoclean $123456, where it read a pointer from $123456 instead of removing $123456.</li>
<li>Fixed a crash if a freespace block protects itself.</li>
</ul>
<hr />
<h2 id="v110-"><a class="header" href="#v110-">v1.10 (?)</a></h2>
<p><strong>Release:</strong> January 13, 2012</p>
<h3 id="contributors-34"><a class="header" href="#contributors-34">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-25"><a class="header" href="#new-features-25">New features:</a></h3>
<ul>
<li>Made asardll.h and asardll.cpp work if compiled as both C and C++, and renamed asardll.cpp to asardll.c, for greater compatibility with other languages (hi, Objective-C). As an effect of this, the library name argument has disappeared from asar_init.</li>
<li>base off is now a valid operation. It tosses the base address back to the current code insertion location.</li>
<li>New command: bank. It makes the label optimizer act as if it's in another bank. This is not the same as base; LDA Label,x : Label: db $01,$02,$03,$04 will use 24-bit addressing for the LDA if bank is active. It's intended for long codes that assume the data bank register is not the same as the code bank register.</li>
<li>Added a copy of GPLv3 to asar.zip, since LGPL is apparently meaningless on its own. These licenses are starting to get a little tricky.</li>
</ul>
<h3 id="bug-fixes-34"><a class="header" href="#bug-fixes-34">Bug fixes:</a></h3>
<ul>
<li>Reworded the documentation for prot.</li>
<li>Asar now throws a warning if a freespace block appears to be leaked.</li>
<li>Adjusted &quot;autoclean at the end of a RATS tag&quot; error a bit.</li>
<li>Made Asar not read uninitialized/garbage memory if there's crappy content at the end of a macro.</li>
<li>Fixed infinite loop if a freespace of size 32768 is requested.</li>
</ul>
<hr />
<h2 id="v109-"><a class="header" href="#v109-">v1.09 (?)</a></h2>
<p><strong>Release:</strong> January 6, 2012</p>
<h3 id="contributors-35"><a class="header" href="#contributors-35">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-26"><a class="header" href="#new-features-26">New features:</a></h3>
<ul>
<li>New command: warn.</li>
<li>The math parser now accepts strings like 0.5 if you turn off rounding. It'll break if rounding is on, since that wouldn't make any sense. It'll round down as soon as it's returned from the math parser; db 0.9 is the same as db 0, but db 0.4*0.4 is the same as db 1.</li>
<li>assert can now take another parameter. If this is given, it is printed in the error message. (All error-generating blocks are printed, which makes these messages appear twice)</li>
<li>Asar now attempts to check if the ROM title looks sane before applying a patch.</li>
<li>Added Linux/OSX support to asardll.cpp.</li>
<li>Added asar_math() to the library frontend.</li>
<li>Now prints a message if patching is successful. However, calling it from the command line makes it remain silent, unless you add -verbose.</li>
</ul>
<h3 id="bug-fixes-35"><a class="header" href="#bug-fixes-35">Bug fixes:</a></h3>
<ul>
<li>Restored documentation of the functions to changes.txt that were forgotten when removing stdlib.asm.</li>
<li>Fixed crashes if a macro is called with wrong number of arguments.</li>
<li>Fixed silent errors when using LDA Label,y if Label is in another bank.</li>
</ul>
<hr />
<h2 id="v108-"><a class="header" href="#v108-">v1.08 (?)</a></h2>
<p><strong>Release:</strong> December 27, 2011</p>
<h3 id="contributors-36"><a class="header" href="#contributors-36">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-27"><a class="header" href="#new-features-27">New features:</a></h3>
<ul>
<li>Added special meaning to the define !assembler: Its value is always &quot;asar&quot;, even if you assign something else to it. Intended usage: !assembler = xkas : %freespace_!assembler(), where %freespace_xkas() requires the user to set freespace and %freespace_asar() contains a freecode.</li>
</ul>
<h3 id="bug-fixes-36"><a class="header" href="#bug-fixes-36">Bug fixes:</a></h3>
<ul>
<li>Restored db 1+'a' support to the math parser.</li>
<li>Merged the dupe descriptions for the fastrom command in the documentation.</li>
<li>Fixed sublabel support, which the new math engine broke as well.</li>
</ul>
<hr />
<h2 id="v107-"><a class="header" href="#v107-">v1.07 (?)</a></h2>
<p><strong>Release:</strong> December 25, 2011</p>
<h3 id="contributors-37"><a class="header" href="#contributors-37">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-28"><a class="header" href="#new-features-28">New features:</a></h3>
<ul>
<li>Replaced the math library with a more powerful one.</li>
<li>New command: math.</li>
<li>Homemade functions can now safely replace builtin ones, to compensate for the possibility that new builtin functions may collide with ones in your codes.</li>
<li>Added a few new functions: log, log10, and log2.</li>
</ul>
<h3 id="bug-fixes-37"><a class="header" href="#bug-fixes-37">Bug fixes:</a></h3>
<ul>
<li>Removed #ifdef ALCAROBOT (sandbox mode) from a few source files.</li>
<li>Fixed a few more memory leaks.</li>
</ul>
<hr />
<h2 id="v106-"><a class="header" href="#v106-">v1.06 (?)</a></h2>
<p><strong>Release:</strong> December 25, 2011</p>
<h3 id="contributors-38"><a class="header" href="#contributors-38">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-38"><a class="header" href="#bug-fixes-38">Bug fixes:</a></h3>
<ul>
<li>Sprite Tool compatibility was still broken. Looks like tmpasm.bin is unheadered after all. Repaired again.</li>
</ul>
<hr />
<h2 id="v105-"><a class="header" href="#v105-">v1.05 (?)</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-39"><a class="header" href="#contributors-39">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-29"><a class="header" href="#new-features-29">New features:</a></h3>
<ul>
<li>Updated libsmw and libstr to the latest versions from AlcaRobot.</li>
</ul>
<h3 id="bug-fixes-39"><a class="header" href="#bug-fixes-39">Bug fixes:</a></h3>
<ul>
<li>Asar no longer crashes if it tries to open a file of less than 512 bytes if it thinks it's headered. This fixes Sprite Tool compatibility.</li>
</ul>
<hr />
<h2 id="v104-"><a class="header" href="#v104-">v1.04 (?)</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-40"><a class="header" href="#contributors-40">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-40"><a class="header" href="#bug-fixes-40">Bug fixes:</a></h3>
<ul>
<li>$xxFFFF can now safely be overwritten.</li>
<li>Removed garbage from some errors.</li>
</ul>
<hr />
<h2 id="v103-"><a class="header" href="#v103-">v1.03 (?)</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-41"><a class="header" href="#contributors-41">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-30"><a class="header" href="#new-features-30">New features:</a></h3>
<ul>
<li>Renamed the DLL frontend to LIB, since DLLs only exist on Windows and dynamic libraries exist elsewhere too. No point using more Windows terminology than needed.</li>
<li>Various edits to the library frontends. asar_i_* has been renamed to asar_*, and errors and warnings now tell where they're called from, if found inside a macro.</li>
<li>The command line frontend tells where problematic macros are called from.</li>
<li>Made license choice explicit.</li>
</ul>
<hr />
<h2 id="v102-"><a class="header" href="#v102-">v1.02 (?)</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-42"><a class="header" href="#contributors-42">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-31"><a class="header" href="#new-features-31">New features:</a></h3>
<ul>
<li>Made it possible to call asar_i_patch() multiple times without calling asar_reset() between them. The errors will remain until you asar_reset() is used, meaning they'll accumulate until they are cleared.</li>
</ul>
<h3 id="bug-fixes-41"><a class="header" href="#bug-fixes-41">Bug fixes:</a></h3>
<ul>
<li>Fixed a crash bug in asar_i_reset() if the function does not create any custom functions.</li>
</ul>
<hr />
<h2 id="v101-"><a class="header" href="#v101-">v1.01 (?)</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-43"><a class="header" href="#contributors-43">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-42"><a class="header" href="#bug-fixes-42">Bug fixes:</a></h3>
<ul>
<li>Put a few lines back where they should be, to get rid of a crash.</li>
</ul>
<hr />
<h2 id="v100-"><a class="header" href="#v100-">v1.00 (?)</a></h2>
<p><strong>Release:</strong> December 2, 2011</p>
<h3 id="contributors-44"><a class="header" href="#contributors-44">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-32"><a class="header" href="#new-features-32">New features:</a></h3>
<ul>
<li>If an error occurs, it now prints the buggy block, if relevant.</li>
<li>Various changes to the DLL API.</li>
<li>Crappily cobbled together a hack to make Asar compatible with Sprite Tool (a file called tmpasm.bin is now considered to be headered).</li>
<li>Included the script used to compile the .NET DLL.</li>
</ul>
<h3 id="bug-fixes-43"><a class="header" href="#bug-fixes-43">Bug fixes:</a></h3>
<ul>
<li>Fixed a memory allocation mismatch.</li>
</ul>
<h3 id="deprecated-features-5"><a class="header" href="#deprecated-features-5">Deprecated features:</a></h3>
<ul>
<li>Dropped autocolon, since it's useless and never used.</li>
<li>The set command has been removed.</li>
<li>stdlib.asm has lost its special meaning.</li>
</ul>
<hr />
<h2 id="v-1"><a class="header" href="#v-1">v?.??</a></h2>
<p><strong>Release:</strong> November 29, 2011</p>
<h3 id="contributors-45"><a class="header" href="#contributors-45">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-33"><a class="header" href="#new-features-33">New features:</a></h3>
<ul>
<li>asar-cli.dll has been renamed to asar-clr.dll, and its contents has been moved to namespace AsarCLR instead of asarcli. This will require your tools to be edited, but it shouldn't take longer than a minute or two.</li>
<li>Added a function to the DLLs to view the table data.</li>
<li>New setting: werror. It makes warnings emit errors if encountered.</li>
</ul>
<h3 id="bug-fixes-44"><a class="header" href="#bug-fixes-44">Bug fixes:</a></h3>
<ul>
<li>pushpc no longer throws idiotic errors everywhere.</li>
<li>asar-clr.dll can now return errors/warnings/etc without crashes.</li>
<li>Killed off a bunch of memory leaks in asar-clr.dll.</li>
<li>STA $12,y warnings now print only once.</li>
<li>asar_resolvedefines no longer throws exceptions outside the DLL.</li>
<li>Squashed a memory leak bug where the math module allocates some memory without freeing it when the DLL is unloaded.</li>
</ul>
<h3 id="deprecated-features-6"><a class="header" href="#deprecated-features-6">Deprecated features:</a></h3>
<ul>
<li>Removed AsarCLR::Asar::unmanageerrors() from asar-clr.dll. It's an internally used function that shouldn't be exported.</li>
</ul>
<hr />
<h2 id="v-2"><a class="header" href="#v-2">v?.??</a></h2>
<p><strong>Release:</strong> November 21, 2011</p>
<h3 id="contributors-46"><a class="header" href="#contributors-46">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-45"><a class="header" href="#bug-fixes-45">Bug fixes:</a></h3>
<ul>
<li>Fixed a bug that made + and - labels not be treated as labels under some circumstances.</li>
<li>Made &quot;relative branch out of bounds&quot; errors disappear again unless they're supposed to exist.</li>
</ul>
<hr />
<h2 id="v-3"><a class="header" href="#v-3">v?.??</a></h2>
<p><strong>Release:</strong> November 20, 2011</p>
<h3 id="new-features-34"><a class="header" href="#new-features-34">New features:</a></h3>
<ul>
<li>if 0 now blocks label creation.</li>
<li>asar-cli.dll now exports a set of functions using .NET types instead of C types.</li>
<li>The DLL APIs have been slightly changed with regards to initialization and stdlib.asm.</li>
<li>Asar now prints warnings and errors to stderr instead of stdout. (Emulation mode is unaffected.)</li>
</ul>
<h3 id="bug-fixes-46"><a class="header" href="#bug-fixes-46">Bug fixes:</a></h3>
<ul>
<li>Repaired &quot;branch out of bounds&quot; errors.</li>
</ul>
<hr />
<h2 id="v-4"><a class="header" href="#v-4">v?.??</a></h2>
<p><strong>Release:</strong> November 17, 2011</p>
<h3 id="contributors-47"><a class="header" href="#contributors-47">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-47"><a class="header" href="#bug-fixes-47">Bug fixes:</a></h3>
<ul>
<li>Removed more debug code</li>
<li>Fixed org Label if the label is in freespace</li>
</ul>
<hr />
<h2 id="v-5"><a class="header" href="#v-5">v?.??</a></h2>
<p><strong>Release:</strong> November 17, 2011</p>
<h3 id="contributors-48"><a class="header" href="#contributors-48">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-35"><a class="header" href="#new-features-35">New features:</a></h3>
<ul>
<li>You can now use if !condition to negate the statement. Note that you may need an extra set of parentheses due to conflicts with define syntax.</li>
<li>Parentheses can now be used inside macro arguments. (Just make sure to close them.)</li>
<li>Included a .NET version of asar.dll. Note that it still uses unmanaged types.</li>
<li>Asar now accepts org Label if the label is defined prior to use. (It's still not allowed to jump to a label that's defined later in the patch.)</li>
</ul>
<h3 id="bug-fixes-48"><a class="header" href="#bug-fixes-48">Bug fixes:</a></h3>
<ul>
<li>If a relative branch is out of bounds, Asar no longer throws &quot;labels keep moving around&quot; errors.</li>
<li>Removed the strange size hex value warnings.</li>
</ul>
<hr />
<h2 id="v-6"><a class="header" href="#v-6">v?.??</a></h2>
<p><strong>Release:</strong> November 14, 2011</p>
<h3 id="contributors-49"><a class="header" href="#contributors-49">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-49"><a class="header" href="#bug-fixes-49">Bug fixes:</a></h3>
<ul>
<li>The autoclean warning for the end of a freespace area has been fixed. Again.</li>
<li>The freespace finder no longer skips a RATS tag if it's preceeded by an unprotected 00.</li>
</ul>
<hr />
<h2 id="v-7"><a class="header" href="#v-7">v?.??</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-50"><a class="header" href="#contributors-50">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-50"><a class="header" href="#bug-fixes-50">Bug fixes:</a></h3>
<ul>
<li>autoclean no longer complains if it attempts to overwrite something that isn't a valid SNES pointer.</li>
</ul>
<hr />
<h2 id="v-8"><a class="header" href="#v-8">v?.??</a></h2>
<p><strong>Release:</strong> November 13, 2011</p>
<h3 id="contributors-51"><a class="header" href="#contributors-51">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-36"><a class="header" href="#new-features-36">New features:</a></h3>
<ul>
<li>if statements have been made much more powerful. The old action if the statement is false was skipping the rest of the line if the statement is false; the new action is skipping the rest of the line, or if the if statement is at the end of the line, it skips everything until an endif. Nested if statements are allowed, as are else statements. (Note that you can't use else on one-line if statements.)</li>
<li>New command: prot. If used directly after a freecode or freedata command (that is, at the start of the RATS tag), it may contain a list of labels (up to 80 or something). The freespace blocks pointed to by these labels are removed if the freespace area is cleared by an autoclean. Example: org $008000 : autoclean JSL Main : freecode : prot Mydata : Main: LDA Mydata : RTL : freedata : Mydata: db $12,$34,$56,$78</li>
<li>Labels may be defined as Main(), not just Main:. This has been noted in the documentation.</li>
<li>Asar can now be built as a DLL file, but it's not tested very throughly.</li>
<li>'x' = $1234 is now a valid operation. It's equivalent to table file, but it accepts math and it's one file less to keep track of.</li>
<li>db 'x'+4 is now a valid operation.</li>
<li>freecode and freedata can now expand the ROM if needed.</li>
<li>!a = abc : !{a}def is now valid operation; it's equivalent to abcdef. You can nest defines inside the !{}s; a!{b!{c!def}g}h is accepted (assuming all defines exist).</li>
</ul>
<h3 id="bug-fixes-51"><a class="header" href="#bug-fixes-51">Bug fixes:</a></h3>
<ul>
<li>autoclean now works if called from $008000.</li>
<li>autoclean now works if aiming for the last eight bytes of a RATS tag.</li>
<li>autoclean now refuses to protect anything that isn't a label, for example math or constants, unless using the two-parameter method.</li>
<li>autoclean now refuses to protect a label at the end of a freespace block, since it'll think the RATS tag after that is the one that should be removed.</li>
<li>db 1/Label : Label: is now accepted, instead of being treated as a division by zero.</li>
<li>($12),x is an error in xkas, since that addressing mode doesn't exist. However, Asar accepts parentheses and treats it as LDA $12,x, which isn't what the user meant. Therefore, it now emits a warning if this happens.</li>
</ul>
<h3 id="deprecated-features-7"><a class="header" href="#deprecated-features-7">Deprecated features:</a></h3>
<ul>
<li>!a equ $1234 is no longer valid.</li>
</ul>
<hr />
<h2 id="v-9"><a class="header" href="#v-9">v?.??</a></h2>
<p><strong>Release:</strong> November 7, 2011</p>
<h3 id="contributors-52"><a class="header" href="#contributors-52">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-37"><a class="header" href="#new-features-37">New features:</a></h3>
<ul>
<li>set fastrom is now documented in stdlib.asm.</li>
<li>Minor edits to the documentation.</li>
<li>An xkas emulation mode was added, which makes Asar act more like xkas 0.06. It should hopefully be 100% compatible with all previously submitted patches/sprites/etc.</li>
<li>Asar can now fix the checksum.</li>
<li>The command line options have been edited a bit, including a few bugfixes.</li>
</ul>
<h3 id="bug-fixes-52"><a class="header" href="#bug-fixes-52">Bug fixes:</a></h3>
<ul>
<li>Opcodes that may or may not take an argument (INC, LSR, etc) now work better together with autocolon.</li>
<li>&quot;Unknown command&quot; errors have been edited.</li>
</ul>
<h3 id="deprecated-features-8"><a class="header" href="#deprecated-features-8">Deprecated features:</a></h3>
<ul>
<li>set resizable has been removed.</li>
</ul>
<hr />
<h2 id="v-10"><a class="header" href="#v-10">v?.??</a></h2>
<p><strong>Release:</strong> October 25, 2011</p>
<h3 id="contributors-53"><a class="header" href="#contributors-53">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-38"><a class="header" href="#new-features-38">New features:</a></h3>
<ul>
<li>labelopt is no longer off</li>
<li>A lone { or } is now treated as a null command (for use with code folding). Note that they're not allowed elsewhere. They don't need to be matched.</li>
</ul>
<h3 id="bug-fixes-53"><a class="header" href="#bug-fixes-53">Bug fixes:</a></h3>
<ul>
<li>autoclean no longer kills inappropriate data if pointed to an unused area. Operator precendence screwed up stuff.</li>
</ul>
<hr />
<h2 id="v-11"><a class="header" href="#v-11">v?.??</a></h2>
<p><strong>Release:</strong> ?</p>
<h3 id="contributors-54"><a class="header" href="#contributors-54">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-54"><a class="header" href="#bug-fixes-54">Bug fixes:</a></h3>
<ul>
<li>Asar will no longer place rats tags at any part of the unexpanded area, not even if it's a long list of 00s</li>
<li>Fixed a bunch of odd bugs with the automatic size finder and label optimizer, including one that treated LDA.l Label,x as LDA.w Label,x</li>
</ul>
<hr />
<h2 id="v-12"><a class="header" href="#v-12">v?.??</a></h2>
<p><strong>Release:</strong> October 23, 2011</p>
<h3 id="contributors-55"><a class="header" href="#contributors-55">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-39"><a class="header" href="#new-features-39">New features:</a></h3>
<ul>
<li>Blank lines are now allowed in macros.</li>
</ul>
<h3 id="bug-fixes-55"><a class="header" href="#bug-fixes-55">Bug fixes:</a></h3>
<ul>
<li>Broken or unknown macro arguments no longer abort assembling the rest of the macro.</li>
</ul>
<h3 id="deprecated-features-9"><a class="header" href="#deprecated-features-9">Deprecated features:</a></h3>
<ul>
<li>Removed the command DIEDIEDIE, a useless command that intentionally froze Asar if it's called from $088000 or later.</li>
</ul>
<hr />
<h2 id="v-13"><a class="header" href="#v-13">v?.??</a></h2>
<p><strong>Release:</strong> October 23, 2011</p>
<h3 id="contributors-56"><a class="header" href="#contributors-56">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-56"><a class="header" href="#bug-fixes-56">Bug fixes:</a></h3>
<ul>
<li>Fixed relative forward branches in freespace too.</li>
</ul>
<hr />
<h2 id="v-14"><a class="header" href="#v-14">v?.??</a></h2>
<p><strong>Release:</strong> October 23, 2011</p>
<h3 id="contributors-57"><a class="header" href="#contributors-57">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-40"><a class="header" href="#new-features-40">New features:</a></h3>
<ul>
<li>How quickly Asar aborts if it finds errors can be set</li>
<li>autocolon now accepts db $20, $30</li>
<li>autoclean JSL.l is now valid</li>
</ul>
<h3 id="bug-fixes-57"><a class="header" href="#bug-fixes-57">Bug fixes:</a></h3>
<ul>
<li>Fixed some uninitialized value errors that created garbage error messages if the patch doesn't exist</li>
<li>Putting a label in front of an opcode messed up earlier; this has been fixed</li>
<li>freecode forgot setting a few variables, which creates a bunch of errors if it's used</li>
</ul>
<hr />
<h2 id="v-15"><a class="header" href="#v-15">v?.??</a></h2>
<p><strong>Release:</strong> October 18, 2011</p>
<h3 id="contributors-58"><a class="header" href="#contributors-58">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="bug-fixes-58"><a class="header" href="#bug-fixes-58">Bug fixes:</a></h3>
<ul>
<li>Added a missing else statement on the label optimizer disabling flag that made it turn it on, or get values that change in crappy ways, for everything.</li>
</ul>
<hr />
<h2 id="v-16"><a class="header" href="#v-16">v?.??</a></h2>
<p><strong>Release:</strong> October 18, 2011</p>
<h3 id="contributors-59"><a class="header" href="#contributors-59">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-41"><a class="header" href="#new-features-41">New features:</a></h3>
<ul>
<li>Asar can now assemble SPC700 code, though very little testing was done on this and a lot of bugs may still be included. Also note that mov a,(x)+ has been moved to mov a,(x+), since that opcode increases X and not the value X points to. Two lines in arch-spc700.cpp can be uncommented to reenable the first syntax.</li>
<li>The fastrom command has been moved to set fastrom on.</li>
<li>Readded the base command.</li>
<li>Other small changes.</li>
</ul>
<h3 id="bug-fixes-59"><a class="header" href="#bug-fixes-59">Bug fixes:</a></h3>
<ul>
<li>The first line of stdlib is no longer ignored (a variable wasn't initialized).</li>
<li>Assembling is aborted if errors are detected, instead of continuing. As a side effect from this, errors are no longer printed twice or thrice.</li>
</ul>
<h3 id="deprecated-features-10"><a class="header" href="#deprecated-features-10">Deprecated features:</a></h3>
<ul>
<li>rep Label has been blocked. It was never supposed to be allowed.</li>
</ul>
<hr />
<h2 id="v030-or-040-or-something"><a class="header" href="#v030-or-040-or-something">v&quot;0.30 or 0.40 or something&quot;</a></h2>
<p><strong>Release:</strong> October 11, 2011</p>
<h3 id="contributors-60"><a class="header" href="#contributors-60">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-42"><a class="header" href="#new-features-42">New features:</a></h3>
<ul>
<li>LDA $9E,y is now treated as LDA $009E,y, but it prints a warning.</li>
<li>New command: set. It can set various options, including expected ROM title (the romtitle command has been removed), if the .l-&gt;.w optimizer should be active, and if warnings should be shown.</li>
<li>Asar can now automatically (try to) add colons where it thinks they should be. Note that this is disabled by default and not recommended for anything serious.</li>
<li>As with the colon adder, it should be avoided unless there is a good reason to use it (for example running it from an IRC bot). (Note that a time limit should be enabled when running it from an IRC bot so that noone can freeze the bot with slow patches).</li>
</ul>
<h3 id="bug-fixes-60"><a class="header" href="#bug-fixes-60">Bug fixes:</a></h3>
<ul>
<li>Unknown command errors have been made saner. The old method was some sort of debug code.</li>
<li>Carriage returns are now ignored on Linux.</li>
<li>Assembling blank patches on nonexistent ROMs or ROMs with length zero has been fixed.</li>
</ul>
<hr />
<h2 id="v-17"><a class="header" href="#v-17">v?.??</a></h2>
<p><strong>Release:</strong> October 9, 2011</p>
<h3 id="contributors-61"><a class="header" href="#contributors-61">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-43"><a class="header" href="#new-features-43">New features:</a></h3>
<ul>
<li>!a += +1 has been implemented.</li>
</ul>
<h3 id="bug-fixes-61"><a class="header" href="#bug-fixes-61">Bug fixes:</a></h3>
<ul>
<li>If you type &quot;freespace&quot;, the tool gives a more detailed error message that &quot;Unknown command.&quot;</li>
<li>A bug related to using pushpc inside a freespace has been fixed.</li>
</ul>
<h3 id="notes-4"><a class="header" href="#notes-4">Notes</a></h3>
<ul>
<li>The tool has been renamed to Asar. Pronounciation: The first A is short, and the second is long (as in &quot;Bazaar&quot;, except without the B). It doesn't matter if the S is pronounced as S or Z.</li>
</ul>
<hr />
<h2 id="v-18"><a class="header" href="#v-18">v?.??</a></h2>
<p><strong>Release:</strong> October 8, 2011</p>
<h3 id="contributors-62"><a class="header" href="#contributors-62">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-44"><a class="header" href="#new-features-44">New features:</a></h3>
<ul>
<li>It now looks for and assembles stdlib.asm. However, it prints an error if it doesn't find it.</li>
<li>Expected ROM title can now be set, see stdlib.asm for details. It defaults to SUPER MARIOWORLD if omitted, and it may not be set outside of stdlib.asm.</li>
<li>A 64-bit version has been included.</li>
<li>Both autoclean and autoclear works now. They act identically.</li>
</ul>
<hr />
<h2 id="v-initial-release"><a class="header" href="#v-initial-release">v?.?? (Initial Release)</a></h2>
<p><strong>Release:</strong> October 6, 2011</p>
<h3 id="contributors-63"><a class="header" href="#contributors-63">Contributors:</a></h3>
<ul>
<li>Alcaro</li>
</ul>
<h3 id="new-features-45"><a class="header" href="#new-features-45">New features:</a></h3>
<ul>
<li>Parentheses can be used, which allows some previously impossible statements.</li>
<li>Defines can be made longer without risk for crashes. This makes it much easier to implement Hijack Everywhere.</li>
<li>An if statement has been included, to get rid of the need for including those rep -1 tricks.</li>
<li>Freespace can be set automatically (it even includes a simple way to reclaim freespace used by older versions of the patch)</li>
</ul>
<h3 id="notes-5"><a class="header" href="#notes-5">Notes</a></h3>
<ul>
<li>In this original release, the tool was named &quot;a.as&quot;</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="sectionhack.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
